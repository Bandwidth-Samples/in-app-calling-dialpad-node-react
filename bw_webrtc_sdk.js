/*! @bandwidth/bw-webrtc-sdk - v1.1.0 - 2025-03-04 */
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsSIP=e()}(function(){return function r(s,i,o){function a(t,e){if(!i[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}};s[t][0].call(n.exports,function(e){return a(s[t][1][e]||e)},n,n.exports,r,s,i,o)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,n){function i(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=((e,t)=>{var n;if(e)return"string"==typeof e?a(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=e("./Utils"),r=e("./Constants"),s=e("./Grammar"),o=e("./URI"),u=e("./Socket"),c=e("./Exceptions"),d=(n.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:r.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:r.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:r.CONNECTION_RECOVERY_MIN_INTERVAL,via_host:"".concat(l.createRandomToken(12),".invalid")},{mandatory:{sockets:function(e){var t=[];if(u.isSocket(e))t.push({socket:e});else{if(!Array.isArray(e)||!e.length)return;var n,r=i(e);try{for(r.s();!(n=r.n()).done;){var s=n.value;Object.prototype.hasOwnProperty.call(s,"socket")&&u.isSocket(s.socket)?t.push(s):u.isSocket(s)&&t.push({socket:s})}}catch(e){r.e(e)}finally{r.f()}}return t},uri:function(e){/^sip:/i.test(e)||(e="".concat(r.SIP,":").concat(e));e=o.parse(e);return e&&e.user?e:void 0}},optional:{authorization_user:function(e){return-1===s.parse('"'.concat(e,'"'),"quoted_string")?void 0:e},authorization_jwt:function(e){if("string"==typeof e)return e},user_agent:function(e){if("string"==typeof e)return e},connection_recovery_max_interval:function(e){if(l.isDecimal(e)){e=Number(e);if(0<e)return e}},connection_recovery_min_interval:function(e){if(l.isDecimal(e)){e=Number(e);if(0<e)return e}},contact_uri:function(e){if("string"==typeof e){e=s.parse(e,"SIP_URI");if(-1!==e)return e}},display_name:function(e){return e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===s.parse(e,"uuid")?void 0:e},no_answer_timeout:function(e){if(l.isDecimal(e)){e=Number(e);if(0<e)return e}},session_timers:function(e){if("boolean"==typeof e)return e},session_timers_refresh_method:function(e){if("string"==typeof e&&((e=e.toUpperCase())===r.INVITE||e===r.UPDATE))return e},session_timers_force_refresher:function(e){if("boolean"==typeof e)return e},password:function(e){return String(e)},realm:function(e){return String(e)},ha1:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){if(l.isDecimal(e)){e=Number(e);if(0<e)return e}},registrar_server:function(e){/^sip:/i.test(e)||(e="".concat(r.SIP,":").concat(e));e=o.parse(e);return!e||e.user?void 0:e},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}});n.load=function(e,t){for(var n in d.mandatory){if(!t.hasOwnProperty(n))throw new c.ConfigurationError(n);var r=t[n],s=d.mandatory[n](r);if(void 0===s)throw new c.ConfigurationError(n,r);e[n]=s}for(var i in d.optional)if(t.hasOwnProperty(i)){var o=t[i];if(l.isEmpty(o))continue;var a=d.optional[i](o);if(void 0===a)throw new c.ConfigurationError(i,o);e[i]=a}}},{"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Socket":23,"./URI":29,"./Utils":30}],2:[function(e,t,n){e=e("../package.json");t.exports={USER_AGENT:"".concat(e.title," ").concat(e.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY,SUBSCRIBE",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}},{"../package.json":42}],3:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),i=e("./SIPMessage"),o=e("./Constants"),a=e("./Transactions"),l=e("./Dialog/RequestSender"),u=e("./Utils"),c=new s("Dialog"),d={STATUS_EARLY:1,STATUS_CONFIRMED:2};function h(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d.STATUS_CONFIRMED,s=this;if(!(s instanceof h))throw new TypeError("Cannot call a class as a function");if(this._owner=e,this._ua=e._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!t.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};t instanceof i.IncomingResponse&&(r=t.status_code<200?d.STATUS_EARLY:d.STATUS_CONFIRMED);s=t.parseHeader("contact");"UAS"===n?(this._id={call_id:t.call_id,local_tag:t.to_tag,remote_tag:t.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._remote_seqnum=t.cseq,this._local_uri=t.parseHeader("to").uri,this._remote_uri=t.parseHeader("from").uri,this._remote_target=s.uri,this._route_set=t.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===n&&(this._id={call_id:t.call_id,local_tag:t.from_tag,remote_tag:t.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._local_seqnum=t.cseq,this._local_uri=t.parseHeader("from").uri,this._remote_uri=t.parseHeader("to").uri,this._remote_target=s.uri,this._route_set=t.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),c.debug("new ".concat(n," dialog created with status ").concat(this._state===d.STATUS_EARLY?"EARLY":"CONFIRMED"))}t.exports=(e=[{key:"C",get:function(){return d}}],r((s=h).prototype,[{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(e){this._local_seqnum=e}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(e){this._uac_pending_reply=e}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}},{key:"update",value:function(e,t){this._state=d.STATUS_CONFIRMED,c.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),"UAC"===t&&(this._route_set=e.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){c.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this)}},{key:"sendRequest",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=u.cloneArray(n.extraHeaders),s=u.cloneObject(n.eventHandlers),n=n.body||null,e=this._createRequest(e,r,n);return s.onAuthenticated=function(){t._local_seqnum+=1},new l(this,e,s).send(),e}},{key:"receiveRequest",value:function(e){this._checkInDialogRequest(e)&&(e.method===o.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:e.method===o.INVITE&&(this._ack_seqnum=e.cseq),this._owner.receiveRequest(e))}},{key:"_createRequest",value:function(e,t,n){t=u.cloneArray(t),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));var r=e===o.CANCEL||e===o.ACK?this._local_seqnum:this._local_seqnum+=1;return new i.OutgoingRequest(e,this._remote_target,this._ua,{cseq:r,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},t,n)}},{key:"_checkInDialogRequest",value:function(t){var e,n=this;if(this._remote_seqnum)if(t.cseq<this._remote_seqnum){if(t.method!==o.ACK)return t.reply(500),!1;if(null===this._ack_seqnum||t.cseq!==this._ack_seqnum)return!1}else t.cseq>this._remote_seqnum&&(this._remote_seqnum=t.cseq);else this._remote_seqnum=t.cseq;if(t.method===o.INVITE||t.method===o.UPDATE&&t.body){if(!0===this._uac_pending_reply)t.reply(491);else{if(!0===this._uas_pending_reply)return e=1+(10*Math.random()|0),t.reply(500,null,["Retry-After:".concat(e)]),!1;this._uas_pending_reply=!0,t.server_transaction.on("stateChanged",function e(){t.server_transaction.state!==a.C.STATUS_ACCEPTED&&t.server_transaction.state!==a.C.STATUS_COMPLETED&&t.server_transaction.state!==a.C.STATUS_TERMINATED||(t.server_transaction.removeListener("stateChanged",e),n._uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){t.server_transaction.state===a.C.STATUS_ACCEPTED&&(n._remote_target=t.parseHeader("contact").uri)})}else t.method===o.NOTIFY&&t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){t.server_transaction.state===a.C.STATUS_COMPLETED&&(n._remote_target=t.parseHeader("contact").uri)});return!0}}]),r(s,e),h)},{"./Constants":2,"./Dialog/RequestSender":4,"./Logger":9,"./SIPMessage":22,"./Transactions":26,"./Utils":30}],4:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("../Constants"),i=e("../Transactions"),o=e("../RTCSession"),a=e("../RequestSender"),l={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};function u(e,t,n){if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");for(var r in this._dialog=e,this._ua=e._ua,this._request=t,this._eventHandlers=n,this._reattempt=!1,this._reattemptTimer=null,l)!Object.prototype.hasOwnProperty.call(l,r)||this._eventHandlers[r]||(this._eventHandlers[r]=l[r])}t.exports=(r(u.prototype,[{key:"request",get:function(){return this._request}},{key:"send",value:function(){var t=this,n=new a(this._ua,this._request,{onRequestTimeout:function(){t._eventHandlers.onRequestTimeout()},onTransportError:function(){t._eventHandlers.onTransportError()},onAuthenticated:function(e){t._eventHandlers.onAuthenticated(e)},onReceiveResponse:function(e){t._receiveResponse(e)}});n.send(),(this._request.method===s.INVITE||this._request.method===s.UPDATE&&this._request.body)&&n.clientTransaction.state!==i.C.STATUS_TERMINATED&&(this._dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function e(){n.clientTransaction.state!==i.C.STATUS_ACCEPTED&&n.clientTransaction.state!==i.C.STATUS_COMPLETED&&n.clientTransaction.state!==i.C.STATUS_TERMINATED||(n.clientTransaction.removeListener("stateChanged",e),t._dialog.uac_pending_reply=!1)}))}},{key:"_receiveResponse",value:function(e){var t=this;408===e.status_code||481===e.status_code?this._eventHandlers.onDialogError(e):e.method!==s.INVITE||491!==e.status_code||this._reattempt?200<=e.status_code&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):300<=e.status_code&&this._eventHandlers.onErrorResponse(e):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){t._dialog.owner.status!==o.C.STATUS_TERMINATED&&(t._reattempt=!0,t._request_sender.send())},1e3))}}]),u)},{"../Constants":2,"../RTCSession":15,"../RequestSender":21,"../Transactions":26}],5:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),a=e("./Utils"),l=new s("DigestAuthentication");function i(e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this._credentials=e,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}t.exports=(r(i.prototype,[{key:"get",value:function(e){switch(e){case"realm":return this._realm;case"ha1":return this._ha1;default:return void l.warn('get() | cannot get "%s" parameter',e)}}},{key:"authenticate",value:function(e,t){var n=e.method,r=e.ruri,e=e.body,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(this._algorithm=t.algorithm,this._realm=t.realm,this._nonce=t.nonce,this._opaque=t.opaque,this._stale=t.stale,this._algorithm){if("MD5"!==this._algorithm)return l.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return l.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return l.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return l.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return l.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(t.qop)if(-1<t.qop.indexOf("auth-int"))this._qop="auth-int";else{if(!(-1<t.qop.indexOf("auth")))return l.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=n,this._uri=r,this._cnonce=s||a.createRandomToken(12),this._nc+=1;var i,o,t=Number(this._nc).toString(16);return this._ncHex="00000000".substr(0,8-t.length)+t,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=a.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1,"auth"===this._qop?(i="".concat(this._method,":").concat(this._uri),o=a.calculateMD5(i),l.debug('authenticate() | using qop=auth [a2:"%s"]',i),this._response=a.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(o))):"auth-int"===this._qop?(i="".concat(this._method,":").concat(this._uri,":").concat(a.calculateMD5(e||"")),o=a.calculateMD5(i),l.debug('authenticate() | using qop=auth-int [a2:"%s"]',i),this._response=a.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(o))):null===this._qop&&(i="".concat(this._method,":").concat(this._uri),o=a.calculateMD5(i),l.debug('authenticate() | using qop=null [a2:"%s"]',i),this._response=a.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(o))),l.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var e=[];if(this._response)return e.push("algorithm=".concat(this._algorithm)),e.push('username="'.concat(this._credentials.username,'"')),e.push('realm="'.concat(this._realm,'"')),e.push('nonce="'.concat(this._nonce,'"')),e.push('uri="'.concat(this._uri,'"')),e.push('response="'.concat(this._response,'"')),this._opaque&&e.push('opaque="'.concat(this._opaque,'"')),this._qop&&(e.push("qop=".concat(this._qop)),e.push('cnonce="'.concat(this._cnonce,'"')),e.push("nc=".concat(this._ncHex))),"Digest ".concat(e.join(", "));throw new Error("response field does not exist, cannot generate Authorization header")}}]),i)},{"./Logger":9,"./Utils":30}],6:[function(e,t,n){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function o(n){var r=u();return function(){var e,t=d(n),t=(e=r?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==s(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e}}function a(e){var n="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return l(e,arguments,d(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),c(t,e)})(e)}function l(e,t,n){return(l=u()?Reflect.construct:function(e,t,n){var r=[null],t=(r.push.apply(r,t),new(Function.bind.apply(e,r)));return n&&c(t,n.prototype),t}).apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i(S,a(Error)),p=o(S);var h,_,f,p,g=S,m=(i(T,a(Error)),f=o(T),T),v=(i(C,a(Error)),_=o(C),C),A=(i(y,a(Error)),h=o(y),y);function y(e){var t;return r(this,y),(t=h.call(this)).code=4,t.name="NOT_READY_ERROR",t.message=e,t}function C(e){var t;return r(this,C),(t=_.call(this)).code=3,t.name="NOT_SUPPORTED_ERROR",t.message=e,t}function T(e){var t;return r(this,T),(t=f.call(this)).code=2,t.name="INVALID_STATE_ERROR",t.status=e,t.message="Invalid status: ".concat(e),t}function S(e,t){var n;return r(this,S),(n=p.call(this)).code=1,n.name="CONFIGURATION_ERROR",n.parameter=e,n.value=t,n.message=n.value?"Invalid value ".concat(JSON.stringify(n.value),' for parameter "').concat(n.parameter,'"'):"Missing parameter: ".concat(n.parameter),n}t.exports={ConfigurationError:g,InvalidStateError:m,NotSupportedError:v,NotReadyError:A}},{}],7:[function(Vn,e,t){function Bn(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}e.exports=((e={parse:function(g,l){var e={CRLF:q,DIGIT:u,ALPHA:o,HEXDIG:a,WSP:c,OCTET:n,DQUOTE:d,SP:h,HTAB:_,alphanum:s,reserved:H,unreserved:r,mark:F,escaped:f,LWS:p,SWS:y,HCOLON:j,TEXT_UTF8_TRIM:V,TEXT_UTF8char:C,UTF8_NONASCII:T,UTF8_CONT:S,LHEX:function(){var e;return null===(e=u())&&(/^[a-f]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[a-f]"))),e},token:b,token_nodot:B,separators:function(){var e;return 40===g.charCodeAt(m)?(e="(",m++):(e=null,0===v&&A('"("')),e=null===e&&(41===g.charCodeAt(m)?(e=")",m++):(e=null,0===v&&A('")"')),null===e)&&(60===g.charCodeAt(m)?(e="<",m++):(e=null,0===v&&A('"<"')),null===e)&&(62===g.charCodeAt(m)?(e=">",m++):(e=null,0===v&&A('">"')),null===e)&&(64===g.charCodeAt(m)?(e="@",m++):(e=null,0===v&&A('"@"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","')),null===e)&&(59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null===e)&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(92===g.charCodeAt(m)?(e="\\",m++):(e=null,0===v&&A('"\\\\"')),null===e)&&null===(e=d())&&(47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"')),null===e)&&(91===g.charCodeAt(m)?(e="[",m++):(e=null,0===v&&A('"["')),null===e)&&(93===g.charCodeAt(m)?(e="]",m++):(e=null,0===v&&A('"]"')),null===e)&&(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(123===g.charCodeAt(m)?(e="{",m++):(e=null,0===v&&A('"{"')),null===e)&&(125===g.charCodeAt(m)?(e="}",m++):(e=null,0===v&&A('"}"')),null===e)&&null===(e=h())?_():e},word:E,STAR:W,SLASH:G,EQUAL:w,LPAREN:$,RPAREN:Y,RAQUOT:K,LAQUOT:z,COMMA:R,SEMI:I,COLON:J,LDQUOT:X,RDQUOT:Q,comment:function e(){var t,n,r=m,s=$();if(null!==s){for(t=[],null===(n=Z())&&null===(n=U())&&(n=e());null!==n;)t.push(n),null===(n=Z())&&null===(n=U())&&(n=e());null!==t&&null!==(n=Y())?s=[s,t,n]:(s=null,m=r)}else s=null,m=r;return s},ctext:Z,quoted_string:ee,quoted_string_clean:te,qdtext:ne,quoted_pair:U,SIP_URI_noparams:re,SIP_URI:se,uri_scheme:ie,uri_scheme_sips:oe,uri_scheme_sip:ae,userinfo:le,user:ue,user_unreserved:ce,password:de,hostport:he,host:_e,hostname:fe,domainlabel:pe,toplabel:ge,IPv6reference:me,IPv6address:ve,h16:O,ls32:k,IPv4address:Ae,dec_octet:ye,port:Ce,uri_parameters:Te,uri_parameter:Se,transport_param:be,user_param:Ee,method_param:we,ttl_param:Re,maddr_param:Ie,lr_param:Ue,other_param:Oe,pname:ke,pvalue:Ne,paramchar:Pe,param_unreserved:De,headers:xe,header:Me,hname:Le,hvalue:qe,hnv_unreserved:He,Request_Response:function(){var e;return e=null===(e=pt())?Fe():e},Request_Line:Fe,Request_URI:je,absoluteURI:Ve,hier_part:Be,net_path:We,abs_path:Ge,opaque_part:$e,uric:Ye,uric_no_slash:Ke,path_segments:ze,segment:Je,param:Xe,pchar:Qe,scheme:Ze,authority:et,srvr:tt,reg_name:nt,query:rt,SIP_Version:st,INVITEm:it,ACKm:ot,OPTIONSm:at,BYEm:lt,CANCELm:ut,REGISTERm:ct,SUBSCRIBEm:dt,NOTIFYm:ht,REFERm:_t,Method:ft,Status_Line:pt,Status_Code:gt,extension_code:mt,Reason_Phrase:vt,Allow_Events:function(){var e,t,n,r,s,i=m;if(null!==(e=Ht())){for(t=[],s=m,null!==(n=R())&&null!==(r=Ht())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=Ht())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},Call_ID:function(){var e,t,n,r,s=m,i=m;return null!==(e=E())&&(r=m,64===g.charCodeAt(m)?(t="@",m++):(t=null,0===v&&A('"@"')),null!==t&&null!==(n=E())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=i),null===(e=null!==e?void(L=g.substring(m,s)):e)&&(m=s),e},Contact:function(){var e,t,n,r,s,i,o=m;if(null===(e=W()))if(s=m,null!==(e=At())){for(t=[],i=m,null!==(n=R())&&null!==(r=At())?n=[n,r]:(n=null,m=i);null!==n;)t.push(n),i=m,null!==(n=R())&&null!==(r=At())?n=[n,r]:(n=null,m=i);null!==t?e=[e,t]:(e=null,m=s)}else e=null,m=s;return null===(e=null!==e?(()=>{for(var e=L.multi_header.length,t=0;t<e;t++)if(null===L.multi_header[t].parsed){L=null;break}L=null!==L?L.multi_header:-1})():e)&&(m=o),e},contact_param:At,name_addr:N,display_name:yt,contact_params:Ct,c_p_q:Tt,c_p_expires:St,delta_seconds:P,qvalue:bt,generic_param:D,gen_value:Et,Content_Disposition:function(){var e,t,n,r,s,i=m;if(null!==(e=wt())){for(t=[],s=m,null!==(n=I())&&null!==(r=Rt())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=Rt())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},disp_type:wt,disp_param:Rt,handling_param:It,Content_Encoding:function(){var e,t,n,r,s,i=m;if(null!==(e=b())){for(t=[],s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},Content_Length:function(){var e,t,n=m;if(null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null===(e=null!==e?void(L=parseInt(e.join(""))):e)&&(m=n),e},Content_Type:function(){var e,t=m;return null===(e=null!==(e=Ut())?void(L=g.substring(m,t)):e)&&(m=t),e},media_type:Ut,m_type:Ot,discrete_type:kt,composite_type:Nt,extension_token:Pt,x_token:Dt,m_subtype:xt,m_parameter:Mt,m_value:Lt,CSeq:function(){var e,t,n,r=m;return null!==(e=qt())&&null!==(t=p())&&null!==(n=ft())?e=[e,t,n]:(e=null,m=r),e},CSeq_value:qt,Expires:function(){var e,t=m;return null===(e=null!==(e=P())?void(L=e):e)&&(m=t),e},Event:function(){var e,t,n,r,s,i=m,o=m;if(null!==(e=Ht())){for(t=[],s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null!==e&&(o=e[0],e=void(L.event=o.join("").toLowerCase())),null===e&&(m=i),e},event_type:Ht,From:function(){var e,t,n,r,s,i=m,o=m;if(null!==(e=null===(e=re())?N():e)){for(t=[],s=m,null!==(n=I())&&null!==(r=Ft())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=Ft())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(()=>{var e=L.tag;try{L=new M(L.uri,L.display_name,L.params),e&&L.setParam("tag",e)}catch(e){L=-1}})():e)&&(m=i),e},from_param:Ft,tag_param:jt,Max_Forwards:function(){var e,t,n=m;if(null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null===(e=null!==e?void(L=parseInt(e.join(""))):e)&&(m=n),e},Min_Expires:function(){var e,t=m;return null===(e=null!==(e=P())?void(L=e):e)&&(m=t),e},Name_Addr_Header:function(){for(var e,t,n,r,s,i,o=m,a=m,l=[],u=yt();null!==u;)l.push(u),u=yt();if(null!==l)if(null!==(u=z()))if(null!==(e=se()))if(null!==(t=K())){for(n=[],i=m,null!==(r=I())&&null!==(s=D())?r=[r,s]:(r=null,m=i);null!==r;)n.push(r),i=m,null!==(r=I())&&null!==(s=D())?r=[r,s]:(r=null,m=i);null!==n?l=[l,u,e,t,n]:(l=null,m=a)}else l=null,m=a;else l=null,m=a;else l=null,m=a;else l=null,m=a;return null===(l=null!==l?(()=>{try{L=new M(L.uri,L.display_name,L.params)}catch(e){L=-1}})():l)&&(m=o),l},Proxy_Authenticate:Vt,challenge:Vt,other_challenge:Bt,auth_param:Wt,digest_cln:Gt,realm:$t,realm_value:Yt,domain:Kt,URI:zt,nonce:Jt,nonce_value:Xt,opaque:Qt,stale:Zt,algorithm:en,qop_options:tn,qop_value:nn,Proxy_Require:function(){var e,t,n,r,s,i=m;if(null!==(e=b())){for(t=[],s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},Record_Route:function(){var e,t,n,r,s,i=m,o=m;if(null!==(e=rn())){for(t=[],s=m,null!==(n=R())&&null!==(r=rn())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=rn())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(()=>{for(var e=L.multi_header.length,t=0;t<e;t++)if(null===L.multi_header[t].parsed){L=null;break}L=null!==L?L.multi_header:-1})():e)&&(m=i),e},rec_route:rn,Reason:function(){var e,t,n,r,s,i=m,o=m;if("sip"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"SIP"')),null!==(e=null===e?b():e)){for(t=[],s=m,null!==(n=I())&&null!==(r=sn())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=sn())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null!==e&&(o=e[0],L.protocol=o.toLowerCase(),L.params||(L.params={}),e=void(L.params.text&&'"'===L.params.text[0]&&(o=L.params.text,L.text=o.substring(1,o.length-1),delete L.params.text))),null===e&&(m=i),e},reason_param:sn,reason_cause:on,Require:function(){var e,t,n,r,s,i=m;if(null!==(e=b())){for(t=[],s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},Route:function(){var e,t,n,r,s,i=m;if(null!==(e=an())){for(t=[],s=m,null!==(n=R())&&null!==(r=an())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=an())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},route_param:an,Subscription_State:function(){var e,t,n,r,s,i=m;if(null!==(e=ln())){for(t=[],s=m,null!==(n=I())&&null!==(r=un())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=un())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},substate_value:ln,subexp_params:un,event_reason_value:cn,Subject:function(){var e;return null!==(e=V())?e:""},Supported:function(){var e,t,n,r,s,i=m;if(null!==(e=b())){for(t=[],s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return null!==e?e:""},To:function(){var e,t,n,r,s,i=m,o=m;if(null!==(e=null===(e=re())?N():e)){for(t=[],s=m,null!==(n=I())&&null!==(r=dn())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=dn())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(()=>{var e=L.tag;try{L=new M(L.uri,L.display_name,L.params),e&&L.setParam("tag",e)}catch(e){L=-1}})():e)&&(m=i),e},to_param:dn,Via:function(){var e,t,n,r,s,i=m;if(null!==(e=hn())){for(t=[],s=m,null!==(n=R())&&null!==(r=hn())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=R())&&null!==(r=hn())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},via_param:hn,via_params:_n,via_ttl:fn,via_maddr:pn,via_received:gn,via_branch:mn,response_port:vn,rport:An,sent_protocol:yn,protocol_name:Cn,transport:Tn,sent_by:Sn,via_host:bn,via_port:En,ttl:wn,WWW_Authenticate:Vt,Session_Expires:function(){var e,t,n,r,s,i=m;if(null!==(e=Rn())){for(t=[],s=m,null!==(n=I())&&null!==(r=In())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=In())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},s_e_expires:Rn,s_e_params:In,s_e_refresher:Un,extension_header:function(){var e,t,n,r=m;return null!==(e=b())&&null!==(t=j())&&null!==(n=On())?e=[e,t,n]:(e=null,m=r),e},header_value:On,message_body:function(){for(var e=[],t=n();null!==t;)e.push(t),t=n();return e},uuid_URI:function(){var e,t,n=m;return"uuid:"===g.substr(m,5)?(e="uuid:",m+=5):(e=null,0===v&&A('"uuid:"')),null!==e&&null!==(t=kn())?e=[e,t]:(e=null,m=n),e},uuid:kn,hex4:x,hex8:Nn,hex12:Pn,Refer_To:function(){var e,t,n,r,s,i=m,o=m;if(null!==(e=null===(e=re())?N():e)){for(t=[],s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(()=>{try{L=new M(L.uri,L.display_name,L.params)}catch(e){L=-1}})():e)&&(m=i),e},Replaces:function(){var e,t,n,r,s,i=m;if(null!==(e=Dn())){for(t=[],s=m,null!==(n=I())&&null!==(r=xn())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=xn())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e},call_id:Dn,replaces_param:xn,to_tag:Mn,from_tag:Ln,early_flag:qn};if(void 0!==l){if(void 0===e[l])throw new Error("Invalid rule name: "+Bn(l)+".")}else l="CRLF";var m=0,v=0,i=0,t=[];function A(e){m<i||(i<m&&(i=m,t=[]),t.push(e))}function q(){var e;return"\r\n"===g.substr(m,2)?(e="\r\n",m+=2):(e=null,0===v&&A('"\\r\\n"')),e}function u(){var e;return/^[0-9]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[0-9]")),e}function o(){var e;return/^[a-zA-Z]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[a-zA-Z]")),e}function a(){var e;return/^[0-9a-fA-F]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[0-9a-fA-F]")),e}function c(){var e;return e=null===(e=h())?_():e}function n(){var e;return/^[\0-\xFF]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[\\0-\\xFF]")),e}function d(){var e;return/^["]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A('["]')),e}function h(){var e;return 32===g.charCodeAt(m)?(e=" ",m++):(e=null,0===v&&A('" "')),e}function _(){var e;return 9===g.charCodeAt(m)?(e="\t",m++):(e=null,0===v&&A('"\\t"')),e}function s(){var e;return/^[a-zA-Z0-9]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[a-zA-Z0-9]")),e}function H(){var e;return 59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null===e&&(47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"')),null===e)&&(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null===e)&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(64===g.charCodeAt(m)?(e="@",m++):(e=null,0===v&&A('"@"')),null===e)&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","'))),e}function r(){var e;return e=null===(e=s())?F():e}function F(){var e;return 45===g.charCodeAt(m)?(e="-",m++):(e=null,0===v&&A('"-"')),null===e&&(95===g.charCodeAt(m)?(e="_",m++):(e=null,0===v&&A('"_"')),null===e)&&(46===g.charCodeAt(m)?(e=".",m++):(e=null,0===v&&A('"."')),null===e)&&(33===g.charCodeAt(m)?(e="!",m++):(e=null,0===v&&A('"!"')),null===e)&&(126===g.charCodeAt(m)?(e="~",m++):(e=null,0===v&&A('"~"')),null===e)&&(42===g.charCodeAt(m)?(e="*",m++):(e=null,0===v&&A('"*"')),null===e)&&(39===g.charCodeAt(m)?(e="'",m++):(e=null,0===v&&A('"\'"')),null===e)&&(40===g.charCodeAt(m)?(e="(",m++):(e=null,0===v&&A('"("')),null===e)&&(41===g.charCodeAt(m)?(e=")",m++):(e=null,0===v&&A('")"'))),e}function f(){var e,t,n,r=m,s=m;return 37===g.charCodeAt(m)?(e="%",m++):(e=null,0===v&&A('"%"')),null!==e&&null!==(t=a())&&null!==(n=a())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?e.join(""):e)&&(m=r),e}function p(){for(var e,t=m,n=m,r=m,s=[],i=c();null!==i;)s.push(i),i=c();if(null!==s&&null!==(i=q())?s=[s,i]:(s=null,m=r),null!==(s=null!==s?s:"")){if(null!==(e=c()))for(i=[];null!==e;)i.push(e),e=c();else i=null;null!==i?s=[s,i]:(s=null,m=n)}else s=null,m=n;return null===(s=null!==s?" ":s)&&(m=t),s}function y(){var e;return null!==(e=p())?e:""}function j(){var e,t,n=m,r=m,s=[];for(null===(e=h())&&(e=_());null!==e;)s.push(e),null===(e=h())&&(e=_());return null!==s&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null!==e)&&null!==(t=y())?s=[s,e,t]:(s=null,m=r),null===(s=null!==s?":":s)&&(m=n),s}function V(){var e,t,n,r,s,i=m,o=m;if(null!==(t=C()))for(e=[];null!==t;)e.push(t),t=C();else e=null;if(null!==e){for(t=[],s=m,n=[],r=p();null!==r;)n.push(r),r=p();for(null!==n&&null!==(r=C())?n=[n,r]:(n=null,m=s);null!==n;){for(t.push(n),s=m,n=[],r=p();null!==r;)n.push(r),r=p();null!==n&&null!==(r=C())?n=[n,r]:(n=null,m=s)}null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?g.substring(m,i):e)&&(m=i),e}function C(){var e;return/^[!-~]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[!-~]")),e=null===e?T():e}function T(){var e;return/^[\x80-\uFFFF]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[\\x80-\\uFFFF]")),e}function S(){var e;return/^[\x80-\xBF]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[\\x80-\\xBF]")),e}function b(){var e,t,n=m;if(null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"'))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"')));else e=null;return null===(e=null!==e?g.substring(m,n):e)&&(m=n),e}function B(){var e,t,n=m;if(null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"'))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"')));else e=null;return null===(e=null!==e?g.substring(m,n):e)&&(m=n),e}function E(){var e,t,n=m;if(null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"')),null===t)&&(40===g.charCodeAt(m)?(t="(",m++):(t=null,0===v&&A('"("')),null===t)&&(41===g.charCodeAt(m)?(t=")",m++):(t=null,0===v&&A('")"')),null===t)&&(60===g.charCodeAt(m)?(t="<",m++):(t=null,0===v&&A('"<"')),null===t)&&(62===g.charCodeAt(m)?(t=">",m++):(t=null,0===v&&A('">"')),null===t)&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null===t)&&(92===g.charCodeAt(m)?(t="\\",m++):(t=null,0===v&&A('"\\\\"')),null===t)&&null===(t=d())&&(47===g.charCodeAt(m)?(t="/",m++):(t=null,0===v&&A('"/"')),null===t)&&(91===g.charCodeAt(m)?(t="[",m++):(t=null,0===v&&A('"["')),null===t)&&(93===g.charCodeAt(m)?(t="]",m++):(t=null,0===v&&A('"]"')),null===t)&&(63===g.charCodeAt(m)?(t="?",m++):(t=null,0===v&&A('"?"')),null===t)&&(123===g.charCodeAt(m)?(t="{",m++):(t=null,0===v&&A('"{"')),null===t)&&(125===g.charCodeAt(m)?(t="}",m++):(t=null,0===v&&A('"}"'))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=s())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null===t)&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null===t)&&(33===g.charCodeAt(m)?(t="!",m++):(t=null,0===v&&A('"!"')),null===t)&&(37===g.charCodeAt(m)?(t="%",m++):(t=null,0===v&&A('"%"')),null===t)&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null===t)&&(95===g.charCodeAt(m)?(t="_",m++):(t=null,0===v&&A('"_"')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')),null===t)&&(96===g.charCodeAt(m)?(t="`",m++):(t=null,0===v&&A('"`"')),null===t)&&(39===g.charCodeAt(m)?(t="'",m++):(t=null,0===v&&A('"\'"')),null===t)&&(126===g.charCodeAt(m)?(t="~",m++):(t=null,0===v&&A('"~"')),null===t)&&(40===g.charCodeAt(m)?(t="(",m++):(t=null,0===v&&A('"("')),null===t)&&(41===g.charCodeAt(m)?(t=")",m++):(t=null,0===v&&A('")"')),null===t)&&(60===g.charCodeAt(m)?(t="<",m++):(t=null,0===v&&A('"<"')),null===t)&&(62===g.charCodeAt(m)?(t=">",m++):(t=null,0===v&&A('">"')),null===t)&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null===t)&&(92===g.charCodeAt(m)?(t="\\",m++):(t=null,0===v&&A('"\\\\"')),null===t)&&null===(t=d())&&(47===g.charCodeAt(m)?(t="/",m++):(t=null,0===v&&A('"/"')),null===t)&&(91===g.charCodeAt(m)?(t="[",m++):(t=null,0===v&&A('"["')),null===t)&&(93===g.charCodeAt(m)?(t="]",m++):(t=null,0===v&&A('"]"')),null===t)&&(63===g.charCodeAt(m)?(t="?",m++):(t=null,0===v&&A('"?"')),null===t)&&(123===g.charCodeAt(m)?(t="{",m++):(t=null,0===v&&A('"{"')),null===t)&&(125===g.charCodeAt(m)?(t="}",m++):(t=null,0===v&&A('"}"')));else e=null;return null===(e=null!==e?g.substring(m,n):e)&&(m=n),e}function W(){var e,t,n,r=m,s=m;return null!==(e=y())&&(42===g.charCodeAt(m)?(t="*",m++):(t=null,0===v&&A('"*"')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?"*":e)&&(m=r),e}function G(){var e,t,n,r=m,s=m;return null!==(e=y())&&(47===g.charCodeAt(m)?(t="/",m++):(t=null,0===v&&A('"/"')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?"/":e)&&(m=r),e}function w(){var e,t,n,r=m,s=m;return null!==(e=y())&&(61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?"=":e)&&(m=r),e}function $(){var e,t,n,r=m,s=m;return null!==(e=y())&&(40===g.charCodeAt(m)?(t="(",m++):(t=null,0===v&&A('"("')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?"(":e)&&(m=r),e}function Y(){var e,t,n,r=m,s=m;return null!==(e=y())&&(41===g.charCodeAt(m)?(t=")",m++):(t=null,0===v&&A('")"')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?")":e)&&(m=r),e}function K(){var e,t,n=m,r=m;return 62===g.charCodeAt(m)?(e=">",m++):(e=null,0===v&&A('">"')),null!==e&&null!==(t=y())?e=[e,t]:(e=null,m=r),null===(e=null!==e?">":e)&&(m=n),e}function z(){var e,t,n=m,r=m;return null!==(e=y())&&(60===g.charCodeAt(m)?(t="<",m++):(t=null,0===v&&A('"<"')),null!==t)?e=[e,t]:(e=null,m=r),null===(e=null!==e?"<":e)&&(m=n),e}function R(){var e,t,n,r=m,s=m;return null!==(e=y())&&(44===g.charCodeAt(m)?(t=",",m++):(t=null,0===v&&A('","')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?",":e)&&(m=r),e}function I(){var e,t,n,r=m,s=m;return null!==(e=y())&&(59===g.charCodeAt(m)?(t=";",m++):(t=null,0===v&&A('";"')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?";":e)&&(m=r),e}function J(){var e,t,n,r=m,s=m;return null!==(e=y())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=y())?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?":":e)&&(m=r),e}function X(){var e,t,n=m,r=m;return null!==(e=y())&&null!==(t=d())?e=[e,t]:(e=null,m=r),null===(e=null!==e?'"':e)&&(m=n),e}function Q(){var e,t,n=m,r=m;return null!==(e=d())&&null!==(t=y())?e=[e,t]:(e=null,m=r),null===(e=null!==e?'"':e)&&(m=n),e}function Z(){var e;return/^[!-']/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[!-']")),e=null===e&&(/^[*-[]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[*-[]")),null===e)&&(/^[\]-~]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[\\]-~]")),null===e)&&null===(e=T())?p():e}function ee(){var e,t,n,r,s=m,i=m;if(null!==(e=y()))if(null!==(t=d())){for(n=[],null===(r=ne())&&(r=U());null!==r;)n.push(r),null===(r=ne())&&(r=U());null!==n&&null!==(r=d())?e=[e,t,n,r]:(e=null,m=i)}else e=null,m=i;else e=null,m=i;return null===(e=null!==e?g.substring(m,s):e)&&(m=s),e}function te(){var e,t,n,r,s=m,i=m;if(null!==(e=y()))if(null!==(r=d())){for(t=[],null===(n=ne())&&(n=U());null!==n;)t.push(n),null===(n=ne())&&(n=U());null!==t&&null!==(n=d())?e=[e,r,t,n]:(e=null,m=i)}else e=null,m=i;else e=null,m=i;return null===(e=null!==e?(r=g.substring(m,s).trim()).substring(1,r.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1"):e)&&(m=s),e}function ne(){var e;return e=null===(e=p())&&(33===g.charCodeAt(m)?(e="!",m++):(e=null,0===v&&A('"!"')),null===e)&&(/^[#-[]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[#-[]")),null===e)&&(/^[\]-~]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[\\]-~]")),null===e)?T():e}function U(){var e,t,n=m;return 92===g.charCodeAt(m)?(e="\\",m++):(e=null,0===v&&A('"\\\\"')),null!==e&&(/^[\0-\t]/.test(g.charAt(m))?(t=g.charAt(m),m++):(t=null,0===v&&A("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(g.charAt(m))?(t=g.charAt(m),m++):(t=null,0===v&&A("[\\x0B-\\f]")),null===t)&&(/^[\x0E-]/.test(g.charAt(m))?(t=g.charAt(m),m++):(t=null,0===v&&A("[\\x0E-]"))),null!==t)?e=[e,t]:(e=null,m=n),e}function re(){var e,t,n,r,s=m,i=m;return null!==(e=ie())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=null!==(n=le())?n:"")&&null!==(r=he())?e=[e,t,n,r]:(e=null,m=i),null===(e=null!==e?(()=>{try{L.uri=new jn(L.scheme,L.user,L.host,L.port),delete L.scheme,delete L.user,delete L.host,delete L.host_type,delete L.port}catch(e){L=-1}})():e)&&(m=s),e}function se(){var e,t,n,r,s,i,o=m,a=m;return null!==(e=ie())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=null!==(n=le())?n:"")&&null!==(r=he())&&null!==(s=Te())&&null!==(i=null!==(i=xe())?i:"")?e=[e,t,n,r,s,i]:(e=null,m=a),null===(e=null!==e?(()=>{try{L.uri=new jn(L.scheme,L.user,L.host,L.port,L.uri_params,L.uri_headers),delete L.scheme,delete L.user,delete L.host,delete L.host_type,delete L.port,delete L.uri_params,"SIP_URI"===l&&(L=L.uri)}catch(e){L=-1}})():e)&&(m=o),e}function ie(){var e;return e=null===(e=oe())?ae():e}function oe(){var e,t,n=m;return"sips"===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"sips"')),null!==e&&(t=e,e=void(L.scheme=t.toLowerCase())),null===e&&(m=n),e}function ae(){var e,t,n=m;return"sip"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"sip"')),null!==e&&(t=e,e=void(L.scheme=t.toLowerCase())),null===e&&(m=n),e}function le(){var e,t,n,r,s=m,i=m;return null!==(e=ue())&&(r=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))&&(64===g.charCodeAt(m)?(n="@",m++):(n=null,0===v&&A('"@"')),null!==n)?e=[e,t,n]:(e=null,m=i),null===(e=null!==e?void(L.user=decodeURIComponent(g.substring(m-1,s))):e)&&(m=s),e}function ue(){var e,t;if(null!==(t=null===(t=r())&&null===(t=f())?ce():t))for(e=[];null!==t;)e.push(t),null===(t=r())&&null===(t=f())&&(t=ce());else e=null;return e}function ce(){var e;return 38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","')),null===e)&&(59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null===e)&&(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null===e)&&(47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"'))),e}function de(){var e,t=m,n=[];for(null===(e=r())&&null===(e=f())&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","')));null!==e;)n.push(e),null===(e=r())&&null===(e=f())&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","')));return null===(n=null!==n?void(L.password=g.substring(m,t)):n)&&(m=t),n}function he(){var e,t,n,r,s=m;return null!==(e=_e())&&(r=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=Ce())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=s),e}function _e(){var e,t=m;return null!==(e=null===(e=fe())&&null===(e=Ae())?me():e)&&(L.host=g.substring(m,t).toLowerCase(),e=L.host),null===e&&(m=t),e}function fe(){var e,t,n=m,r=m,s=[],i=m;for(null!==(e=pe())&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null!==t)?e=[e,t]:(e=null,m=i);null!==e;)s.push(e),i=m,null!==(e=pe())&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null!==t)?e=[e,t]:(e=null,m=i);return null!==s&&null!==(e=ge())&&(46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null!==(t=null!==t?t:""))?s=[s,e,t]:(s=null,m=r),null!==s&&(r=n,L.host_type="domain",s=g.substring(m,r)),null===s&&(m=n),s}function pe(){var e,t,n,r=m;if(null!==(e=s())){for(t=[],null===(n=s())&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(95===g.charCodeAt(m)?(n="_",m++):(n=null,0===v&&A('"_"')));null!==n;)t.push(n),null===(n=s())&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(95===g.charCodeAt(m)?(n="_",m++):(n=null,0===v&&A('"_"')));null!==t?e=[e,t]:(e=null,m=r)}else e=null,m=r;return e}function ge(){var e,t,n,r=m;if(null!==(e=o())){for(t=[],null===(n=s())&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(95===g.charCodeAt(m)?(n="_",m++):(n=null,0===v&&A('"_"')));null!==n;)t.push(n),null===(n=s())&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(95===g.charCodeAt(m)?(n="_",m++):(n=null,0===v&&A('"_"')));null!==t?e=[e,t]:(e=null,m=r)}else e=null,m=r;return e}function me(){var e,t,n,r=m,s=m;return 91===g.charCodeAt(m)?(e="[",m++):(e=null,0===v&&A('"["')),null!==e&&null!==(n=ve())&&(93===g.charCodeAt(m)?(t="]",m++):(t=null,0===v&&A('"]"')),null!==t)?e=[e,n,t]:(e=null,m=s),null!==e&&(n=r,L.host_type="IPv6",e=g.substring(m,n)),null===e&&(m=r),e}function ve(){var e,t,n,r,s,i,o,a,l,u,c,d,h,_,f=m,p=m;return null!==(e=O())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=O())&&(58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r)&&null!==(s=O())&&(58===g.charCodeAt(m)?(i=":",m++):(i=null,0===v&&A('":"')),null!==i)&&null!==(o=O())&&(58===g.charCodeAt(m)?(a=":",m++):(a=null,0===v&&A('":"')),null!==a)&&null!==(l=O())&&(58===g.charCodeAt(m)?(u=":",m++):(u=null,0===v&&A('":"')),null!==u)&&null!==(c=O())&&(58===g.charCodeAt(m)?(d=":",m++):(d=null,0===v&&A('":"')),null!==d)&&null!==(_=k())?e=[e,t,n,r,s,i,o,a,l,u,c,d,_]:(e=null,m=p),null===e&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())&&(58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n)&&null!==(r=O())&&(58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s)&&null!==(i=O())&&(58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o)&&null!==(a=O())&&(58===g.charCodeAt(m)?(l=":",m++):(l=null,0===v&&A('":"')),null!==l)&&null!==(u=O())&&(58===g.charCodeAt(m)?(c=":",m++):(c=null,0===v&&A('":"')),null!==c)&&null!==(d=k())?e=[e,t,n,r,s,i,o,a,l,u,c,d]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())&&(58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n)&&null!==(r=O())&&(58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s)&&null!==(i=O())&&(58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o)&&null!==(a=O())&&(58===g.charCodeAt(m)?(l=":",m++):(l=null,0===v&&A('":"')),null!==l)&&null!==(u=k())?e=[e,t,n,r,s,i,o,a,l,u]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())&&(58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n)&&null!==(r=O())&&(58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s)&&null!==(i=O())&&(58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o)&&null!==(a=k())?e=[e,t,n,r,s,i,o,a]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())&&(58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n)&&null!==(r=O())&&(58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s)&&null!==(i=k())?e=[e,t,n,r,s,i]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())&&(58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n)&&null!==(r=k())?e=[e,t,n,r]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=k())?e=[e,t]:(e=null,m=p),null===e)&&(p=m,"::"===g.substr(m,2)?(e="::",m+=2):(e=null,0===v&&A('"::"')),null!==e&&null!==(t=O())?e=[e,t]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&("::"===g.substr(m,2)?(t="::",m+=2):(t=null,0===v&&A('"::"')),null!==t)&&null!==(n=O())&&(58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r)&&null!==(s=O())&&(58===g.charCodeAt(m)?(i=":",m++):(i=null,0===v&&A('":"')),null!==i)&&null!==(o=O())&&(58===g.charCodeAt(m)?(a=":",m++):(a=null,0===v&&A('":"')),null!==a)&&null!==(l=O())&&(58===g.charCodeAt(m)?(u=":",m++):(u=null,0===v&&A('":"')),null!==u)&&null!==(c=k())?e=[e,t,n,r,s,i,o,a,l,u,c]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&("::"===g.substr(m,2)?(n="::",m+=2):(n=null,0===v&&A('"::"')),null!==n)&&null!==(r=O())&&(58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s)&&null!==(i=O())&&(58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o)&&null!==(a=O())&&(58===g.charCodeAt(m)?(l=":",m++):(l=null,0===v&&A('":"')),null!==l)&&null!==(u=k())?e=[e,t,n,r,s,i,o,a,l,u]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&(h=m,58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n&&null!==(r=O())?n=[n,r]:(n=null,m=h),null!==(n=null!==n?n:""))&&("::"===g.substr(m,2)?(r="::",m+=2):(r=null,0===v&&A('"::"')),null!==r)&&null!==(s=O())&&(58===g.charCodeAt(m)?(i=":",m++):(i=null,0===v&&A('":"')),null!==i)&&null!==(o=O())&&(58===g.charCodeAt(m)?(a=":",m++):(a=null,0===v&&A('":"')),null!==a)&&null!==(l=k())?e=[e,t,n,r,s,i,o,a,l]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&(h=m,58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n&&null!==(r=O())?n=[n,r]:(n=null,m=h),null!==(n=null!==n?n:""))&&(h=m,58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r&&null!==(s=O())?r=[r,s]:(r=null,m=h),null!==(r=null!==r?r:""))&&("::"===g.substr(m,2)?(s="::",m+=2):(s=null,0===v&&A('"::"')),null!==s)&&null!==(i=O())&&(58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o)&&null!==(a=k())?e=[e,t,n,r,s,i,o,a]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&(h=m,58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n&&null!==(r=O())?n=[n,r]:(n=null,m=h),null!==(n=null!==n?n:""))&&(h=m,58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r&&null!==(s=O())?r=[r,s]:(r=null,m=h),null!==(r=null!==r?r:""))&&(h=m,58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s&&null!==(i=O())?s=[s,i]:(s=null,m=h),null!==(s=null!==s?s:""))&&("::"===g.substr(m,2)?(i="::",m+=2):(i=null,0===v&&A('"::"')),null!==i)&&null!==(o=k())?e=[e,t,n,r,s,i,o]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&(h=m,58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n&&null!==(r=O())?n=[n,r]:(n=null,m=h),null!==(n=null!==n?n:""))&&(h=m,58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r&&null!==(s=O())?r=[r,s]:(r=null,m=h),null!==(r=null!==r?r:""))&&(h=m,58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s&&null!==(i=O())?s=[s,i]:(s=null,m=h),null!==(s=null!==s?s:""))&&(h=m,58===g.charCodeAt(m)?(i=":",m++):(i=null,0===v&&A('":"')),null!==i&&null!==(o=O())?i=[i,o]:(i=null,m=h),null!==(i=null!==i?i:""))&&("::"===g.substr(m,2)?(o="::",m+=2):(o=null,0===v&&A('"::"')),null!==o)&&null!==(a=O())?e=[e,t,n,r,s,i,o,a]:(e=null,m=p),null===e)&&(p=m,null!==(e=O())&&(h=m,58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,m=h),null!==(t=null!==t?t:""))&&(h=m,58===g.charCodeAt(m)?(n=":",m++):(n=null,0===v&&A('":"')),null!==n&&null!==(r=O())?n=[n,r]:(n=null,m=h),null!==(n=null!==n?n:""))&&(h=m,58===g.charCodeAt(m)?(r=":",m++):(r=null,0===v&&A('":"')),null!==r&&null!==(s=O())?r=[r,s]:(r=null,m=h),null!==(r=null!==r?r:""))&&(h=m,58===g.charCodeAt(m)?(s=":",m++):(s=null,0===v&&A('":"')),null!==s&&null!==(i=O())?s=[s,i]:(s=null,m=h),null!==(s=null!==s?s:""))&&(h=m,58===g.charCodeAt(m)?(i=":",m++):(i=null,0===v&&A('":"')),null!==i&&null!==(o=O())?i=[i,o]:(i=null,m=h),null!==(i=null!==i?i:""))&&(h=m,58===g.charCodeAt(m)?(o=":",m++):(o=null,0===v&&A('":"')),null!==o&&null!==(a=O())?o=[o,a]:(o=null,m=h),null!==(o=null!==o?o:""))&&("::"===g.substr(m,2)?(a="::",m+=2):(a=null,0===v&&A('"::"')),null!==a)?e=[e,t,n,r,s,i,o,a]:(e=null,m=p)),null!==e&&(_=f,L.host_type="IPv6",e=g.substring(m,_)),null===e&&(m=f),e}function O(){var e,t,n,r,s=m;return null!==(e=a())&&null!==(t=null!==(t=a())?t:"")&&null!==(n=null!==(n=a())?n:"")&&null!==(r=null!==(r=a())?r:"")?e=[e,t,n,r]:(e=null,m=s),e}function k(){var e,t,n,r=m;return null!==(e=O())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=O())?e=[e,t,n]:(e=null,m=r),e=null===e?Ae():e}function Ae(){var e,t,n,r,s,i,o,a=m,l=m;return null!==(e=ye())&&(46===g.charCodeAt(m)?(o=".",m++):(o=null,0===v&&A('"."')),null!==o)&&null!==(t=ye())&&(46===g.charCodeAt(m)?(n=".",m++):(n=null,0===v&&A('"."')),null!==n)&&null!==(r=ye())&&(46===g.charCodeAt(m)?(s=".",m++):(s=null,0===v&&A('"."')),null!==s)&&null!==(i=ye())?e=[e,o,t,n,r,s,i]:(e=null,m=l),null!==e&&(o=a,L.host_type="IPv4",e=g.substring(m,o)),null===e&&(m=a),e}function ye(){var e,t,n,r=m;return"25"===g.substr(m,2)?(e="25",m+=2):(e=null,0===v&&A('"25"')),null!==e&&(/^[0-5]/.test(g.charAt(m))?(t=g.charAt(m),m++):(t=null,0===v&&A("[0-5]")),null!==t)?e=[e,t]:(e=null,m=r),e=null===e&&(r=m,50===g.charCodeAt(m)?(e="2",m++):(e=null,0===v&&A('"2"')),null!==e&&(/^[0-4]/.test(g.charAt(m))?(t=g.charAt(m),m++):(t=null,0===v&&A("[0-4]")),null!==t)&&null!==(n=u())?e=[e,t,n]:(e=null,m=r),null===e)&&(r=m,49===g.charCodeAt(m)?(e="1",m++):(e=null,0===v&&A('"1"')),null!==e&&null!==(t=u())&&null!==(n=u())?e=[e,t,n]:(e=null,m=r),null===e)&&(r=m,/^[1-9]/.test(g.charAt(m))?(e=g.charAt(m),m++):(e=null,0===v&&A("[1-9]")),null!==e&&null!==(t=u())?e=[e,t]:(e=null,m=r),null===e)?u():e}function Ce(){var e,t,n,r,s,i=m,o=m;return null!==(e=null!==(e=u())?e:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")?e=[e,s,t,n,r]:(e=null,m=o),null!==e&&(s=e,s=parseInt(s.join("")),e=L.port=s),null===e&&(m=i),e}function Te(){var e,t,n=[],r=m;for(59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null!==e&&null!==(t=Se())?e=[e,t]:(e=null,m=r);null!==e;)n.push(e),r=m,59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null!==e&&null!==(t=Se())?e=[e,t]:(e=null,m=r);return n}function Se(){var e;return e=null===(e=be())&&null===(e=Ee())&&null===(e=we())&&null===(e=Re())&&null===(e=Ie())&&null===(e=Ue())?Oe():e}function be(){var e,t,n=m,r=m;return"transport="===g.substr(m,10).toLowerCase()?(e=g.substr(m,10),m+=10):(e=null,0===v&&A('"transport="')),null!==e&&("udp"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"udp"')),null!==(t=null===t&&("tcp"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"tcp"')),null===t)&&("sctp"===g.substr(m,4).toLowerCase()?(t=g.substr(m,4),m+=4):(t=null,0===v&&A('"sctp"')),null===t)&&("tls"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"tls"')),null===t)?b():t))?e=[e,t]:(e=null,m=r),null!==e&&(t=e[1],L.uri_params||(L.uri_params={}),e=void(L.uri_params.transport=t.toLowerCase())),null===e&&(m=n),e}function Ee(){var e,t,n=m,r=m;return"user="===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"user="')),null!==e&&("phone"===g.substr(m,5).toLowerCase()?(t=g.substr(m,5),m+=5):(t=null,0===v&&A('"phone"')),null!==(t=null===t&&("ip"===g.substr(m,2).toLowerCase()?(t=g.substr(m,2),m+=2):(t=null,0===v&&A('"ip"')),null===t)?b():t))?e=[e,t]:(e=null,m=r),null!==e&&(t=e[1],L.uri_params||(L.uri_params={}),e=void(L.uri_params.user=t.toLowerCase())),null===e&&(m=n),e}function we(){var e,t,n=m,r=m;return"method="===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"method="')),null!==e&&null!==(t=ft())?e=[e,t]:(e=null,m=r),null!==e&&(t=e[1],L.uri_params||(L.uri_params={}),e=void(L.uri_params.method=t)),null===e&&(m=n),e}function Re(){var e,t,n=m,r=m;return"ttl="===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"ttl="')),null!==e&&null!==(t=wn())?e=[e,t]:(e=null,m=r),null!==e&&(t=e[1],L.params||(L.params={}),e=void(L.params.ttl=t)),null===e&&(m=n),e}function Ie(){var e,t,n=m,r=m;return"maddr="===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"maddr="')),null!==e&&null!==(t=_e())?e=[e,t]:(e=null,m=r),null!==e&&(t=e[1],L.uri_params||(L.uri_params={}),e=void(L.uri_params.maddr=t)),null===e&&(m=n),e}function Ue(){var e,t,n,r,s=m,i=m;return"lr"===g.substr(m,2).toLowerCase()?(e=g.substr(m,2),m+=2):(e=null,0===v&&A('"lr"')),null!==e&&(r=m,61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null!==t&&null!==(n=b())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=i),null!==e&&(L.uri_params||(L.uri_params={}),e=void(L.uri_params.lr=void 0)),null===e&&(m=s),e}function Oe(){var e,t,n,r,s=m,i=m;return null!==(e=ke())&&(r=m,61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null!==t&&null!==(n=Ne())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=i),null!==e&&(n=e[0],r=e[1],L.uri_params||(L.uri_params={}),r=void 0===r?void 0:r[1],e=void(L.uri_params[n.toLowerCase()]=r)),null===e&&(m=s),e}function ke(){var e,t,n=m;if(null!==(t=Pe()))for(e=[];null!==t;)e.push(t),t=Pe();else e=null;return null===(e=null!==e?e.join(""):e)&&(m=n),e}function Ne(){var e,t,n=m;if(null!==(t=Pe()))for(e=[];null!==t;)e.push(t),t=Pe();else e=null;return null===(e=null!==e?e.join(""):e)&&(m=n),e}function Pe(){var e;return e=null===(e=De())&&null===(e=r())?f():e}function De(){var e;return 91===g.charCodeAt(m)?(e="[",m++):(e=null,0===v&&A('"["')),null===e&&(93===g.charCodeAt(m)?(e="]",m++):(e=null,0===v&&A('"]"')),null===e)&&(47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"')),null===e)&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"'))),e}function xe(){var e,t,n,r,s,i,o=m;if(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null!==e)if(null!==(t=Me())){for(n=[],i=m,38===g.charCodeAt(m)?(r="&",m++):(r=null,0===v&&A('"&"')),null!==r&&null!==(s=Me())?r=[r,s]:(r=null,m=i);null!==r;)n.push(r),i=m,38===g.charCodeAt(m)?(r="&",m++):(r=null,0===v&&A('"&"')),null!==r&&null!==(s=Me())?r=[r,s]:(r=null,m=i);null!==n?e=[e,t,n]:(e=null,m=o)}else e=null,m=o;else e=null,m=o;return e}function Me(){var e,t,n,r=m,s=m;return null!==(e=Le())&&(61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null!==t)&&null!==(n=qe())?e=[e,t,n]:(e=null,m=s),null!==e&&(t=e[0],n=e[2],t=t.join("").toLowerCase(),n=n.join(""),L.uri_headers||(L.uri_headers={}),e=void(L.uri_headers[t]?L.uri_headers[t].push(n):L.uri_headers[t]=[n])),null===e&&(m=r),e}function Le(){var e,t;if(null!==(t=null===(t=He())&&null===(t=r())?f():t))for(e=[];null!==t;)e.push(t),null===(t=He())&&null===(t=r())&&(t=f());else e=null;return e}function qe(){var e,t=[];for(null===(e=He())&&null===(e=r())&&(e=f());null!==e;)t.push(e),null===(e=He())&&null===(e=r())&&(e=f());return t}function He(){var e;return 91===g.charCodeAt(m)?(e="[",m++):(e=null,0===v&&A('"["')),null===e&&(93===g.charCodeAt(m)?(e="]",m++):(e=null,0===v&&A('"]"')),null===e)&&(47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"')),null===e)&&(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null===e)&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"'))),e}function Fe(){var e,t,n,r,s,i=m;return null!==(e=ft())&&null!==(t=h())&&null!==(n=je())&&null!==(r=h())&&null!==(s=st())?e=[e,t,n,r,s]:(e=null,m=i),e}function je(){var e;return e=null===(e=se())?Ve():e}function Ve(){var e,t,n,r=m;return null!==(e=Ze())&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null!==t)&&null!==(n=null===(n=Be())?$e():n)?e=[e,t,n]:(e=null,m=r),e}function Be(){var e,t,n,r,s=m;return null!==(e=null===(e=We())?Ge():e)&&(r=m,63===g.charCodeAt(m)?(t="?",m++):(t=null,0===v&&A('"?"')),null!==t&&null!==(n=rt())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=s),e}function We(){var e,t,n,r=m;return"//"===g.substr(m,2)?(e="//",m+=2):(e=null,0===v&&A('"//"')),null!==e&&null!==(t=et())&&null!==(n=null!==(n=Ge())?n:"")?e=[e,t,n]:(e=null,m=r),e}function Ge(){var e,t,n=m;return 47===g.charCodeAt(m)?(e="/",m++):(e=null,0===v&&A('"/"')),null!==e&&null!==(t=ze())?e=[e,t]:(e=null,m=n),e}function $e(){var e,t,n,r=m;if(null!==(e=Ke())){for(t=[],n=Ye();null!==n;)t.push(n),n=Ye();null!==t?e=[e,t]:(e=null,m=r)}else e=null,m=r;return e}function Ye(){var e;return e=null===(e=H())&&null===(e=r())?f():e}function Ke(){var e;return null===(e=r())&&null===(e=f())&&(59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null===e)&&(63===g.charCodeAt(m)?(e="?",m++):(e=null,0===v&&A('"?"')),null===e)&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(64===g.charCodeAt(m)?(e="@",m++):(e=null,0===v&&A('"@"')),null===e)&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","'))),e}function ze(){var e,t,n,r,s,i=m;if(null!==(e=Je())){for(t=[],s=m,47===g.charCodeAt(m)?(n="/",m++):(n=null,0===v&&A('"/"')),null!==n&&null!==(r=Je())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,47===g.charCodeAt(m)?(n="/",m++):(n=null,0===v&&A('"/"')),null!==n&&null!==(r=Je())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e}function Je(){for(var e,t,n,r=m,s=[],i=Qe();null!==i;)s.push(i),i=Qe();if(null!==s){for(i=[],n=m,59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null!==e&&null!==(t=Xe())?e=[e,t]:(e=null,m=n);null!==e;)i.push(e),n=m,59===g.charCodeAt(m)?(e=";",m++):(e=null,0===v&&A('";"')),null!==e&&null!==(t=Xe())?e=[e,t]:(e=null,m=n);null!==i?s=[s,i]:(s=null,m=r)}else s=null,m=r;return s}function Xe(){for(var e=[],t=Qe();null!==t;)e.push(t),t=Qe();return e}function Qe(){var e;return null===(e=r())&&null===(e=f())&&(58===g.charCodeAt(m)?(e=":",m++):(e=null,0===v&&A('":"')),null===e)&&(64===g.charCodeAt(m)?(e="@",m++):(e=null,0===v&&A('"@"')),null===e)&&(38===g.charCodeAt(m)?(e="&",m++):(e=null,0===v&&A('"&"')),null===e)&&(61===g.charCodeAt(m)?(e="=",m++):(e=null,0===v&&A('"="')),null===e)&&(43===g.charCodeAt(m)?(e="+",m++):(e=null,0===v&&A('"+"')),null===e)&&(36===g.charCodeAt(m)?(e="$",m++):(e=null,0===v&&A('"$"')),null===e)&&(44===g.charCodeAt(m)?(e=",",m++):(e=null,0===v&&A('","'))),e}function Ze(){var e,t,n,r=m,s=m;if(null!==(e=o())){for(t=[],null===(n=o())&&null===(n=u())&&(43===g.charCodeAt(m)?(n="+",m++):(n=null,0===v&&A('"+"')),null===n)&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(46===g.charCodeAt(m)?(n=".",m++):(n=null,0===v&&A('"."')));null!==n;)t.push(n),null===(n=o())&&null===(n=u())&&(43===g.charCodeAt(m)?(n="+",m++):(n=null,0===v&&A('"+"')),null===n)&&(45===g.charCodeAt(m)?(n="-",m++):(n=null,0===v&&A('"-"')),null===n)&&(46===g.charCodeAt(m)?(n=".",m++):(n=null,0===v&&A('"."')));null!==t?e=[e,t]:(e=null,m=s)}else e=null,m=s;return null===(e=null!==e?void(L.scheme=g.substring(m,r)):e)&&(m=r),e}function et(){var e;return e=null===(e=tt())?nt():e}function tt(){var e,t,n=m,r=m;return null!==(e=le())&&(64===g.charCodeAt(m)?(t="@",m++):(t=null,0===v&&A('"@"')),null!==t)?e=[e,t]:(e=null,m=r),null!==(e=null!==e?e:"")&&null!==(t=he())?e=[e,t]:(e=null,m=n),null!==e?e:""}function nt(){var e,t;if(null===(t=r())&&null===(t=f())&&(36===g.charCodeAt(m)?(t="$",m++):(t=null,0===v&&A('"$"')),null===t)&&(44===g.charCodeAt(m)?(t=",",m++):(t=null,0===v&&A('","')),null===t)&&(59===g.charCodeAt(m)?(t=";",m++):(t=null,0===v&&A('";"')),null===t)&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null===t)&&(64===g.charCodeAt(m)?(t="@",m++):(t=null,0===v&&A('"@"')),null===t)&&(38===g.charCodeAt(m)?(t="&",m++):(t=null,0===v&&A('"&"')),null===t)&&(61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"'))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=r())&&null===(t=f())&&(36===g.charCodeAt(m)?(t="$",m++):(t=null,0===v&&A('"$"')),null===t)&&(44===g.charCodeAt(m)?(t=",",m++):(t=null,0===v&&A('","')),null===t)&&(59===g.charCodeAt(m)?(t=";",m++):(t=null,0===v&&A('";"')),null===t)&&(58===g.charCodeAt(m)?(t=":",m++):(t=null,0===v&&A('":"')),null===t)&&(64===g.charCodeAt(m)?(t="@",m++):(t=null,0===v&&A('"@"')),null===t)&&(38===g.charCodeAt(m)?(t="&",m++):(t=null,0===v&&A('"&"')),null===t)&&(61===g.charCodeAt(m)?(t="=",m++):(t=null,0===v&&A('"="')),null===t)&&(43===g.charCodeAt(m)?(t="+",m++):(t=null,0===v&&A('"+"')));else e=null;return e}function rt(){for(var e=[],t=Ye();null!==t;)e.push(t),t=Ye();return e}function st(){var e,t,n,r,s,i,o=m,a=m;if("sip"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"SIP"')),null!==e)if(47===g.charCodeAt(m)?(t="/",m++):(t=null,0===v&&A('"/"')),null!==t){if(null!==(r=u()))for(n=[];null!==r;)n.push(r),r=u();else n=null;if(null!==n)if(46===g.charCodeAt(m)?(r=".",m++):(r=null,0===v&&A('"."')),null!==r){if(null!==(i=u()))for(s=[];null!==i;)s.push(i),i=u();else s=null;null!==s?e=[e,t,n,r,s]:(e=null,m=a)}else e=null,m=a;else e=null,m=a}else e=null,m=a;else e=null,m=a;return null===(e=null!==e?void(L.sip_version=g.substring(m,o)):e)&&(m=o),e}function it(){var e;return"INVITE"===g.substr(m,6)?(e="INVITE",m+=6):(e=null,0===v&&A('"INVITE"')),e}function ot(){var e;return"ACK"===g.substr(m,3)?(e="ACK",m+=3):(e=null,0===v&&A('"ACK"')),e}function at(){var e;return"OPTIONS"===g.substr(m,7)?(e="OPTIONS",m+=7):(e=null,0===v&&A('"OPTIONS"')),e}function lt(){var e;return"BYE"===g.substr(m,3)?(e="BYE",m+=3):(e=null,0===v&&A('"BYE"')),e}function ut(){var e;return"CANCEL"===g.substr(m,6)?(e="CANCEL",m+=6):(e=null,0===v&&A('"CANCEL"')),e}function ct(){var e;return"REGISTER"===g.substr(m,8)?(e="REGISTER",m+=8):(e=null,0===v&&A('"REGISTER"')),e}function dt(){var e;return"SUBSCRIBE"===g.substr(m,9)?(e="SUBSCRIBE",m+=9):(e=null,0===v&&A('"SUBSCRIBE"')),e}function ht(){var e;return"NOTIFY"===g.substr(m,6)?(e="NOTIFY",m+=6):(e=null,0===v&&A('"NOTIFY"')),e}function _t(){var e;return"REFER"===g.substr(m,5)?(e="REFER",m+=5):(e=null,0===v&&A('"REFER"')),e}function ft(){var e,t=m;return null!==(e=null===(e=it())&&null===(e=ot())&&null===(e=at())&&null===(e=lt())&&null===(e=ut())&&null===(e=ct())&&null===(e=dt())&&null===(e=ht())&&null===(e=_t())?b():e)&&(L.method=g.substring(m,t),e=L.method),null===e&&(m=t),e}function pt(){var e,t,n,r,s,i=m;return null!==(e=st())&&null!==(t=h())&&null!==(n=gt())&&null!==(r=h())&&null!==(s=vt())?e=[e,t,n,r,s]:(e=null,m=i),e}function gt(){var e,t,n=m;return null!==(e=mt())&&(t=e,e=void(L.status_code=parseInt(t.join("")))),null===e&&(m=n),e}function mt(){var e,t,n,r=m;return null!==(e=u())&&null!==(t=u())&&null!==(n=u())?e=[e,t,n]:(e=null,m=r),e}function vt(){var e,t=m,n=[];for(null===(e=H())&&null===(e=r())&&null===(e=f())&&null===(e=T())&&null===(e=S())&&null===(e=h())&&(e=_());null!==e;)n.push(e),null===(e=H())&&null===(e=r())&&null===(e=f())&&null===(e=T())&&null===(e=S())&&null===(e=h())&&(e=_());return null===(n=null!==n?void(L.reason_phrase=g.substring(m,t)):n)&&(m=t),n}function At(){var e,t,n,r,s,i=m,o=m;if(null!==(e=null===(e=re())?N():e)){for(t=[],s=m,null!==(n=I())&&null!==(r=Ct())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=Ct())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(e=>{var t;L.multi_header||(L.multi_header=[]);try{t=new M(L.uri,L.display_name,L.params),delete L.uri,delete L.display_name,delete L.params}catch(e){t=null}L.multi_header.push({possition:m,offset:e,parsed:t})})(i):e)&&(m=i),e}function N(){var e,t,n,r,s=m;return null!==(e=null!==(e=yt())?e:"")&&null!==(t=z())&&null!==(n=se())&&null!==(r=K())?e=[e,t,n,r]:(e=null,m=s),e}function yt(){var e,t,n,r,s,i=m,o=m;if(null!==(e=b())){for(t=[],s=m,null!==(n=p())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=p())&&null!==(r=b())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null!==(e=null===e?te():e)&&(o=e,e=void(L.display_name="string"==typeof o?o:o[1].reduce(function(e,t){return e+t[0]+t[1]},o[0]))),null===e&&(m=i),e}function Ct(){var e;return e=null===(e=Tt())&&null===(e=St())?D():e}function Tt(){var e,t,n,r=m,s=m;return"q"===g.substr(m,1).toLowerCase()?(e=g.substr(m,1),m++):(e=null,0===v&&A('"q"')),null!==e&&null!==(n=w())&&null!==(t=bt())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],L.params||(L.params={}),e=void(L.params.q=n)),null===e&&(m=r),e}function St(){var e,t,n,r=m,s=m;return"expires"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"expires"')),null!==e&&null!==(n=w())&&null!==(t=P())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],L.params||(L.params={}),e=void(L.params.expires=n)),null===e&&(m=r),e}function P(){var e,t,n=m;if(null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null===(e=null!==e?parseInt(e.join("")):e)&&(m=n),e}function bt(){var e,t,n,r,s,i,o=m,a=m;return 48===g.charCodeAt(m)?(e="0",m++):(e=null,0===v&&A('"0"')),null!==e&&(i=m,46===g.charCodeAt(m)?(t=".",m++):(t=null,0===v&&A('"."')),null!==t&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")&&null!==(s=null!==(s=u())?s:"")?t=[t,n,r,s]:(t=null,m=i),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=a),null===(e=null!==e?parseFloat(g.substring(m,o)):e)&&(m=o),e}function D(){var e,t,n,r,s=m,i=m;return null!==(e=b())&&(r=m,null!==(t=w())&&null!==(n=Et())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=i),null!==e&&(n=e[0],r=e[1],L.params||(L.params={}),r=void 0===r?void 0:r[1],e=void(L.params[n.toLowerCase()]=r)),null===e&&(m=s),e}function Et(){var e;return e=null===(e=b())&&null===(e=_e())?ee():e}function wt(){var e;return"render"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"render"')),e=null===e&&("session"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"session"')),null===e)&&("icon"===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"icon"')),null===e)&&("alert"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"alert"')),null===e)?b():e}function Rt(){var e;return e=null===(e=It())?D():e}function It(){var e,t,n,r=m;return"handling"===g.substr(m,8).toLowerCase()?(e=g.substr(m,8),m+=8):(e=null,0===v&&A('"handling"')),null!==e&&null!==(t=w())&&("optional"===g.substr(m,8).toLowerCase()?(n=g.substr(m,8),m+=8):(n=null,0===v&&A('"optional"')),null!==(n=null===n&&("required"===g.substr(m,8).toLowerCase()?(n=g.substr(m,8),m+=8):(n=null,0===v&&A('"required"')),null===n)?b():n))?e=[e,t,n]:(e=null,m=r),e}function Ut(){var e,t,n,r,s,i,o,a=m;if(null!==(e=Ot()))if(null!==(t=G()))if(null!==(n=xt())){for(r=[],o=m,null!==(s=I())&&null!==(i=Mt())?s=[s,i]:(s=null,m=o);null!==s;)r.push(s),o=m,null!==(s=I())&&null!==(i=Mt())?s=[s,i]:(s=null,m=o);null!==r?e=[e,t,n,r]:(e=null,m=a)}else e=null,m=a;else e=null,m=a;else e=null,m=a;return e}function Ot(){var e;return e=null===(e=kt())?Nt():e}function kt(){var e;return"text"===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"text"')),e=null===e&&("image"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"image"')),null===e)&&("audio"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"audio"')),null===e)&&("video"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"video"')),null===e)&&("application"===g.substr(m,11).toLowerCase()?(e=g.substr(m,11),m+=11):(e=null,0===v&&A('"application"')),null===e)?Pt():e}function Nt(){var e;return"message"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"message"')),e=null===e&&("multipart"===g.substr(m,9).toLowerCase()?(e=g.substr(m,9),m+=9):(e=null,0===v&&A('"multipart"')),null===e)?Pt():e}function Pt(){var e;return e=null===(e=b())?Dt():e}function Dt(){var e,t,n=m;return"x-"===g.substr(m,2).toLowerCase()?(e=g.substr(m,2),m+=2):(e=null,0===v&&A('"x-"')),null!==e&&null!==(t=b())?e=[e,t]:(e=null,m=n),e}function xt(){var e;return e=null===(e=Pt())?b():e}function Mt(){var e,t,n,r=m;return null!==(e=b())&&null!==(t=w())&&null!==(n=Lt())?e=[e,t,n]:(e=null,m=r),e}function Lt(){var e;return e=null===(e=b())?ee():e}function qt(){var e,t,n,r=m;if(null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(n=e,e=void(L.value=parseInt(n.join("")))),null===e&&(m=r),e}function Ht(){var e,t,n,r,s,i=m;if(null!==(e=B())){for(t=[],s=m,46===g.charCodeAt(m)?(n=".",m++):(n=null,0===v&&A('"."')),null!==n&&null!==(r=B())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,46===g.charCodeAt(m)?(n=".",m++):(n=null,0===v&&A('"."')),null!==n&&null!==(r=B())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e}function Ft(){var e;return e=null===(e=jt())?D():e}function jt(){var e,t,n,r=m,s=m;return"tag"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"tag"')),null!==e&&null!==(n=w())&&null!==(t=b())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.tag=n)),null===e&&(m=r),e}function Vt(){var e,t,n,r,s,i,o,a=m;if("digest"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"Digest"')),null!==e)if(null!==(t=p()))if(null!==(n=Gt())){for(r=[],o=m,null!==(s=R())&&null!==(i=Gt())?s=[s,i]:(s=null,m=o);null!==s;)r.push(s),o=m,null!==(s=R())&&null!==(i=Gt())?s=[s,i]:(s=null,m=o);null!==r?e=[e,t,n,r]:(e=null,m=a)}else e=null,m=a;else e=null,m=a;else e=null,m=a;return e=null===e?Bt():e}function Bt(){var e,t,n,r,s,i,o,a=m;if(null!==(e=b()))if(null!==(t=p()))if(null!==(n=Wt())){for(r=[],o=m,null!==(s=R())&&null!==(i=Wt())?s=[s,i]:(s=null,m=o);null!==s;)r.push(s),o=m,null!==(s=R())&&null!==(i=Wt())?s=[s,i]:(s=null,m=o);null!==r?e=[e,t,n,r]:(e=null,m=a)}else e=null,m=a;else e=null,m=a;else e=null,m=a;return e}function Wt(){var e,t,n,r=m;return null!==(e=b())&&null!==(t=w())&&null!==(n=null===(n=b())?ee():n)?e=[e,t,n]:(e=null,m=r),e}function Gt(){var e;return e=null===(e=$t())&&null===(e=Kt())&&null===(e=Jt())&&null===(e=Qt())&&null===(e=Zt())&&null===(e=en())&&null===(e=tn())?Wt():e}function $t(){var e,t,n,r=m;return"realm"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"realm"')),null!==e&&null!==(t=w())&&null!==(n=Yt())?e=[e,t,n]:(e=null,m=r),e}function Yt(){var e,t,n=m;return null!==(e=te())&&(t=e,e=void(L.realm=t)),null===e&&(m=n),e}function Kt(){var e,t,n,r,s,i,o,a,l=m;if("domain"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"domain"')),null!==e)if(null!==(t=w()))if(null!==(n=X()))if(null!==(r=zt())){if(s=[],a=m,null!==(o=h()))for(i=[];null!==o;)i.push(o),o=h();else i=null;for(null!==i&&null!==(o=zt())?i=[i,o]:(i=null,m=a);null!==i;){if(s.push(i),a=m,null!==(o=h()))for(i=[];null!==o;)i.push(o),o=h();else i=null;null!==i&&null!==(o=zt())?i=[i,o]:(i=null,m=a)}null!==s&&null!==(i=Q())?e=[e,t,n,r,s,i]:(e=null,m=l)}else e=null,m=l;else e=null,m=l;else e=null,m=l;else e=null,m=l;return e}function zt(){var e;return e=null===(e=Ve())?Ge():e}function Jt(){var e,t,n,r=m;return"nonce"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"nonce"')),null!==e&&null!==(t=w())&&null!==(n=Xt())?e=[e,t,n]:(e=null,m=r),e}function Xt(){var e,t,n=m;return null!==(e=te())&&(t=e,e=void(L.nonce=t)),null===e&&(m=n),e}function Qt(){var e,t,n,r=m,s=m;return"opaque"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"opaque"')),null!==e&&null!==(n=w())&&null!==(t=te())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.opaque=n)),null===e&&(m=r),e}function Zt(){var e,t,n,r,s=m;return"stale"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"stale"')),null!==e&&null!==(t=w())&&(r=m,"true"===g.substr(m,4).toLowerCase()?(n=g.substr(m,4),m+=4):(n=null,0===v&&A('"true"')),null===(n=null!==n?void(L.stale=!0):n)&&(m=r),null===n&&(r=m,"false"===g.substr(m,5).toLowerCase()?(n=g.substr(m,5),m+=5):(n=null,0===v&&A('"false"')),null===(n=null!==n?void(L.stale=!1):n))&&(m=r),null!==n)?e=[e,t,n]:(e=null,m=s),e}function en(){var e,t,n,r=m,s=m;return"algorithm"===g.substr(m,9).toLowerCase()?(e=g.substr(m,9),m+=9):(e=null,0===v&&A('"algorithm"')),null!==e&&null!==(n=w())&&("md5"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"MD5"')),null!==(t=null===t&&("md5-sess"===g.substr(m,8).toLowerCase()?(t=g.substr(m,8),m+=8):(t=null,0===v&&A('"MD5-sess"')),null===t)?b():t))?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.algorithm=n.toUpperCase())),null===e&&(m=r),e}function tn(){var e,t,n,r,s,i,o,a,l,u=m;if("qop"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"qop"')),null!==e)if(null!==(t=w()))if(null!==(n=X())){if(a=m,null!==(r=nn())){for(s=[],l=m,44===g.charCodeAt(m)?(i=",",m++):(i=null,0===v&&A('","')),null!==i&&null!==(o=nn())?i=[i,o]:(i=null,m=l);null!==i;)s.push(i),l=m,44===g.charCodeAt(m)?(i=",",m++):(i=null,0===v&&A('","')),null!==i&&null!==(o=nn())?i=[i,o]:(i=null,m=l);null!==s?r=[r,s]:(r=null,m=a)}else r=null,m=a;null!==r&&null!==(s=Q())?e=[e,t,n,r,s]:(e=null,m=u)}else e=null,m=u;else e=null,m=u;else e=null,m=u;return e}function nn(){var e,t,n=m;return"auth-int"===g.substr(m,8).toLowerCase()?(e=g.substr(m,8),m+=8):(e=null,0===v&&A('"auth-int"')),null!==(e=null===e&&("auth"===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"auth"')),null===e)?b():e)&&(t=e,L.qop||(L.qop=[]),e=void L.qop.push(t.toLowerCase())),null===e&&(m=n),e}function rn(){var e,t,n,r,s,i=m,o=m;if(null!==(e=N())){for(t=[],s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=o)}else e=null,m=o;return null===(e=null!==e?(e=>{var t;L.multi_header||(L.multi_header=[]);try{t=new M(L.uri,L.display_name,L.params),delete L.uri,delete L.display_name,delete L.params}catch(e){t=null}L.multi_header.push({possition:m,offset:e,parsed:t})})(i):e)&&(m=i),e}function sn(){var e;return e=null===(e=on())?D():e}function on(){var e,t,n,r,s=m,i=m;if("cause"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"cause"')),null!==e)if(null!==(r=w())){if(null!==(n=u()))for(t=[];null!==n;)t.push(n),n=u();else t=null;null!==t?e=[e,r,t]:(e=null,m=i)}else e=null,m=i;else e=null,m=i;return null!==e&&(r=e[2],e=void(L.cause=parseInt(r.join("")))),null===e&&(m=s),e}function an(){var e,t,n,r,s,i=m;if(null!==(e=N())){for(t=[],s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==n;)t.push(n),s=m,null!==(n=I())&&null!==(r=D())?n=[n,r]:(n=null,m=s);null!==t?e=[e,t]:(e=null,m=i)}else e=null,m=i;return e}function ln(){var e,t=m;return"active"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"active"')),null===(e=null!==(e=null===e&&("pending"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"pending"')),null===e)&&("terminated"===g.substr(m,10).toLowerCase()?(e=g.substr(m,10),m+=10):(e=null,0===v&&A('"terminated"')),null===e)?b():e)?void(L.state=g.substring(m,t)):e)&&(m=t),e}function un(){var e,t,n,r,s=m,i=m;return"reason"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"reason"')),null!==e&&null!==(t=w())&&null!==(n=cn())?e=[e,t,n]:(e=null,m=i),null===(e=null!==e?void(void 0!==(r=e[2])&&(L.reason=r)):e)&&(m=s),e=null===e&&(i=s=m,"expires"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"expires"')),null!==e&&null!==(t=w())&&null!==(n=P())?e=[e,t,n]:(e=null,m=i),null===(e=null!==e?void(void 0!==(r=e[2])&&(L.expires=r)):e)&&(m=s),null===e)&&(i=s=m,"retry_after"===g.substr(m,11).toLowerCase()?(e=g.substr(m,11),m+=11):(e=null,0===v&&A('"retry_after"')),null!==e&&null!==(t=w())&&null!==(n=P())?e=[e,t,n]:(e=null,m=i),null===(e=null!==e?void(void 0!==(r=e[2])&&(L.retry_after=r)):e)&&(m=s),null===e)?D():e}function cn(){var e;return"deactivated"===g.substr(m,11).toLowerCase()?(e=g.substr(m,11),m+=11):(e=null,0===v&&A('"deactivated"')),e=null===e&&("probation"===g.substr(m,9).toLowerCase()?(e=g.substr(m,9),m+=9):(e=null,0===v&&A('"probation"')),null===e)&&("rejected"===g.substr(m,8).toLowerCase()?(e=g.substr(m,8),m+=8):(e=null,0===v&&A('"rejected"')),null===e)&&("timeout"===g.substr(m,7).toLowerCase()?(e=g.substr(m,7),m+=7):(e=null,0===v&&A('"timeout"')),null===e)&&("giveup"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"giveup"')),null===e)&&("noresource"===g.substr(m,10).toLowerCase()?(e=g.substr(m,10),m+=10):(e=null,0===v&&A('"noresource"')),null===e)&&("invariant"===g.substr(m,9).toLowerCase()?(e=g.substr(m,9),m+=9):(e=null,0===v&&A('"invariant"')),null===e)?b():e}function dn(){var e;return e=null===(e=jt())?D():e}function hn(){var e,t,n,r,s,i,o,a=m;if(null!==(e=yn()))if(null!==(t=p()))if(null!==(n=Sn())){for(r=[],o=m,null!==(s=I())&&null!==(i=_n())?s=[s,i]:(s=null,m=o);null!==s;)r.push(s),o=m,null!==(s=I())&&null!==(i=_n())?s=[s,i]:(s=null,m=o);null!==r?e=[e,t,n,r]:(e=null,m=a)}else e=null,m=a;else e=null,m=a;else e=null,m=a;return e}function _n(){var e;return e=null===(e=fn())&&null===(e=pn())&&null===(e=gn())&&null===(e=mn())&&null===(e=vn())?D():e}function fn(){var e,t,n,r=m,s=m;return"ttl"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"ttl"')),null!==e&&null!==(n=w())&&null!==(t=wn())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.ttl=n)),null===e&&(m=r),e}function pn(){var e,t,n,r=m,s=m;return"maddr"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"maddr"')),null!==e&&null!==(n=w())&&null!==(t=_e())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.maddr=n)),null===e&&(m=r),e}function gn(){var e,t,n,r=m,s=m;return"received"===g.substr(m,8).toLowerCase()?(e=g.substr(m,8),m+=8):(e=null,0===v&&A('"received"')),null!==e&&null!==(n=w())&&null!==(t=null===(t=Ae())?ve():t)?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.received=n)),null===e&&(m=r),e}function mn(){var e,t,n,r=m,s=m;return"branch"===g.substr(m,6).toLowerCase()?(e=g.substr(m,6),m+=6):(e=null,0===v&&A('"branch"')),null!==e&&null!==(n=w())&&null!==(t=b())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.branch=n)),null===e&&(m=r),e}function vn(){var e,t,n,r,s=m;return"rport"===g.substr(m,5).toLowerCase()?(e=g.substr(m,5),m+=5):(e=null,0===v&&A('"rport"')),null!==e&&(r=m,null!==(t=w())&&null!==(n=An())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=s),e}function An(){var e,t,n,r,s,i=m,o=m;return null!==(e=null!==(e=u())?e:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")?e=[e,s,t,n,r]:(e=null,m=o),null!==e&&(s=e,e=void(L.rport=parseInt(s.join("")))),null===e&&(m=i),e}function yn(){var e,t,n,r,s,i=m;return null!==(e=Cn())&&null!==(t=G())&&null!==(n=b())&&null!==(r=G())&&null!==(s=Tn())?e=[e,t,n,r,s]:(e=null,m=i),e}function Cn(){var e,t,n=m;return"sip"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"SIP"')),null!==(e=null===e?b():e)&&(t=e,e=void(L.protocol=t)),null===e&&(m=n),e}function Tn(){var e,t,n=m;return"udp"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"UDP"')),null!==(e=null===e&&("tcp"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"TCP"')),null===e)&&("tls"===g.substr(m,3).toLowerCase()?(e=g.substr(m,3),m+=3):(e=null,0===v&&A('"TLS"')),null===e)&&("sctp"===g.substr(m,4).toLowerCase()?(e=g.substr(m,4),m+=4):(e=null,0===v&&A('"SCTP"')),null===e)?b():e)&&(t=e,e=void(L.transport=t)),null===e&&(m=n),e}function Sn(){var e,t,n,r,s=m;return null!==(e=bn())&&(r=m,null!==(t=J())&&null!==(n=En())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=s),e}function bn(){var e,t=m;return null===(e=null!==(e=null===(e=Ae())&&null===(e=me())?fe():e)?void(L.host=g.substring(m,t)):e)&&(m=t),e}function En(){var e,t,n,r,s,i=m,o=m;return null!==(e=null!==(e=u())?e:"")&&null!==(s=null!==(s=u())?s:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")?e=[e,s,t,n,r]:(e=null,m=o),null!==e&&(s=e,e=void(L.port=parseInt(s.join("")))),null===e&&(m=i),e}function wn(){var e,t,n,r=m,s=m;return null!==(e=u())&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")?e=[e,t,n]:(e=null,m=s),null===(e=null!==e?parseInt(e.join("")):e)&&(m=r),e}function Rn(){var e,t,n=m;return null!==(e=P())&&(t=e,e=void(L.expires=t)),null===e&&(m=n),e}function In(){var e;return e=null===(e=Un())?D():e}function Un(){var e,t,n,r=m,s=m;return"refresher"===g.substr(m,9).toLowerCase()?(e=g.substr(m,9),m+=9):(e=null,0===v&&A('"refresher"')),null!==e&&null!==(n=w())&&("uac"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"uac"')),null===t&&("uas"===g.substr(m,3).toLowerCase()?(t=g.substr(m,3),m+=3):(t=null,0===v&&A('"uas"'))),null!==t)?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.refresher=n.toLowerCase())),null===e&&(m=r),e}function On(){var e,t=[];for(null===(e=C())&&null===(e=S())&&(e=p());null!==e;)t.push(e),null===(e=C())&&null===(e=S())&&(e=p());return t}function kn(){var e,t,n,r,s,i,o,a,l,u=m,c=m;return null!==(e=Nn())&&(45===g.charCodeAt(m)?(t="-",m++):(t=null,0===v&&A('"-"')),null!==t)&&null!==(n=x())&&(45===g.charCodeAt(m)?(r="-",m++):(r=null,0===v&&A('"-"')),null!==r)&&null!==(s=x())&&(45===g.charCodeAt(m)?(i="-",m++):(i=null,0===v&&A('"-"')),null!==i)&&null!==(o=x())&&(45===g.charCodeAt(m)?(a="-",m++):(a=null,0===v&&A('"-"')),null!==a)&&null!==(l=Pn())?e=[e,t,n,r,s,i,o,a,l]:(e=null,m=c),null!==e&&(e[0],e=void(L=g.substring(m+5,u))),null===e&&(m=u),e}function x(){var e,t,n,r,s=m;return null!==(e=a())&&null!==(t=a())&&null!==(n=a())&&null!==(r=a())?e=[e,t,n,r]:(e=null,m=s),e}function Nn(){var e,t,n=m;return null!==(e=x())&&null!==(t=x())?e=[e,t]:(e=null,m=n),e}function Pn(){var e,t,n,r=m;return null!==(e=x())&&null!==(t=x())&&null!==(n=x())?e=[e,t,n]:(e=null,m=r),e}function Dn(){var e,t,n,r,s=m,i=m;return null!==(e=E())&&(r=m,64===g.charCodeAt(m)?(t="@",m++):(t=null,0===v&&A('"@"')),null!==t&&null!==(n=E())?t=[t,n]:(t=null,m=r),null!==(t=null!==t?t:""))?e=[e,t]:(e=null,m=i),null===(e=null!==e?void(L.call_id=g.substring(m,s)):e)&&(m=s),e}function xn(){var e;return e=null===(e=Mn())&&null===(e=Ln())&&null===(e=qn())?D():e}function Mn(){var e,t,n,r=m,s=m;return"to-tag"===g.substr(m,6)?(e="to-tag",m+=6):(e=null,0===v&&A('"to-tag"')),null!==e&&null!==(n=w())&&null!==(t=b())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.to_tag=n)),null===e&&(m=r),e}function Ln(){var e,t,n,r=m,s=m;return"from-tag"===g.substr(m,8)?(e="from-tag",m+=8):(e=null,0===v&&A('"from-tag"')),null!==e&&null!==(n=w())&&null!==(t=b())?e=[e,n,t]:(e=null,m=s),null!==e&&(n=e[2],e=void(L.from_tag=n)),null===e&&(m=r),e}function qn(){var e,t=m;return"early-only"===g.substr(m,10)?(e="early-only",m+=10):(e=null,0===v&&A('"early-only"')),null===(e=null!==e?void(L.early_only=!0):e)&&(m=t),e}var Hn,Fn,jn=Vn("./URI"),M=Vn("./NameAddrHeader"),L={};return null===e[l]()||m!==g.length?(Hn=(e=Math.max(m,i))<g.length?g.charAt(e):null,Fn=(()=>{for(var e=1,t=1,n=!1,r=0;r<Math.max(m,i);r++)var s=g.charAt(r),n="\n"===s?(n||e++,!(t=1)):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,t=1,!0):(t++,!1);return{line:e,column:t}})(),new this.SyntaxError((e=>{e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n})(t),Hn,e,Fn.line,Fn.column),-1):L},toSource:function(){return this._source},SyntaxError:function(e,t,n,r,s){this.name="SyntaxError",this.expected=e,this.found=t,this.message=((e,t)=>{var n;switch(e.length){case 0:n="end of input";break;case 1:n=e[0];break;default:n=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}return"Expected "+n+" but "+(t?Bn(t):"end of input")+" found."})(e,t),this.offset=n,this.line=r,this.column=s}}).SyntaxError.prototype=Error.prototype,e)},{"./NameAddrHeader":11,"./URI":29}],8:[function(e,t,n){var r=e("../package.json"),s=e("./Constants"),i=e("./Exceptions"),o=e("./Utils"),a=e("./UA"),l=e("./URI"),u=e("./NameAddrHeader"),c=e("./Grammar"),d=e("./WebSocketInterface");e("debug")("JsSIP")("version %s",r.version),t.exports={C:s,Exceptions:i,Utils:o,UA:a,URI:l,NameAddrHeader:u,WebSocketInterface:d,Grammar:c,debug:e("debug"),get name(){return r.title},get version(){return r.version}}},{"../package.json":42,"./Constants":2,"./Exceptions":6,"./Grammar":7,"./NameAddrHeader":11,"./UA":28,"./URI":29,"./Utils":30,"./WebSocketInterface":31,debug:34}],9:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("debug"),i="JsSIP";function o(e){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");e?(this._debug=s.default("".concat(i,":").concat(e)),this._warn=s.default("".concat(i,":WARN:").concat(e)),this._error=s.default("".concat(i,":ERROR:").concat(e))):(this._debug=s.default(i),this._warn=s.default("".concat(i,":WARN")),this._error=s.default("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}t.exports=(r(o.prototype,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),o)},{debug:34}],10:[function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,r=e("./Logger"),d=e("./Constants"),h=e("./SIPMessage"),_=e("./Utils"),f=e("./RequestSender"),p=e("./Exceptions"),g=e("./URI"),m=new r("Message");t.exports=(()=>{var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=i,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==o(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function i(e){var t;if(this instanceof i)return(t=s.call(this))._ua=e,t._request=null,t._closed=!1,t._direction=null,t._local_identity=null,t._remote_identity=null,t._is_replied=!1,t._data={},t;throw new TypeError("Cannot call a class as a function")}return a(i.prototype,[{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"send",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(s));var i,s=_.cloneArray(r.extraHeaders),o=_.cloneObject(r.eventHandlers),a=r.contentType||"text/plain",l={};for(i in r.fromUserName&&(l.from_uri=new g("sip",r.fromUserName,this._ua.configuration.uri.host),s.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),r.fromDisplayName&&(l.from_display_name=r.fromDisplayName),o)Object.prototype.hasOwnProperty.call(o,i)&&this.on(i,o[i]);s.push("Content-Type: ".concat(a)),this._request=new h.OutgoingRequest(d.MESSAGE,e,this._ua,l,s),t&&(this._request.body=t);r=new f(this._ua,this._request,{onRequestTimeout:function(){n._onRequestTimeout()},onTransportError:function(){n._onTransportError()},onReceiveResponse:function(e){n._receiveResponse(e)}});this._newMessage("local",this._request),r.send()}},{key:"init_incoming",value:function(e){this._request=e,this._newMessage("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}},{key:"accept",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_.cloneArray(e.extraHeaders),e=e.body;if("incoming"!==this._direction)throw new p.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,t,e)}},{key:"reject",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.status_code||480,n=e.reason_phrase,r=_.cloneArray(e.extraHeaders),e=e.body;if("incoming"!==this._direction)throw new p.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(t<300||700<=t)throw new TypeError("Invalid status_code: ".concat(t));this._is_replied=!0,this._request.reply(t,n,r,e)}},{key:"_receiveResponse",value:function(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:var t=_.sipErrorCause(e.status_code);this._failed("remote",e,t)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,d.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,d.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newMessage(this,{originator:e,message:this,request:t})}},{key:"_failed",value:function(e,t,n){m.debug("MESSAGE failed"),this._close(),m.debug('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}},{key:"_succeeded",value:function(e,t){m.debug("MESSAGE succeeded"),this._close(),m.debug('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}}]),i})()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./URI":29,"./Utils":30,events:33}],11:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./URI"),i=e("./Grammar");function o(e,t,n){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");if(!(e&&e instanceof s))throw new TypeError('missing or invalid "uri" parameter');for(var r in this._uri=e,this._parameters={},this.display_name=t,n)Object.prototype.hasOwnProperty.call(n,r)&&this.setParam(r,n[r])}t.exports=(e=[{key:"parse",value:function(e){return-1!==(e=i.parse(e,"Name_Addr_Header"))?e:void 0}}],r((t=o).prototype,[{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(e){this._display_name=0===e?"0":e}},{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){var t;if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e))return t=this._parameters[e],delete this._parameters[e],t}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new o(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var e,t=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";for(e in t+="<".concat(this._uri.toString(),">"),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,e)&&(t+=";".concat(e),null!==this._parameters[e])&&(t+="=".concat(this._parameters[e]));return t}}]),r(t,e),o)},{"./Grammar":7,"./URI":29}],12:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(r){var s=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();return function(){var e,t,n=a(r);return e=s?(e=a(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),n=this,!(t=e)||"object"!==i(t)&&"function"!=typeof t?u(n):t}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,l=e("./Logger"),d=e("./Constants"),h=e("./Utils"),_=e("./Dialog"),f=new l("Notifier"),p={NOTIFY_RESPONSE_TIMEOUT:0,NOTIFY_TRANSPORT_ERROR:1,NOTIFY_NON_OK_RESPONSE:2,NOTIFY_FAILED_AUTHENTICATION:3,SEND_FINAL_NOTIFY:4,RECEIVE_UNSUBSCRIBE:5,SUBSCRIPTION_EXPIRED:6,STATE_PENDING:0,STATE_ACTIVE:1,STATE_TERMINATED:2};t.exports=(()=>{var e=l,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t);var a=o(l);function l(e,t,n,r){var s,i=r.extraHeaders,o=r.allowEvents,r=r.pending;if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");if(f.debug("new"),s=a.call(this),!t)throw new TypeError("subscribe is undefined");if(!n)throw new TypeError("contentType is undefined");s._ua=e,s._initial_subscribe=t,s._expires_timestamp=null,s._expires_timer=null,s._state=r?p.STATE_PENDING:p.STATE_ACTIVE,s._terminated_reason=null,s._terminated_retry_after=null,s.data={},s._dialog=null;e=t.getHeader("event"),s._content_type=n,s._expires=parseInt(t.getHeader("expires")),s._headers=h.cloneArray(i),s._headers.push("Event: ".concat(e)),s._contact=s._headers.find(function(e){return e.startsWith("Contact")}),s._contact||(s._contact="Contact: <sip:".concat(t.to.uri.user,"@").concat(h.createRandomToken(12),".invalid;transport=ws>"),s._headers.push(s._contact)),o&&s._headers.push("Allow-Events: ".concat(o)),s._target=t.from.uri.user,t.to_tag=h.newTag(),r=new _(u(s),t,"UAS");if(r.error)throw f.warn(r.error),new Error("SUBSCRIBE missed Contact");return s._dialog=r,0<s._expires&&s._setExpiresTimer(),s}return e=[{key:"C",get:function(){return p}}],r((t=l).prototype,[{key:"C",get:function(){return p}},{key:"receiveRequest",value:function(e){var t,n,r;e.method===d.SUBSCRIBE?(null==(t=e.getHeader("expires"))&&f.debug("Missed expires header. Set by default ".concat(t="900")),this._expires=parseInt(t),e.reply(200,null,["Expires: ".concat(this._expires),"".concat(this._contact)]),t=e.body,n=e.getHeader("content-type"),(r=0===this._expires)||this._setExpiresTimer(),f.debug('emit "subscribe"'),this.emit("subscribe",r,e,t,n),r&&this._dialogTerminated(p.RECEIVE_UNSUBSCRIBE)):e.reply(405)}},{key:"start",value:function(){f.debug("start()"),this.receiveRequest(this._initial_subscribe)}},{key:"setActiveState",value:function(){f.debug("setActiveState()"),this._state===p.STATE_PENDING&&(this._state=p.STATE_ACTIVE)}},{key:"notify",value:function(){var e,t,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;f.debug("notify()"),this._dialog?(e=this._stateNumberToString(this._state),this._state!==p.STATE_TERMINATED?(t=Math.floor((this._expires_timestamp-(new Date).getTime())/1e3),e+=";expires=".concat(t=t<0?0:t)):(this._terminated_reason&&(e+=";reason=".concat(this._terminated_reason)),null!==this._terminated_retry_after&&(e+=";retry-after=".concat(this._terminated_retry_after))),(t=this._headers.slice()).push("Subscription-State: ".concat(e)),r&&t.push("Content-Type: ".concat(this._content_type)),this._dialog.sendRequest(d.NOTIFY,{body:r,extraHeaders:t,eventHandlers:{onRequestTimeout:function(){n._dialogTerminated(p.NOTIFY_RESPONSE_TIMEOUT)},onTransportError:function(){n._dialogTerminated(p.NOTIFY_TRANSPORT_ERROR)},onErrorResponse:function(e){401===e.status_code||407===e.status_code?n._dialogTerminated(p.NOTIFY_FAILED_AUTHENTICATION):n._dialogTerminated(p.NOTIFY_NON_OK_RESPONSE)},onDialogError:function(){n._dialogTerminated(p.NOTIFY_NON_OK_RESPONSE)}}})):f.warn("final notify has sent")}},{key:"terminate",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;f.debug("terminate()"),this._state=p.STATE_TERMINATED,this._terminated_reason=t,this._terminated_retry_after=n,this.notify(e),this._dialogTerminated(p.SEND_FINAL_NOTIFY)}},{key:"state",get:function(){return this._state}},{key:"id",get:function(){return this._dialog?this._dialog.id:null}},{key:"_dialogTerminated",value:function(e){var t;this._dialog&&(this._state=p.STATE_TERMINATED,clearTimeout(this._expires_timer),this._dialog&&(this._dialog.terminate(),this._dialog=null),t=e===p.SUBSCRIPTION_EXPIRED,f.debug('emit "terminated" code='.concat(e,", send final notify=").concat(t)),this.emit("terminated",e,t))}},{key:"_setExpiresTimer",value:function(){var e=this;this._expires_timestamp=(new Date).getTime()+1e3*this._expires,clearTimeout(this._expires_timer),this._expires_timer=setTimeout(function(){e._dialog&&(e._terminated_reason="timeout",e.notify(),e._dialogTerminated(p.SUBSCRIPTION_EXPIRED))},1e3*this._expires)}},{key:"_stateNumberToString",value:function(e){switch(e){case p.STATE_PENDING:return"pending";case p.STATE_ACTIVE:return"active";case p.STATE_TERMINATED:return"terminated";default:throw new TypeError("wrong state value")}}}]),r(t,e),l})()},{"./Constants":2,"./Dialog":3,"./Logger":9,"./Utils":30,events:33}],13:[function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,r=e("./Logger"),d=e("./Constants"),h=e("./SIPMessage"),_=e("./Utils"),f=e("./RequestSender"),p=e("./Exceptions"),g=new r("Options");t.exports=(()=>{var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=i,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==o(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function i(e){var t;if(this instanceof i)return(t=s.call(this))._ua=e,t._request=null,t._closed=!1,t._direction=null,t._local_identity=null,t._remote_identity=null,t._is_replied=!1,t._data={},t;throw new TypeError("Cannot call a class as a function")}return a(i.prototype,[{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"send",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=e;if(void 0===e)throw new TypeError("A target is required for OPTIONS");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(s));var i,s=_.cloneArray(r.extraHeaders),o=_.cloneObject(r.eventHandlers),r=r.contentType||"application/sdp";for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&this.on(i,o[i]);s.push("Content-Type: ".concat(r)),this._request=new h.OutgoingRequest(d.OPTIONS,e,this._ua,null,s),t&&(this._request.body=t);r=new f(this._ua,this._request,{onRequestTimeout:function(){n._onRequestTimeout()},onTransportError:function(){n._onTransportError()},onReceiveResponse:function(e){n._receiveResponse(e)}});this._newOptions("local",this._request),r.send()}},{key:"init_incoming",value:function(e){this._request=e,this._newOptions("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}},{key:"accept",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_.cloneArray(e.extraHeaders),e=e.body;if("incoming"!==this._direction)throw new p.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,t,e)}},{key:"reject",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.status_code||480,n=e.reason_phrase,r=_.cloneArray(e.extraHeaders),e=e.body;if("incoming"!==this._direction)throw new p.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(t<300||700<=t)throw new TypeError("Invalid status_code: ".concat(t));this._is_replied=!0,this._request.reply(t,n,r,e)}},{key:"_receiveResponse",value:function(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:var t=_.sipErrorCause(e.status_code);this._failed("remote",e,t)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,d.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,d.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newOptions(this,{originator:e,message:this,request:t})}},{key:"_failed",value:function(e,t,n){g.debug("OPTIONS failed"),this._close(),g.debug('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}},{key:"_succeeded",value:function(e,t){g.debug("OPTIONS succeeded"),this._close(),g.debug('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}}]),i})()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30,events:33}],14:[function(e,t,n){function f(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?a(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var r=e("./Logger"),p=e("./Grammar"),g=e("./SIPMessage"),l=new r("Parser");n.parseMessage=function(e,t){var n,r,s=e.indexOf("\r\n");if(-1!==s){var i=e.substring(0,s),o=p.parse(i,"Request_Response");if(-1!==o){o.status_code?((n=new g.IncomingResponse).status_code=o.status_code,n.reason_phrase=o.reason_phrase):((n=new g.IncomingRequest(t)).method=o.method,n.ruri=o.uri),n.data=e;for(var a=s+2;;){if(-2===(s=((e,t)=>{var n,r=t,s=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===s;){if(-1===(n=e.indexOf("\r\n",r)))return n;!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)?r=n+2:s=n}return s})(e,a))){r=a+2;break}if(-1===s)return void l.warn("parseMessage() | malformed message");if(!0!==(o=((e,t,n,r)=>{var s,i=t.indexOf(":",n),o=t.substring(n,i).trim(),a=t.substring(i+1,r).trim();switch(o.toLowerCase()){case"via":case"v":e.addHeader("via",a),1===e.getHeaders("via").length?(s=e.parseHeader("Via"))&&(e.via=s,e.via_branch=s.branch):s=0;break;case"from":case"f":e.setHeader("from",a),(s=e.parseHeader("from"))&&(e.from=s,e.from_tag=s.getParam("tag"));break;case"to":case"t":e.setHeader("to",a),(s=e.parseHeader("to"))&&(e.to=s,e.to_tag=s.getParam("tag"));break;case"record-route":if(-1===(s=p.parse(a,"Record_Route")))s=void 0;else{var l,u=f(s);try{for(u.s();!(l=u.n()).done;){var c=l.value;e.addHeader("record-route",a.substring(c.possition,c.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=c.parsed}}catch(e){u.e(e)}finally{u.f()}}break;case"call-id":case"i":e.setHeader("call-id",a),(s=e.parseHeader("call-id"))&&(e.call_id=a);break;case"contact":case"m":if(-1===(s=p.parse(a,"Contact")))s=void 0;else{var d,h=f(s);try{for(h.s();!(d=h.n()).done;){var _=d.value;e.addHeader("contact",a.substring(_.possition,_.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=_.parsed}}catch(e){h.e(e)}finally{h.f()}}break;case"content-length":case"l":e.setHeader("content-length",a),s=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",a),s=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",a),(s=e.parseHeader("cseq"))&&(e.cseq=s.value),e instanceof g.IncomingResponse&&(e.method=s.method);break;case"max-forwards":e.setHeader("max-forwards",a),s=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",a),s=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",a),s=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",a),(s=e.parseHeader("session-expires"))&&(e.session_expires=s.expires,e.session_expires_refresher=s.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",a),(s=e.parseHeader("refer-to"))&&(e.refer_to=s);break;case"replaces":e.setHeader("replaces",a),(s=e.parseHeader("replaces"))&&(e.replaces=s);break;case"event":case"o":e.setHeader("event",a),(s=e.parseHeader("event"))&&(e.event=s);break;default:e.addHeader(o,a),s=0}return void 0!==s||{error:'error parsing header "'.concat(o,'"')}})(n,e,a,s)))return void l.warn("parseMessage() |",o.error);a=s+2}return n.hasHeader("content-length")?(t=n.getHeader("content-length"),n.body=e.substr(r,t)):n.body=e.substring(r),n}l.warn('parseMessage() | error parsing first line of SIP message: "'.concat(i,'"'))}else l.warn("parseMessage() | no CRLF found, not a SIP message")}},{"./Grammar":7,"./Logger":9,"./SIPMessage":22}],15:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?a(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=e("events").EventEmitter,h=e("sdp-transform"),r=e("./Logger"),b=e("./Constants"),E=e("./Exceptions"),_=e("./Transactions"),w=e("./Utils"),f=e("./Timers"),p=e("./SIPMessage"),g=e("./Dialog"),m=e("./RequestSender"),v=e("./RTCSession/DTMF"),A=e("./RTCSession/Info"),y=e("./RTCSession/ReferNotifier"),C=e("./RTCSession/ReferSubscriber"),T=e("./URI"),R=new r("RTCSession"),I={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},U=["audio","video"];t.exports=(()=>{var e=o,t=d;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t),n=o,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=c(n),t=(e=r?(e=c(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==i(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function o(e){var t;if(this instanceof o)return R.debug("new"),(t=s.call(this))._id=null,t._ua=e,t._status=I.STATUS_NULL,t._dialog=null,t._earlyDialogs={},t._contact=null,t._from_tag=null,t._to_tag=null,t._connection=null,t._connectionPromiseQueue=Promise.resolve(),t._request=null,t._is_canceled=!1,t._cancel_reason="",t._is_confirmed=!1,t._late_sdp=!1,t._rtcOfferConstraints=null,t._rtcAnswerConstraints=null,t._localMediaStream=null,t._localMediaStreamLocallyGenerated=!1,t._rtcReady=!0,t._iceReady=!1,t._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},t._direction=null,t._local_identity=null,t._remote_identity=null,t._start_time=null,t._end_time=null,t._tones=null,t._audioMuted=!1,t._videoMuted=!1,t._localHold=!1,t._remoteHold=!1,t._sessionTimers={enabled:t._ua.configuration.session_timers,refreshMethod:t._ua.configuration.session_timers_refresh_method,defaultExpires:b.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},t._referSubscribers={},t._data={},t;throw new TypeError("Cannot call a class as a function")}return e=[{key:"C",get:function(){return I}}],l((t=o).prototype,[{key:"C",get:function(){return I}},{key:"causes",get:function(){return b.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"status",get:function(){return this._status}},{key:"isInProgress",value:function(){switch(this._status){case I.STATUS_NULL:case I.STATUS_INVITE_SENT:case I.STATUS_1XX_RECEIVED:case I.STATUS_INVITE_RECEIVED:case I.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case I.STATUS_ANSWERED:case I.STATUS_WAITING_FOR_ACK:case I.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case I.STATUS_CANCELED:case I.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length?arguments[2]:void 0,s=(R.debug("connect()"),e),i=w.cloneObject(n.eventHandlers),o=w.cloneArray(n.extraHeaders),a=w.cloneObject(n.mediaConstraints,{audio:!0,video:!0}),l=n.mediaStream||null,u=w.cloneObject(n.pcConfig,{iceServers:[]}),c=n.rtcConstraints||null,d=n.rtcOfferConstraints||null;if(this._rtcOfferConstraints=d,this._rtcAnswerConstraints=n.rtcAnswerConstraints||null,this._data=n.data||this._data,void 0===e)throw new TypeError("Not enough arguments");if(this._status!==I.STATUS_NULL)throw new E.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new E.NotSupportedError("WebRTC not supported");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: ".concat(s));for(t in this._sessionTimers.enabled&&w.isDecimal(n.sessionTimersExpires)&&(n.sessionTimersExpires>=b.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=n.sessionTimersExpires:this._sessionTimers.defaultExpires=b.SESSION_EXPIRES),i)Object.prototype.hasOwnProperty.call(i,t)&&this.on(t,i[t]);this._from_tag=w.newTag();var s=n.anonymous||!1,h={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:s,outbound:!0}),s?(h.from_display_name="Anonymous",h.from_uri=new T("sip","anonymous","anonymous.invalid"),o.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),o.push("Privacy: id")):n.fromUserName&&(h.from_uri=new T("sip",n.fromUserName,this._ua.configuration.uri.host),o.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),n.fromDisplayName&&(h.from_display_name=n.fromDisplayName),o.push("Contact: ".concat(this._contact)),o.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&o.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new p.InitialOutgoingInviteRequest(e,this._ua,h,o),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(u,c),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,r&&r(this),this._newRTCSession("local",this._request),this._sendInitialRequest(a,d,l)}},{key:"init_incoming",value:function(e,t){var n,r=this,s=(R.debug("init_incoming()"),e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0);e.body&&"application/sdp"!==s?e.reply(415):(this._status=I.STATUS_INVITE_RECEIVED,this._from_tag=e.from_tag,this._id=e.call_id+this._from_tag,this._request=e,this._contact=this._ua.contact.toString(),e.hasHeader("expires")&&(n=1e3*e.getHeader("expires")),e.to_tag=w.newTag(),this._createDialog(e,"UAS",!0)?(e.body?this._late_sdp=!1:this._late_sdp=!0,this._status=I.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){e.reply(408),r._failed("local",null,b.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),n&&(this._timers.expiresTimer=setTimeout(function(){r._status===I.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),r._failed("system",null,b.causes.EXPIRES))},n)),this._direction="incoming",this._local_identity=e.to,this._remote_identity=e.from,t&&t(this),this._newRTCSession("remote",e),this._status!==I.STATUS_TERMINATED&&(s=["Contact: ".concat(this._contact)],void 0!==(n=this._ua.modes.ringing_header_mode)&&(Array.isArray(n)?s=s.concat(n):s.push(n)),e.reply(180,null,s),this._progress("local",null))):e.reply(500,"Missing Contact header field"))}},{key:"answer",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=(R.debug("answer()"),this._request),t=w.cloneArray(e.extraHeaders),s=w.cloneObject(e.mediaConstraints),i=e.mediaStream||null,o=w.cloneObject(e.pcConfig,{iceServers:[]}),a=e.rtcConstraints||null,l=e.rtcAnswerConstraints||null,u=w.cloneObject(e.rtcOfferConstraints),c=!1,d=!1,h=!1,_=!1;if(this._rtcAnswerConstraints=l,this._rtcOfferConstraints=e.rtcOfferConstraints||null,this._data=e.data||this._data,"incoming"!==this._direction)throw new E.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==I.STATUS_WAITING_FOR_ANSWER)throw new E.InvalidStateError(this._status);if(this._sessionTimers.enabled&&w.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=b.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=e.sessionTimersExpires:this._sessionTimers.defaultExpires=b.SESSION_EXPIRES),this._status=I.STATUS_ANSWERED,this._createDialog(r,"UAS")){clearTimeout(this._timers.userNoAnswerTimer),t.unshift("Contact: ".concat(this._contact));e=r.parseSDP();Array.isArray(e.media)||(e.media=[e.media]);var f,p=S(e.media);try{for(p.s();!(f=p.n()).done;){var g=f.value;"audio"===g.type&&(c=!0,g.direction&&"sendrecv"!==g.direction||(h=!0)),"video"===g.type&&(d=!0,g.direction&&"sendrecv"!==g.direction||(_=!0))}}catch(n){p.e(n)}finally{p.f()}if(i&&!1===s.audio){var m,v=S(i.getAudioTracks());try{for(v.s();!(m=v.n()).done;){var A=m.value;i.removeTrack(A)}}catch(n){v.e(n)}finally{v.f()}}if(i&&!1===s.video){var y,C=S(i.getVideoTracks());try{for(C.s();!(y=C.n()).done;){var T=y.value;i.removeTrack(T)}}catch(n){C.e(n)}finally{C.f()}}i||void 0!==s.audio||(s.audio=h),i||void 0!==s.video||(s.video=_),i||c||u.offerToReceiveAudio||(s.audio=!1),i||d||u.offerToReceiveVideo||(s.video=!1),this._createRTCConnection(o,a),Promise.resolve().then(function(){return i||(s.audio||s.video?(n._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(s).catch(function(e){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");throw r.reply(480),n._failed("local",null,b.causes.USER_DENIED_MEDIA_ACCESS),R.warn('emit "getusermediafailed" [error:%o]',e),n.emit("getusermediafailed",e),new Error("getUserMedia() failed")})):void 0)}).then(function(t){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");(n._localMediaStream=t)&&t.getTracks().forEach(function(e){n._connection.addTrack(e,t)})}).then(function(){var e,t;if(!n._late_sdp)return e={originator:"remote",type:"offer",sdp:r.body},R.debug('emit "sdp"'),n.emit("sdp",e),t=new RTCSessionDescription({type:"offer",sdp:e.sdp}),n._connectionPromiseQueue=n._connectionPromiseQueue.then(function(){return n._connection.setRemoteDescription(t)}).catch(function(e){throw r.reply(488),n._failed("system",null,b.causes.WEBRTC_ERROR),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")}),n._connectionPromiseQueue}).then(function(){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");return n._connecting(r),(n._late_sdp?n._createLocalDescription("offer",n._rtcOfferConstraints):n._createLocalDescription("answer",l)).catch(function(){throw r.reply(500),new Error("_createLocalDescription() failed")})}).then(function(e){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");n._handleSessionTimersInIncomingRequest(r,t),r.reply(200,null,t,e,function(){n._status=I.STATUS_WAITING_FOR_ACK,n._setInvite2xxTimer(r,e),n._setACKTimer(),n._accepted("local")},function(){n._failed("system",null,b.causes.CONNECTION_ERROR)})}).catch(function(e){n._status!==I.STATUS_TERMINATED&&R.warn(e)})}else r.reply(500,"Error creating dialog")}},{key:"terminate",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};R.debug("terminate()");var n,r,s=e.cause||b.causes.BYE,i=w.cloneArray(e.extraHeaders),o=e.body,a=e.status_code,l=e.reason_phrase;if(this._status===I.STATUS_TERMINATED)throw new E.InvalidStateError(this._status);switch(this._status){case I.STATUS_NULL:case I.STATUS_INVITE_SENT:case I.STATUS_1XX_RECEIVED:if(R.debug("canceling session"),a&&(a<200||700<=a))throw new TypeError("Invalid status_code: ".concat(a));a&&(l=l||b.REASON_PHRASE[a]||"",n="SIP ;cause=".concat(a,' ;text="').concat(l,'"')),this._status===I.STATUS_NULL||this._status===I.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=n):this._status===I.STATUS_1XX_RECEIVED&&this._request.cancel(n),this._status=I.STATUS_CANCELED,this._failed("local",null,b.causes.CANCELED);break;case I.STATUS_WAITING_FOR_ANSWER:case I.STATUS_ANSWERED:if(R.debug("rejecting session"),(a=a||480)<300||700<=a)throw new TypeError("Invalid status_code: ".concat(a));this._request.reply(a,l,i,o),this._failed("local",null,b.causes.REJECTED);break;case I.STATUS_WAITING_FOR_ACK:case I.STATUS_CONFIRMED:if(R.debug("terminating session"),l=e.reason_phrase||b.REASON_PHRASE[a]||"",a&&(a<200||700<=a))throw new TypeError("Invalid status_code: ".concat(a));a&&i.push("Reason: SIP ;cause=".concat(a,'; text="').concat(l,'"')),this._status===I.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==_.C.STATUS_TERMINATED?(r=this._dialog,this.receiveRequest=function(e){e.method===b.ACK&&(t.sendRequest(b.BYE,{extraHeaders:i,body:o}),r.terminate())},this._request.server_transaction.on("stateChanged",function(){t._request.server_transaction.state===_.C.STATUS_TERMINATED&&(t.sendRequest(b.BYE,{extraHeaders:i,body:o}),r.terminate())}),this._ended("local",null,s),this._dialog=r,this._ua.newDialog(r)):(this.sendRequest(b.BYE,{extraHeaders:i,body:o}),this._ended("local",null,s))}}},{key:"sendDTMF",value:function(e){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(R.debug("sendDTMF() | tones: %s",e),0),o=s.duration||null,a=s.interToneGap||null,t=s.transportType||b.DTMF_TRANSPORT.INFO;if(void 0===e)throw new TypeError("Not enough arguments");if(this._status!==I.STATUS_CONFIRMED&&this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_1XX_RECEIVED)throw new E.InvalidStateError(this._status);if(t!==b.DTMF_TRANSPORT.INFO&&t!==b.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(t));if(!(e="number"==typeof e?e.toString():e)||"string"!=typeof e||!e.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(e));if(o&&!w.isDecimal(o))throw new TypeError("Invalid tone duration: ".concat(o));if(o=o?o<v.C.MIN_DURATION?(R.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(v.C.MIN_DURATION," milliseconds")),v.C.MIN_DURATION):o>v.C.MAX_DURATION?(R.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(v.C.MAX_DURATION," milliseconds")),v.C.MAX_DURATION):Math.abs(o):v.C.DEFAULT_DURATION,s.duration=o,a&&!w.isDecimal(a))throw new TypeError("Invalid interToneGap: ".concat(a));a=a?a<v.C.MIN_INTER_TONE_GAP?(R.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(v.C.MIN_INTER_TONE_GAP," milliseconds")),v.C.MIN_INTER_TONE_GAP):Math.abs(a):v.C.DEFAULT_INTER_TONE_GAP,t!==b.DTMF_TRANSPORT.RFC2833?this._tones?this._tones+=e:(this._tones=e,function e(){var t,n,r=this;this._status===I.STATUS_TERMINATED||!this._tones||i>=this._tones.length?this._tones=null:(t=this._tones[i],i+=1,n=","===t?2e3:(n=new v(this),s.eventHandlers={onFailed:function(){r._tones=null}},n.send(t,s),o+a),setTimeout(e.bind(this),n))}.call(this)):(t=this._getDTMFRTPSender())&&(e=t.toneBuffer+e,t.insertDTMF(e,o,a))}},{key:"sendInfo",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(R.debug("sendInfo()"),this._status!==I.STATUS_CONFIRMED&&this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_1XX_RECEIVED)throw new E.InvalidStateError(this._status);new A(this).send(e,t,n)}},{key:"mute",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!1},t=(R.debug("mute()"),!1),n=!1;!1===this._audioMuted&&e.audio&&(this._audioMuted=t=!0,this._toggleMuteAudio(!0)),!1===this._videoMuted&&e.video&&(this._videoMuted=n=!0,this._toggleMuteVideo(!0)),!0!==t&&!0!==n||this._onmute({audio:t,video:n})}},{key:"unmute",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},t=(R.debug("unmute()"),!1),n=!1;!0===this._audioMuted&&e.audio&&(this._audioMuted=!(t=!0))===this._localHold&&this._toggleMuteAudio(!1),!0===this._videoMuted&&e.video&&(this._videoMuted=!(n=!0))===this._localHold&&this._toggleMuteVideo(!1),!0!==t&&!0!==n||this._onunmute({audio:t,video:n})}},{key:"hold",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;if(R.debug("hold()"),this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:b.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"unhold",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;if(R.debug("unhold()"),this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:b.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"renegotiate",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length?arguments[1]:void 0,s=(R.debug("renegotiate()"),n.rtcOfferConstraints||null);return!(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED||!this._isReadyToReOffer()||(e={succeeded:function(){r&&r()},failed:function(){t.terminate({cause:b.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},this._setLocalMediaStatus(),n.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:e,rtcOfferConstraints:s,extraHeaders:n.extraHeaders}):this._sendReinvite({eventHandlers:e,rtcOfferConstraints:s,extraHeaders:n.extraHeaders}),0))}},{key:"refer",value:function(e,t){var n,r,s=this,i=(R.debug("refer()"),e);if(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;if(e=this._ua.normalizeTarget(e))return(n=new C(this)).sendRefer(e,t),r=n.id,(this._referSubscribers[r]=n).on("requestFailed",function(){delete s._referSubscribers[r]}),n.on("accepted",function(){delete s._referSubscribers[r]}),n.on("failed",function(){delete s._referSubscribers[r]}),n;throw new TypeError("Invalid target: ".concat(i))}},{key:"sendRequest",value:function(e,t){return R.debug("sendRequest()"),this._dialog.sendRequest(e,t)}},{key:"receiveRequest",value:function(e){var t=this;if(R.debug("receiveRequest()"),e.method===b.CANCEL)this._status!==I.STATUS_WAITING_FOR_ANSWER&&this._status!==I.STATUS_ANSWERED||(this._status=I.STATUS_CANCELED,this._request.reply(487),this._failed("remote",e,b.causes.CANCELED));else switch(e.method){case b.ACK:if(this._status===I.STATUS_WAITING_FOR_ACK)if(this._status=I.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!e.body){this.terminate({cause:b.causes.MISSING_SDP,status_code:400});break}var n={originator:"remote",type:"answer",sdp:e.body},r=(R.debug('emit "sdp"'),this.emit("sdp",n),new RTCSessionDescription({type:"answer",sdp:n.sdp}));this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._connection.setRemoteDescription(r)}).then(function(){t._is_confirmed||t._confirmed("remote",e)}).catch(function(e){t.terminate({cause:b.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)})}else this._is_confirmed||this._confirmed("remote",e);break;case b.BYE:this._status===I.STATUS_CONFIRMED||this._status===I.STATUS_WAITING_FOR_ACK?(e.reply(200),this._ended("remote",e,b.causes.BYE)):this._status===I.STATUS_INVITE_RECEIVED||this._status===I.STATUS_WAITING_FOR_ANSWER?(e.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",e,b.causes.BYE)):e.reply(403,"Wrong Status");break;case b.INVITE:this._status===I.STATUS_CONFIRMED?e.hasHeader("replaces")?this._receiveReplaces(e):this._receiveReinvite(e):e.reply(403,"Wrong Status");break;case b.INFO:this._status===I.STATUS_1XX_RECEIVED||this._status===I.STATUS_WAITING_FOR_ANSWER||this._status===I.STATUS_ANSWERED||this._status===I.STATUS_WAITING_FOR_ACK||this._status===I.STATUS_CONFIRMED?(n=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0)&&n.match(/^application\/dtmf-relay/i)?new v(this).init_incoming(e):void 0!==n?new A(this).init_incoming(e):e.reply(415):e.reply(403,"Wrong Status");break;case b.UPDATE:this._status===I.STATUS_CONFIRMED?this._receiveUpdate(e):e.reply(403,"Wrong Status");break;case b.REFER:this._status===I.STATUS_CONFIRMED?this._receiveRefer(e):e.reply(403,"Wrong Status");break;case b.NOTIFY:n={event:e.event,request:e,taken:!1};(this.emit("sipEvent",n),n.taken)?e.reply(200):this._status===I.STATUS_CONFIRMED?this._receiveNotify(e):e.reply(403,"Wrong Status");break;default:e.reply(501)}}},{key:"onTransportError",value:function(){R.warn("onTransportError()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:b.causes.CONNECTION_ERROR,cause:b.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){R.warn("onRequestTimeout()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:b.causes.REQUEST_TIMEOUT,cause:b.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){R.warn("onDialogError()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:b.causes.DIALOG_ERROR,cause:b.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(e){R.debug("newDTMF()"),this.emit("newDTMF",e)}},{key:"newInfo",value:function(e){R.debug("newInfo()"),this.emit("newInfo",e)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(R.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(R.debug("_isReadyToReOffer() | session not established yet"),!1):(R.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(R.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(R.debug("close() | closing local MediaStream"),w.closeMediaStream(this._localMediaStream)),this._status!==I.STATUS_TERMINATED){if(this._status=I.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(e){R.warn("close() | error closing the RTCPeerConnection: %o",e)}for(var e in this._timers)Object.prototype.hasOwnProperty.call(this._timers,e)&&clearTimeout(this._timers[e]);for(var t in clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog),this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,t)&&(this._earlyDialogs[t].terminate(),delete this._earlyDialogs[t]);for(var n in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,n)&&delete this._referSubscribers[n];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(t,n){var r=f.T1;this._timers.invite2xxTimer=setTimeout(function e(){this._status===I.STATUS_WAITING_FOR_ACK&&(t.reply(200,null,["Contact: ".concat(this._contact)],n),r<f.T2&&(r*=2)>f.T2&&(r=f.T2),this._timers.invite2xxTimer=setTimeout(e.bind(this),r))}.bind(this),r)}},{key:"_setACKTimer",value:function(){var e=this;this._timers.ackTimer=setTimeout(function(){e._status===I.STATUS_WAITING_FOR_ACK&&(R.debug("no ACK received, terminating the session"),clearTimeout(e._timers.invite2xxTimer),e.sendRequest(b.BYE),e._ended("remote",null,b.causes.NO_ACK))},f.TIMER_H)}},{key:"_createRTCConnection",value:function(e,t){var n=this;this._connection=new RTCPeerConnection(e,t),this._connection.addEventListener("iceconnectionstatechange",function(){var t,e=n._connection.iceConnectionState;"failed"===e&&n.terminate({cause:b.causes.RTP_TIMEOUT,status_code:408,reason_phrase:b.causes.RTP_TIMEOUT}),void 0!==n._ua.modes.chrome_rtp_timeout_fix&&navigator.webkitGetUserMedia&&"disconnected"===e&&(t=n._ua.modes.chrome_rtp_timeout_fix,R.debug("AC: Chrome RTP timeout fix: iceConnectionState==disconnected: check that this will continue for ".concat(t," seconds...")),function e(){"disconnected"===n._connection.iceConnectionState?0<t--?setTimeout(e,1e3):(R.debug("AC: Chrome RTP timeout fix: Hangup call"),n.terminate({cause:b.causes.RTP_TIMEOUT,status_code:408,reason_phrase:b.causes.RTP_TIMEOUT})):R.debug("AC: Chrome RTP timeout fix: iceConnectionState=".concat(n._connection.iceConnectionState))}())}),R.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(o,t){var a=this;if(R.debug("createLocalDescription()"),"offer"!==o&&"answer"!==o)throw new Error('createLocalDescription() | invalid type "'.concat(o,'"'));var l=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return"offer"===o?l.createOffer(t).catch(function(e){return R.warn('emit "peerconnection:createofferfailed" [error:%o]',e),a.emit("peerconnection:createofferfailed",e),Promise.reject(e)}):l.createAnswer(t).catch(function(e){return R.warn('emit "peerconnection:createanswerfailed" [error:%o]',e),a.emit("peerconnection:createanswerfailed",e),Promise.reject(e)})}).then(function(e){return l.setLocalDescription(e).catch(function(e){return a._rtcReady=!0,R.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',e),a.emit("peerconnection:setlocaldescriptionfailed",e),Promise.reject(e)})}).then(function(){var e=t&&t.iceRestart;return"complete"===l.iceGatheringState&&!e||"gathering"===l.iceGatheringState&&a._iceReady?(a._rtcReady=!0,e={originator:"local",type:o,sdp:l.localDescription.sdp},R.debug('emit "sdp"'),a.emit("sdp",e),Promise.resolve(e.sdp)):new Promise(function(t){function n(){l.removeEventListener("icecandidate",r),l.removeEventListener("icegatheringstatechange",s),i=!0,a._rtcReady=!0,a._iceReady=!0;var e={originator:"local",type:o,sdp:l.localDescription.sdp};R.debug('emit "sdp"'),a.emit("sdp",e),t(e.sdp)}var r,s,i=!1;a._iceReady=!1;l.addEventListener("icecandidate",r=function(e){e=e.candidate;e?a.emit("icecandidate",{candidate:e,ready:n}):i||n()}),l.addEventListener("icegatheringstatechange",s=function(){"complete"!==l.iceGatheringState||i||n()}),void 0!==a._ua.modes.ice_timeout_fix&&setTimeout(function(){i||(R.debug("AC: ICE gathering timeout fix"),n())},a._ua.modes.ice_timeout_fix)})})}},{key:"_createDialog",value:function(e,t,n){var r="UAS"===t?e.to_tag:e.from_tag,s="UAS"===t?e.from_tag:e.to_tag,r=e.call_id+r+s,s=this._earlyDialogs[r];return n?!!s||((s=new g(this,e,t,g.C.STATUS_EARLY)).error?(R.debug(s.error),this._failed("remote",e,b.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[r]=s,!0)):(this._from_tag=e.from_tag,this._to_tag=e.to_tag,s?(s.update(e,t),this._dialog=s,delete this._earlyDialogs[r],!0):(n=new g(this,e,t)).error?(R.debug(n.error),this._failed("remote",e,b.causes.INTERNAL_ERROR),!1):(this._dialog=n,!0))}},{key:"_receiveReinvite",value:function(r){var t=this,e=(R.debug("receiveReinvite()"),r.hasHeader("Content-Type")?r.getHeader("Content-Type").toLowerCase():void 0),s={request:r,callback:void 0,reject:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(i=!0,e.status_code||403),n=e.reason_phrase||"",e=w.cloneArray(e.extraHeaders);if(this._status!==I.STATUS_CONFIRMED)return!1;if(t<300||700<=t)throw new TypeError("Invalid status_code: ".concat(t));r.reply(t,n,e)}.bind(this)},i=!1;function n(e){var t=this,n=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(r,n),this._late_sdp&&(e=this._mangleOffer(e)),r.reply(200,null,n,e,function(){t._status=I.STATUS_WAITING_FOR_ACK,t._setInvite2xxTimer(r,e),t._setACKTimer()}),"function"==typeof s.callback&&s.callback()}this.emit("reinvite",s),i||(this._late_sdp=!1,r.body?"application/sdp"!==e?(R.debug("invalid Content-Type"),r.reply(415)):this._processInDialogSdpOffer(r).then(function(e){t._status!==I.STATUS_TERMINATED&&n.call(t,e)}).catch(function(e){R.warn(e)}):(this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._createLocalDescription("offer",t._rtcOfferConstraints)}).then(function(e){n.call(t,e)}).catch(function(){r.reply(500)})))}},{key:"_receiveUpdate",value:function(r){var t=this,e=(R.debug("receiveUpdate()"),r.hasHeader("Content-Type")?r.getHeader("Content-Type").toLowerCase():void 0),n={request:r,callback:void 0,reject:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(s=!0,e.status_code||403),n=e.reason_phrase||"",e=w.cloneArray(e.extraHeaders);if(this._status!==I.STATUS_CONFIRMED)return!1;if(t<300||700<=t)throw new TypeError("Invalid status_code: ".concat(t));r.reply(t,n,e)}.bind(this)},s=!1;function i(e){var t=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(r,t),r.reply(200,null,t,e),"function"==typeof n.callback&&n.callback()}this.emit("update",n),s||(r.body?"application/sdp"!==e?(R.debug("invalid Content-Type"),r.reply(415)):this._processInDialogSdpOffer(r).then(function(e){t._status!==I.STATUS_TERMINATED&&i.call(t,e)}).catch(function(e){R.warn(e)}):i.call(this,null))}},{key:"_processInDialogSdpOffer",value:function(t){var n=this;R.debug("_processInDialogSdpOffer()");var e,r=t.parseSDP(),s=!1,i=S(r.media);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(-1!==U.indexOf(o.type)){var a=o.direction||r.direction||"sendrecv";if("sendonly"!==a&&"inactive"!==a){s=!1;break}s=!0}}}catch(t){i.e(t)}finally{i.f()}var l={originator:"remote",type:"offer",sdp:t.body},u=(R.debug('emit "sdp"'),this.emit("sdp",l),new RTCSessionDescription({type:"offer",sdp:l.sdp}));return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");return n._connection.setRemoteDescription(u).catch(function(e){throw t.reply(488),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e),e})}).then(function(){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");!0===n._remoteHold&&!1===s?(n._remoteHold=!1,n._onunhold("remote")):!1===n._remoteHold&&!0===s&&(n._remoteHold=!0,n._onhold("remote"))}).then(function(){if(n._status===I.STATUS_TERMINATED)throw new Error("terminated");return n._createLocalDescription("answer",n._rtcAnswerConstraints).catch(function(e){throw t.reply(500),R.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',e),e})}).catch(function(e){R.warn("_processInDialogSdpOffer() failed [error: %o]",e)}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(s){var i,n=this;R.debug("receiveRefer()"),s.refer_to?s.refer_to.uri.scheme!==b.SIP?(R.debug("Refer-To header field points to a non-SIP URI scheme"),s.reply(416)):(s.reply(202),i=new y(this,s.cseq),R.debug('emit "refer"'),this.emit("refer",{request:s,accept:function(e,t){!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e="function"==typeof e?e:null,this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;var n,r=new o(this._ua);r.on("progress",function(e){e=e.response;i.notify(e.status_code,e.reason_phrase)}),r.on("accepted",function(e){e=e.response;i.notify(e.status_code,e.reason_phrase)}),r.on("_failed",function(e){var t=e.message,e=e.cause;t?i.notify(t.status_code,t.reason_phrase):i.notify(487,e)}),s.refer_to.uri.hasHeader("replaces")&&(n=decodeURIComponent(s.refer_to.uri.getHeader("replaces")),t.extraHeaders=w.cloneArray(t.extraHeaders),t.extraHeaders.push("Replaces: ".concat(n))),r.connect(s.refer_to.uri.toAor(),t,e)}.call(n,e,t)},reject:function(){!function(){i.notify(603)}.call(n)}})):(R.debug("no Refer-To header field present in REFER"),s.reply(400))}},{key:"_receiveNotify",value:function(e){if("refer"===(R.debug("receiveNotify()"),e.event||e.reply(400),e.event.event)){var t;if(e.event.params&&e.event.params.id)t=e.event.params.id,t=this._referSubscribers[t];else{if(1!==Object.keys(this._referSubscribers).length)return void e.reply(400,"Missing event id parameter");t=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}t?(t.receiveNotify(e),e.reply(200)):e.reply(481,"Subscription does not exist")}else e.reply(489)}},{key:"_receiveReplaces",value:function(r){var t=this;R.debug("receiveReplaces()"),this.emit("replaces",{request:r,accept:function(e){!function(e){var t=this;if(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;var n=new o(this._ua);n.on("confirmed",function(){t.terminate()}),n.init_incoming(r,e)}.call(t,e)},reject:function(){!function(){R.debug("Replaced INVITE rejected by the user"),r.reply(486)}.call(t)}})}},{key:"_sendInitialRequest",value:function(e,n,t){var r=this,s=new m(this._ua,this._request,{onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},onAuthenticated:function(e){r._request=e},onReceiveResponse:function(e){r._receiveInviteResponse(e)}});Promise.resolve().then(function(){return t||(e.audio||e.video?(r._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).catch(function(e){if(r._status===I.STATUS_TERMINATED)throw new Error("terminated");throw r._failed("local",null,b.causes.USER_DENIED_MEDIA_ACCESS),R.warn('emit "getusermediafailed" [error:%o]',e),r.emit("getusermediafailed",e),e})):void 0)}).then(function(t){if(r._status===I.STATUS_TERMINATED)throw new Error("terminated");return(r._localMediaStream=t)&&t.getTracks().forEach(function(e){r._connection.addTrack(e,t)}),r._connecting(r._request),r._createLocalDescription("offer",n).catch(function(e){throw r._failed("local",null,b.causes.WEBRTC_ERROR),e})}).then(function(e){if(r._is_canceled||r._status===I.STATUS_TERMINATED)throw new Error("terminated");r._request.body=e,r._status=I.STATUS_INVITE_SENT,R.debug('emit "sending" [request:%o]',r._request),r.emit("sending",{request:r._request}),s.send()}).catch(function(e){r._status!==I.STATUS_TERMINATED&&R.warn(e)})}},{key:"_getDTMFRTPSender",value:function(){var e=this._connection.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});if(e&&e.dtmf)return e.dtmf;R.warn("sendDTMF() | no local audio track to send DTMF with")}},{key:"_receiveInviteResponse",value:function(t){var e,n,r,s=this;if(R.debug("receiveInviteResponse()"),this._dialog&&200<=t.status_code&&t.status_code<=299)return this._dialog.id.call_id===t.call_id&&this._dialog.id.local_tag===t.from_tag&&this._dialog.id.remote_tag===t.to_tag?void this.sendRequest(b.ACK):void 0!==(e=new g(this,t,"UAC")).error?void R.debug(e.error):(this.sendRequest(b.ACK),void this.sendRequest(b.BYE));if(this._is_canceled)100<=t.status_code&&t.status_code<200?this._request.cancel(this._cancel_reason):200<=t.status_code&&t.status_code<299&&this._acceptAndTerminate(t);else if(this._status===I.STATUS_INVITE_SENT||this._status===I.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(t.status_code):this._status=I.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(t.status_code):t.to_tag?t.hasHeader("contact")&&!this._createDialog(t,"UAC",!0)||(this._status=I.STATUS_1XX_RECEIVED,t.body?(i={originator:"remote",type:"answer",sdp:t.body},R.debug('emit "sdp"'),this.emit("sdp",i),n=new RTCSessionDescription({type:"answer",sdp:i.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return s._connection.setRemoteDescription(n)}).then(function(){return s._progress("remote",t)}).catch(function(e){R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),s.emit("peerconnection:setremotedescriptionfailed",e)})):this._progress("remote",t)):R.debug("1xx response received without to tag");break;case/^2[0-9]{2}$/.test(t.status_code):(this._status=I.STATUS_CONFIRMED,t.body)?this._createDialog(t,"UAC")&&(i={originator:"remote",type:"answer",sdp:t.body},R.debug('emit "sdp"'),this.emit("sdp",i),r=new RTCSessionDescription({type:"answer",sdp:i.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if("stable"===s._connection.signalingState)return s._connection.createOffer(s._rtcOfferConstraints).then(function(e){return s._connection.setLocalDescription(e)}).catch(function(e){s._acceptAndTerminate(t,500,e.toString()),s._failed("local",t,b.causes.WEBRTC_ERROR)})}).then(function(){s._connection.setRemoteDescription(r).then(function(){s._handleSessionTimersInIncomingResponse(t),s._accepted("remote",t),s.sendRequest(b.ACK),s._confirmed("local",null)}).catch(function(e){s._acceptAndTerminate(t,488,"Not Acceptable Here"),s._failed("remote",t,b.causes.BAD_MEDIA_DESCRIPTION),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),s.emit("peerconnection:setremotedescriptionfailed",e)})})):(this._acceptAndTerminate(t,400,b.causes.MISSING_SDP),this._failed("remote",t,b.causes.BAD_MEDIA_DESCRIPTION));break;default:var i=w.sipErrorCause(t.status_code);this._failed("remote",t,i)}}},{key:"_sendReinvite",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=(R.debug("sendReinvite()"),w.cloneArray(e.extraHeaders)),s=w.cloneObject(e.eventHandlers),t=e.rtcOfferConstraints||this._rtcOfferConstraints||null,i=!1;function o(e){s.failed&&s.failed(e)}r.push("Contact: ".concat(this._contact)),r.push("Content-Type: application/sdp"),this._sessionTimers.running&&r.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return n._createLocalDescription("offer",t)}).then(function(e){var t={originator:"local",type:"offer",sdp:e=n._mangleOffer(e)};R.debug('emit "sdp"'),n.emit("sdp",t),n.sendRequest(b.INVITE,{extraHeaders:r,body:e,eventHandlers:{onSuccessResponse:function(e){(function(e){var t,n,r=this;this._status===I.STATUS_TERMINATED||(this.sendRequest(b.ACK),i)||(this._handleSessionTimersInIncomingResponse(e),e.body&&e.hasHeader("Content-Type")&&"application/sdp"===e.getHeader("Content-Type").toLowerCase()?(t={originator:"remote",type:"answer",sdp:e.body},R.debug('emit "sdp"'),this.emit("sdp",t),n=new RTCSessionDescription({type:"answer",sdp:t.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return r._connection.setRemoteDescription(n)}).then(function(){s.succeeded&&s.succeeded(e)}).catch(function(e){o.call(r),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),r.emit("peerconnection:setremotedescriptionfailed",e)})):o.call(this))}).call(n,e),i=!0},onErrorResponse:function(e){o.call(n,e)},onTransportError:function(){n.onTransportError()},onRequestTimeout:function(){n.onRequestTimeout()},onDialogError:function(){n.onDialogError()}}})}).catch(function(){o()})}},{key:"_sendUpdate",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=(R.debug("sendUpdate()"),w.cloneArray(e.extraHeaders)),s=w.cloneObject(e.eventHandlers),t=e.rtcOfferConstraints||this._rtcOfferConstraints||null,i=e.sdpOffer||!1,o=!1;function a(e){var t,n,r=this;this._status===I.STATUS_TERMINATED||o||(this._handleSessionTimersInIncomingResponse(e),i?e.body&&e.hasHeader("Content-Type")&&"application/sdp"===e.getHeader("Content-Type").toLowerCase()?(t={originator:"remote",type:"answer",sdp:e.body},R.debug('emit "sdp"'),this.emit("sdp",t),n=new RTCSessionDescription({type:"answer",sdp:t.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return r._connection.setRemoteDescription(n)}).then(function(){s.succeeded&&s.succeeded(e)}).catch(function(e){l.call(r),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),r.emit("peerconnection:setremotedescriptionfailed",e)})):l.call(this):s.succeeded&&s.succeeded(e))}function l(e){s.failed&&s.failed(e)}r.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&r.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),i?(r.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return n._createLocalDescription("offer",t)}).then(function(e){var t={originator:"local",type:"offer",sdp:e=n._mangleOffer(e)};R.debug('emit "sdp"'),n.emit("sdp",t),n.sendRequest(b.UPDATE,{extraHeaders:r,body:e,eventHandlers:{onSuccessResponse:function(e){a.call(n,e),o=!0},onErrorResponse:function(e){l.call(n,e)},onTransportError:function(){n.onTransportError()},onRequestTimeout:function(){n.onRequestTimeout()},onDialogError:function(){n.onDialogError()}}})}).catch(function(){l.call(n)})):this.sendRequest(b.UPDATE,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){a.call(n,e)},onErrorResponse:function(e){l.call(n,e)},onTransportError:function(){n.onTransportError()},onRequestTimeout:function(){n.onRequestTimeout()},onDialogError:function(){n.onDialogError()}}})}},{key:"_acceptAndTerminate",value:function(e,t,n){R.debug("acceptAndTerminate()");var r=[];t&&(n=n||b.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause=".concat(t,'; text="').concat(n,'"'))),(this._dialog||this._createDialog(e,"UAC"))&&(this.sendRequest(b.ACK),this.sendRequest(b.BYE,{extraHeaders:r})),this._status=I.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(e){if(!this._localHold&&!this._remoteHold)return e;if(e=h.parse(e),this._localHold&&!this._remoteHold){R.debug("mangleOffer() | me on hold, mangling offer");var t,n=S(e.media);try{for(n.s();!(t=n.n()).done;){var r=t.value;-1!==U.indexOf(r.type)&&(!r.direction||"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"))}}catch(e){n.e(e)}finally{n.f()}}else if(this._localHold&&this._remoteHold){R.debug("mangleOffer() | both on hold, mangling offer");var s,i=S(e.media);try{for(i.s();!(s=i.n()).done;){var o=s.value;-1!==U.indexOf(o.type)&&(o.direction="inactive")}}catch(e){i.e(e)}finally{i.f()}}else if(this._remoteHold){R.debug("mangleOffer() | remote on hold, mangling offer");var a,l=S(e.media);try{for(l.s();!(a=l.n()).done;){var u=a.value;-1!==U.indexOf(u.type)&&(!u.direction||"sendrecv"===u.direction?u.direction="recvonly":"recvonly"===u.direction&&(u.direction="inactive"))}}catch(e){l.e(e)}finally{l.f()}}return h.write(e)}},{key:"_setLocalMediaStatus",value:function(){var e=!0,t=!0;(this._localHold||this._remoteHold)&&(t=e=!1),this._audioMuted&&(e=!1),this._videoMuted&&(t=!1),this._toggleMuteAudio(!e),this._toggleMuteVideo(!t)}},{key:"_handleSessionTimersInIncomingRequest",value:function(e,t){this._sessionTimers.enabled&&(e=e.session_expires&&e.session_expires>=b.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,e.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,"uas"),t.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(e)),this._sessionTimers.refresher="uas"===e,this._runSessionTimer())}},{key:"_handleSessionTimersInIncomingResponse",value:function(e){this._sessionTimers.enabled&&(e=e.session_expires&&e.session_expires>=b.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,e.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,"uac"),this._sessionTimers.refresher="uac"===e,this._runSessionTimer())}},{key:"_runSessionTimer",value:function(){var e=this,t=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){e._status!==I.STATUS_TERMINATED&&e._isReadyToReOffer()&&(R.debug("runSessionTimer() | sending session refresh request"),e._sessionTimers.refreshMethod===b.UPDATE?e._sendUpdate():e._sendReinvite())},500*t):this._sessionTimers.timer=setTimeout(function(){e._status!==I.STATUS_TERMINATED&&(R.warn("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:b.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*t)}},{key:"_toggleMuteAudio",value:function(e){var t,n=S(this._connection.getSenders().filter(function(e){return e.track&&"audio"===e.track.kind}));try{for(n.s();!(t=n.n()).done;)t.value.track.enabled=!e}catch(e){n.e(e)}finally{n.f()}}},{key:"_toggleMuteVideo",value:function(e){var t,n=S(this._connection.getSenders().filter(function(e){return e.track&&"video"===e.track.kind}));try{for(n.s();!(t=n.n()).done;)t.value.track.enabled=!e}catch(e){n.e(e)}finally{n.f()}}},{key:"_newRTCSession",value:function(e,t){R.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:e,session:this,request:t})}},{key:"_connecting",value:function(e){R.debug("session connecting"),R.debug('emit "connecting"'),this.emit("connecting",{request:e})}},{key:"_progress",value:function(e,t){R.debug("session progress"),R.debug('emit "progress"'),this.emit("progress",{originator:e,response:t||null})}},{key:"_accepted",value:function(e,t){R.debug("session accepted"),this._start_time=new Date,R.debug('emit "accepted"'),this.emit("accepted",{originator:e,response:t||null})}},{key:"_confirmed",value:function(e,t){R.debug("session confirmed"),this._is_confirmed=!0,R.debug('emit "confirmed"'),this.emit("confirmed",{originator:e,ack:t||null})}},{key:"_ended",value:function(e,t,n){R.debug("session ended"),this._end_time=new Date,this._close(),R.debug('emit "ended"'),this.emit("ended",{originator:e,message:t||null,cause:n})}},{key:"_failed",value:function(e,t,n){R.debug("session failed"),R.debug('emit "_failed"'),this.emit("_failed",{originator:e,message:t||null,cause:n}),this._close(),R.debug('emit "failed"'),this.emit("failed",{originator:e,message:t||null,cause:n})}},{key:"_onhold",value:function(e){R.debug("session onhold"),this._setLocalMediaStatus(),R.debug('emit "hold"'),this.emit("hold",{originator:e})}},{key:"_onunhold",value:function(e){R.debug("session onunhold"),this._setLocalMediaStatus(),R.debug('emit "unhold"'),this.emit("unhold",{originator:e})}},{key:"_onmute",value:function(e){var t=e.audio,e=e.video;R.debug("session onmute"),this._setLocalMediaStatus(),R.debug('emit "muted"'),this.emit("muted",{audio:t,video:e})}},{key:"_onunmute",value:function(e){var t=e.audio,e=e.video;R.debug("session onunmute"),this._setLocalMediaStatus(),R.debug('emit "unmuted"'),this.emit("unmuted",{audio:t,video:e})}}]),l(t,e),o})()},{"./Constants":2,"./Dialog":3,"./Exceptions":6,"./Logger":9,"./RTCSession/DTMF":16,"./RTCSession/Info":17,"./RTCSession/ReferNotifier":18,"./RTCSession/ReferSubscriber":19,"./RequestSender":21,"./SIPMessage":22,"./Timers":25,"./Transactions":26,"./URI":29,"./Utils":30,events:33,"sdp-transform":39}],16:[function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,r=e("../Logger"),d=e("../Constants"),h=e("../Exceptions"),_=e("../Utils"),f=new r("RTCSession:DTMF"),p={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};t.exports=(()=>{var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=i,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==o(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function i(e){var t;if(this instanceof i)return(t=s.call(this))._session=e,t._direction=null,t._tone=null,t._duration=null,t._request=null,t;throw new TypeError("Cannot call a class as a function")}return a(i.prototype,[{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}},{key:"send",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new h.InvalidStateError(this._session.status);var r=_.cloneArray(n.extraHeaders);if(this.eventHandlers=_.cloneObject(n.eventHandlers),"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: ".concat(e));e=e.toString()}if(!e.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: ".concat(e));this._tone=e,this._duration=n.duration,r.push("Content-Type: application/dtmf-relay");e="Signal=".concat(this._tone,"\r\n");e+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(d.INFO,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){t.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){t.eventHandlers.onFailed&&t.eventHandlers.onFailed(),t.emit("failed",{originator:"remote",response:e})},onRequestTimeout:function(){t._session.onRequestTimeout()},onTransportError:function(){t._session.onTransportError()},onDialogError:function(){t._session.onDialogError()}},body:e})}},{key:"init_incoming",value:function(e){var t,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this._direction="incoming",(this._request=e).reply(200),e.body&&(1<=(t=e.body.split("\n")).length&&n.test(t[0])&&(this._tone=t[0].replace(n,"$2")),2<=t.length)&&r.test(t[1])&&(this._duration=parseInt(t[1].replace(r,"$2"),10)),this._duration||(this._duration=p.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:e}):f.debug("invalid INFO DTMF received, discarded")}}]),i})(),t.exports.C=p},{"../Constants":2,"../Exceptions":6,"../Logger":9,"../Utils":30,events:33}],17:[function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,d=e("../Constants"),h=e("../Exceptions"),_=e("../Utils");t.exports=(()=>{var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=i,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==o(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function i(e){var t;if(this instanceof i)return(t=s.call(this))._session=e,t._direction=null,t._contentType=null,t._body=null,t;throw new TypeError("Cannot call a class as a function")}return a(i.prototype,[{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}},{key:"send",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this._direction="outgoing",t&&void 0===e)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new h.InvalidStateError(this._session.status);this._contentType=e,this._body=t;r=_.cloneArray(r.extraHeaders);e&&r.push("Content-Type: ".concat(e)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(d.INFO,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){n.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){n.emit("failed",{originator:"remote",response:e})},onTransportError:function(){n._session.onTransportError()},onRequestTimeout:function(){n._session.onRequestTimeout()},onDialogError:function(){n._session.onDialogError()}},body:t})}},{key:"init_incoming",value:function(e){this._direction="incoming",(this.request=e).reply(200),this._contentType=e.hasHeader("Content-Type")?e.getHeader("Content-Type").toLowerCase():void 0,this._body=e.body,this._session.newInfo({originator:"remote",info:this,request:e})}}]),i})()},{"../Constants":2,"../Exceptions":6,"../Utils":30,events:33}],18:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("../Logger"),i=e("../Constants"),o=new s("RTCSession:ReferNotifier"),a="refer",l="message/sipfrag;version=2.0",u=300;function c(e,t,n){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this._session=e,this._id=t,this._expires=n||u,this._active=!0,this.notify(100)}t.exports=(r(c.prototype,[{key:"notify",value:function(e,t){if(o.debug("notify()"),!1!==this._active){var n;t=t||i.REASON_PHRASE[e]||"",n=200<=e?"terminated;reason=noresource":"active;expires=".concat(this._expires);try{this._session.sendRequest(i.NOTIFY,{extraHeaders:["Event: ".concat(a,";id=").concat(this._id),"Subscription-State: ".concat(n),"Content-Type: ".concat(l)],body:"SIP/2.0 ".concat(e," ").concat(t),eventHandlers:{onErrorResponse:function(){this._active=!1}}})}catch(e){o.debug("send NOTIFY exception [ignored]")}}}}]),c)},{"../Constants":2,"../Logger":9}],19:[function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,r=e("../Logger"),d=e("../Constants"),h=e("../Grammar"),_=e("../Utils"),f=new r("RTCSession:ReferSubscriber");t.exports=(()=>{var e=i,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=i,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,s=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==o(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function i(e){var t;if(this instanceof i)return(t=s.call(this))._id=null,t._session=e,t;throw new TypeError("Cannot call a class as a function")}return a(i.prototype,[{key:"id",get:function(){return this._id}},{key:"sendRefer",value:function(e){var t,n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=(f.debug("sendRefer()"),_.cloneArray(r.extraHeaders)),i=_.cloneObject(r.eventHandlers);for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&this.on(t,i[t]);var o=null,r=(r.replaces&&(o=r.replaces._request.call_id,o=(o+=";to-tag=".concat(r.replaces._to_tag))+";from-tag=".concat(r.replaces._from_tag),o=encodeURIComponent(o)),"Refer-To: <".concat(e).concat(o?"?Replaces=".concat(o):"",">")),o=(s.push(r),s.some(function(e){return e.toLowerCase().startsWith("referred-by:")})||(e="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">"),s.push(e)),s.push("Contact: ".concat(this._session.contact)),this._session.sendRequest(d.REFER,{extraHeaders:s,eventHandlers:{onSuccessResponse:function(e){n._requestSucceeded(e)},onErrorResponse:function(e){n._requestFailed(e,d.causes.REJECTED)},onTransportError:function(){n._requestFailed(null,d.causes.CONNECTION_ERROR)},onRequestTimeout:function(){n._requestFailed(null,d.causes.REQUEST_TIMEOUT)},onDialogError:function(){n._requestFailed(null,d.causes.DIALOG_ERROR)}}}));this._id=o.cseq}},{key:"receiveNotify",value:function(e){if(f.debug("receiveNotify()"),e.body){var t=h.parse(e.body.trim(),"Status_Line");if(-1!==t)switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",{request:e,status_line:t});break;default:this.emit("failed",{request:e,status_line:t})}else f.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(e.body,'"'))}}},{key:"_requestSucceeded",value:function(e){f.debug("REFER succeeded"),f.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:e})}},{key:"_requestFailed",value:function(e,t){f.debug("REFER failed"),f.debug('emit "requestFailed"'),this.emit("requestFailed",{response:e||null,cause:t})}}]),i})()},{"../Constants":2,"../Grammar":7,"../Logger":9,"../Utils":30,events:33}],20:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),i=e("./Utils"),o=e("./Constants"),a=e("./SIPMessage"),l=e("./RequestSender"),u=new s("Registrator");function c(e,t){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this._reg_id=1,this._ua=e,this._transport=t,this._registrar=e.configuration.registrar_server,this._expires=e.configuration.register_expires,this._call_id=i.createRandomToken(22),this._cseq=0,this._to_uri=e.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance),this._auth=null}t.exports=(r(c.prototype,[{key:"registered",get:function(){return this._registered}},{key:"setExtraHeaders",value:function(e){Array.isArray(e)||(e=[]),this._extraHeaders=e.slice()}},{key:"setExtraContactParams",value:function(e){for(var t in e instanceof Object||(e={}),this._extraContactParams="",e){var n;Object.prototype.hasOwnProperty.call(e,t)&&(n=e[t],this._extraContactParams+=";".concat(t),n)&&(this._extraContactParams+="=".concat(n))}}},{key:"register",value:function(){var e,r=this;this._registering?u.debug("Register request in progress..."):((e=this._extraHeaders.slice()).push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),e.push("Expires: ".concat(this._expires)),this._auth&&e.push(this._auth),e=new a.OutgoingRequest(o.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},e),e=new l(this._ua,e,{onRequestTimeout:function(){r._registrationFailure(null,o.causes.REQUEST_TIMEOUT)},onTransportError:function(){r._registrationFailure(null,o.causes.CONNECTION_ERROR)},onAuthenticated:function(e){var t,n;r._cseq+=1,r._ua.modes.cache_register_auth_mode&&(n=(n=e.getHeader(t="Authorization"))||e.getHeader(t="Proxy-Authorization"))&&(r._auth="".concat(t,": ").concat(n))},onReceiveResponse:function(e){if(e.cseq===r._cseq)switch(null!==r._registrationTimer&&(clearTimeout(r._registrationTimer),r._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):var t;(r._registering=!1,e.hasHeader("Contact"))?(t=(t=(n=e.headers.Contact.reduce(function(e,t){return e.concat(t.parsed)},[])).find(function(e){return r._sipInstance===e.getParam("+sip.instance")&&r._reg_id===parseInt(e.getParam("reg-id"))}))||n.find(function(e){return e.uri.user===r._ua.contact.uri.user}))?(n=(n=!(n=t.getParam("expires"))&&e.hasHeader("expires")?e.getHeader("expires"):n)||r._expires,n=140<=(n=(n=Number(n))<10?10:n)?1e3*n/2+Math.floor(1e3*(n/2-70)*Math.random()):1e3*n-5e3,r._registrationTimer=setTimeout(function(){r._registrationTimer=null,0===r._ua.listeners("registrationExpiring").length?r.register():r._ua.emit("registrationExpiring")},n),t.hasParam("temp-gruu")&&(r._ua.contact.temp_gruu=t.getParam("temp-gruu").replace(/"/g,"")),t.hasParam("pub-gruu")&&(r._ua.contact.pub_gruu=t.getParam("pub-gruu").replace(/"/g,"")),r._registered||(r._registered=!0,r._ua.registered({response:e}))):u.debug("no Contact header pointing to us, response ignored"):u.debug("no Contact header in response to REGISTER, response ignored");break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(r._expires=Number(e.getHeader("min-expires")),r._expires<10&&(r._expires=10),r.register()):(u.debug("423 response received for REGISTER without Min-Expires"),r._registrationFailure(e,o.causes.SIP_FAILURE_CODE));break;default:var n=i.sipErrorCause(e.status_code);r._registrationFailure(e,n)}}}),this._registering=!0,e.send())}},{key:"unregister",value:function(){var e,n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._registered?(this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),e=this._extraHeaders.slice(),t.all?e.push("Contact: *".concat(this._extraContactParams)):e.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),e.push("Expires: 0"),this._auth&&e.push(this._auth),t=new a.OutgoingRequest(o.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},e),new l(this._ua,t,{onRequestTimeout:function(){n._unregistered(null,o.causes.REQUEST_TIMEOUT)},onTransportError:function(){n._unregistered(null,o.causes.CONNECTION_ERROR)},onAuthenticated:function(){n._cseq+=1},onReceiveResponse:function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):n._unregistered(e);break;default:var t=i.sipErrorCause(e.status_code);n._unregistered(e,t)}}}).send(),this._auth=null):u.debug("already unregistered")}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(e,t){this._registering=!1,this._ua.registrationFailed({response:e||null,cause:t}),this._registered&&(this._registered=!1,this._ua.unregistered({response:e||null,cause:t}))}},{key:"_unregistered",value:function(e,t){this._registering=!1,this._registered=!1,this._ua.unregistered({response:e||null,cause:t||null})}}]),c)},{"./Constants":2,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30}],21:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),i=e("./Constants"),o=e("./DigestAuthentication"),a=e("./Transactions"),l=new s("RequestSender"),u={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};function c(e,t,n){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");for(var r in this._ua=e,this._eventHandlers=n,this._method=t.method,this._request=t,this._auth=null,this._challenged=!1,this._staled=!1,u)!Object.prototype.hasOwnProperty.call(u,r)||this._eventHandlers[r]||(this._eventHandlers[r]=u[r]);e.status!==e.C.STATUS_USER_CLOSED||this._method===i.BYE&&this._method===i.ACK||this._eventHandlers.onTransportError()}t.exports=(r(c.prototype,[{key:"send",value:function(){var t=this,e={onRequestTimeout:function(){t._eventHandlers.onRequestTimeout()},onTransportError:function(){t._eventHandlers.onTransportError()},onReceiveResponse:function(e){t._receiveResponse(e)}};switch(this._method){case"INVITE":this.clientTransaction=new a.InviteClientTransaction(this._ua,this._ua.transport,this._request,e);break;case"ACK":this.clientTransaction=new a.AckClientTransaction(this._ua,this._ua.transport,this._request,e);break;default:this.clientTransaction=new a.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,e)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(e){var t,n,r=e.status_code;401!==r&&407!==r||null===this._ua.configuration.password&&null===this._ua.configuration.ha1?this._eventHandlers.onReceiveResponse(e):(r=401===e.status_code?(t=e.parseHeader("www-authenticate"),"authorization"):(t=e.parseHeader("proxy-authenticate"),"proxy-authorization"),t?(!this._challenged||!this._staled&&!0===t.stale)&&(this._auth||(n=this._ua.getCredential(t.realm),this._auth=new o(n)),this._auth.authenticate(this._request,t))?(this._challenged=!0,this._ua.updateCredential(t.realm,this._auth.get("realm"),this._auth.get("ha1")),t.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(r,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()):this._eventHandlers.onReceiveResponse(e):(l.debug("".concat(e.status_code," with wrong or missing challenge, cannot authenticate")),this._eventHandlers.onReceiveResponse(e)))}}]),c)},{"./Constants":2,"./DigestAuthentication":5,"./Logger":9,"./Transactions":26}],22:[function(e,t,n){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(n){var r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();return function(){var e,t=a(n),t=(e=r?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==s(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?l(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}var h,_,f,p=e("sdp-transform"),m=e("./Logger"),v=e("./Constants"),A=e("./Utils"),y=e("./NameAddrHeader"),C=e("./Grammar"),T=new m("SIPMessage"),e=(d(U,[{key:"setHeader",value:function(e,t){for(var n=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[A.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){var t=this.headers[A.headerize(e)];if(t){if(t[0])return t[0]}else{var n,r=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),s=g(this.extraHeaders);try{for(s.s();!(n=s.n()).done;){var i=n.value;if(r.test(i))return i.substring(i.indexOf(":")+1).trim()}}catch(e){s.e(e)}finally{s.f()}}}},{key:"getHeaders",value:function(e){var t=this.headers[A.headerize(e)],n=[];if(t){var r,s=g(t);try{for(s.s();!(r=s.n()).done;)n.push(r.value)}catch(e){s.e(e)}finally{s.f()}}else{var i,o=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),a=g(this.extraHeaders);try{for(a.s();!(i=a.n()).done;){var l=i.value;o.test(l)&&n.push(l.substring(l.indexOf(":")+1).trim())}}catch(e){a.e(e)}finally{a.f()}}return n}},{key:"hasHeader",value:function(e){if(this.headers[A.headerize(e)])return!0;var t,n=new RegExp("^\\s*".concat(e,"\\s*:"),"i"),r=g(this.extraHeaders);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(n.test(s))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=p.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){var e,t="".concat(this.method," ").concat(this.ruri," SIP/2.0\r\n");for(e in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,e)){var n,r=g(this.headers[e]);try{for(r.s();!(n=r.n()).done;){var s=n.value;t+="".concat(e,": ").concat(s,"\r\n")}}catch(t){r.e(t)}finally{r.f()}}var i,o=g(this.extraHeaders);try{for(o.s();!(i=o.n()).done;){var a=i.value;t+="".concat(a.trim(),"\r\n")}}catch(t){o.e(t)}finally{o.f()}var l=[];switch(this.method){case v.REGISTER:l.push("path","gruu");break;case v.INVITE:this.ua.configuration.session_timers&&l.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&l.push("gruu"),l.push("ice","replaces");break;case v.UPDATE:this.ua.configuration.session_timers&&l.push("timer"),l.push("ice")}l.push("outbound");var u=this.ua.configuration.user_agent||v.USER_AGENT;return t=(t=(t+="Allow: ".concat(v.ALLOWED_METHODS,"\r\n"))+"Supported: ".concat(l,"\r\n"))+"User-Agent: ".concat(u,"\r\n"),this.body?(u=A.str_utf8_length(this.body),t=(t+="Content-Length: ".concat(u,"\r\n\r\n"))+this.body):t+="Content-Length: 0\r\n\r\n",t}},{key:"clone",value:function(){var t=new U(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(e){t.headers[e]=this.headers[e].slice()},this),t.body=this.body,t.extraHeaders=A.cloneArray(this.extraHeaders),t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t}}]),U),m=(r(I,e),f=o(I),d(I,[{key:"cancel",value:function(e){this.transaction.cancel(e)}},{key:"clone",value:function(){var t=new I(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(e){t.headers[e]=this.headers[e].slice()},this),t.body=this.body,t.extraHeaders=A.cloneArray(this.extraHeaders),t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t.transaction=this.transaction,t}}]),I),S=(d(R,[{key:"addHeader",value:function(e,t){t={raw:t};e=A.headerize(e),this.headers[e]?this.headers[e].push(t):this.headers[e]=[t]}},{key:"getHeader",value:function(e){e=this.headers[A.headerize(e)];return e&&e[0]?e[0].raw:void 0}},{key:"getHeaders",value:function(e){var t=this.headers[A.headerize(e)],n=[];if(!t)return[];var r,s=g(t);try{for(s.s();!(r=s.n()).done;)n.push(r.value.raw)}catch(e){s.e(e)}finally{s.f()}return n}},{key:"hasHeader",value:function(e){return!!this.headers[A.headerize(e)]}},{key:"parseHeader",value:function(e){var t,n,r,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(e=A.headerize(e),this.headers[e]){if(!(s>=this.headers[e].length))return n=(t=this.headers[e][s]).raw,t.parsed||(-1===(r=C.parse(n,e.replace(/-/g,"_")))?(this.headers[e].splice(s,1),void T.debug('error parsing "'.concat(e,'" header field with value "').concat(n,'"'))):t.parsed=r);T.debug('not so many "'.concat(e,'" headers present'))}else T.debug('header "'.concat(e,'" not present'))}},{key:"s",value:function(e,t){return this.parseHeader(e,t)}},{key:"setHeader",value:function(e,t){t={raw:t};this.headers[A.headerize(e)]=[t]}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=p.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){return this.data}}]),R),b=(r(w,S),_=o(w),d(w,[{key:"reply",value:function(e,t,n,r,s,i){var o=[],a=this.getHeader("To");if(t=t||null,!(e=e||null)||e<100||699<e)throw new TypeError("Invalid status_code: ".concat(e));if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(t));t=t||v.REASON_PHRASE[e]||"",n=A.cloneArray(n);var l="SIP/2.0 ".concat(e," ").concat(t,"\r\n");if(this.method===v.INVITE&&100<e&&e<=200){var u,c=g(this.getHeaders("record-route"));try{for(c.s();!(u=c.n()).done;)l+="Record-Route: ".concat(u.value,"\r\n")}catch(e){c.e(e)}finally{c.f()}}var d,h=g(this.getHeaders("via"));try{for(h.s();!(d=h.n()).done;)l+="Via: ".concat(d.value,"\r\n")}catch(e){h.e(e)}finally{h.f()}!this.to_tag&&100<e?a+=";tag=".concat(A.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(a+=";tag=".concat(this.to_tag)),l=(l=(l=(l+="To: ".concat(a,"\r\n"))+"From: ".concat(this.getHeader("From"),"\r\n"))+"Call-ID: ".concat(this.call_id,"\r\n"))+"CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n");var _,f=g(n);try{for(f.s();!(_=f.n()).done;){var p=_.value;l+="".concat(p.trim(),"\r\n")}}catch(e){f.e(e)}finally{f.f()}switch(this.method){case v.INVITE:this.ua.configuration.session_timers&&o.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&o.push("gruu"),o.push("ice","replaces");break;case v.UPDATE:this.ua.configuration.session_timers&&o.push("timer"),r&&o.push("ice"),o.push("replaces")}o.push("outbound"),this.method===v.OPTIONS?l=(l+="Allow: ".concat(v.ALLOWED_METHODS,"\r\n"))+"Accept: ".concat(v.ACCEPTED_BODY_TYPES,"\r\n"):405===e?l+="Allow: ".concat(v.ALLOWED_METHODS,"\r\n"):415===e&&(l+="Accept: ".concat(v.ACCEPTED_BODY_TYPES,"\r\n")),l+="Supported: ".concat(o,"\r\n"),r?(t=A.str_utf8_length(r),l=(l+="Content-Type: application/sdp\r\n")+"Content-Length: ".concat(t,"\r\n\r\n")+r):l+="Content-Length: ".concat(0,"\r\n\r\n"),this.server_transaction.receiveResponse(e,l,s,i)}},{key:"reply_sl",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=this.getHeaders("via");if(!e||e<100||699<e)throw new TypeError("Invalid status_code: ".concat(e));if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(t));var r,t=t||v.REASON_PHRASE[e]||"",s="SIP/2.0 ".concat(e," ").concat(t,"\r\n"),i=g(n);try{for(i.s();!(r=i.n()).done;)s+="Via: ".concat(r.value,"\r\n")}catch(e){i.e(e)}finally{i.f()}t=this.getHeader("To");!this.to_tag&&100<e?t+=";tag=".concat(A.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(t+=";tag=".concat(this.to_tag)),s=(s=(s=(s=(s+="To: ".concat(t,"\r\n"))+"From: ".concat(this.getHeader("From"),"\r\n"))+"Call-ID: ".concat(this.call_id,"\r\n"))+"CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n"))+"Content-Length: ".concat(0,"\r\n\r\n"),this.transport.send(s)}}]),w),S=(r(E,S),h=o(E),E);function E(){var e;return u(this,E),(e=h.call(this)).headers={},e.status_code=null,e.reason_phrase=null,e}function w(e){var t;return u(this,w),(t=_.call(this)).ua=e,t.headers={},t.ruri=null,t.transport=null,t.server_transaction=null,t}function R(){u(this,R),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function I(e,t,n,r,s){return u(this,I),(e=f.call(this,v.INVITE,e,t,n,r,s)).transaction=null,e}function U(e,t,n,r,s,i){if(u(this,U),!e||!t||!n)return null;r=r||{},this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=i,this.extraHeaders=A.cloneArray(s),r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<".concat(n.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",v.MAX_FORWARDS);i=r.to_uri||t,s=r.to_tag?{tag:r.to_tag}:null,t=void 0!==r.to_display_name?r.to_display_name:null;this.to=new y(i,t,s),this.setHeader("to",this.to.toString());i=r.from_uri||n.configuration.uri,t={tag:r.from_tag||A.newTag()},s=void 0!==r.from_display_name?r.from_display_name:n.configuration.display_name||null,this.from=new y(i,s,t),this.setHeader("from",this.from.toString()),i=r.call_id||n.configuration.jssip_id+A.createRandomToken(15),this.call_id=i,this.setHeader("call-id",i),s=r.cseq||Math.floor(1e4*Math.random());this.cseq=s,this.setHeader("cseq","".concat(s," ").concat(e))}t.exports={OutgoingRequest:e,InitialOutgoingInviteRequest:m,IncomingRequest:b,IncomingResponse:S}},{"./Constants":2,"./Grammar":7,"./Logger":9,"./NameAddrHeader":11,"./Utils":30,"sdp-transform":39}],23:[function(e,t,n){var r=e("./Logger"),s=e("./Utils"),i=e("./Grammar"),o=new r("Socket");n.isSocket=function(t){if(Array.isArray(t))return!1;if(void 0===t)return o.warn("undefined JsSIP.Socket instance"),!1;try{if(!s.isString(t.url))throw o.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!s.isString(t.via_transport))throw o.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(-1===i.parse(t.sip_uri,"SIP_URI"))throw o.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch(t){return!1}try{["connect","disconnect","send"].forEach(function(e){if(!s.isFunction(t[e]))throw o.warn("missing or invalid JsSIP.Socket method: ".concat(e)),new Error("Missing or invalid JsSIP.Socket method: ".concat(e))})}catch(t){return!1}return!0}},{"./Grammar":7,"./Logger":9,"./Utils":30}],24:[function(e,t,n){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?a(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=e("events").EventEmitter,r=e("./Logger"),_=e("./Constants"),f=e("./Utils"),p=e("./Grammar"),g=e("./SIPMessage"),m=e("./RequestSender"),v=e("./Dialog"),A=new r("Subscriber"),y={SUBSCRIBE_RESPONSE_TIMEOUT:0,SUBSCRIBE_TRANSPORT_ERROR:1,SUBSCRIBE_NON_OK_RESPONSE:2,SUBSCRIBE_BAD_OK_RESPONSE:3,SUBSCRIBE_FAILED_AUTHENTICATION:4,UNSUBSCRIBE_TIMEOUT:5,RECEIVE_FINAL_NOTIFY:6,RECEIVE_BAD_NOTIFY:7,STATE_PENDING:0,STATE_ACTIVE:1,STATE_TERMINATED:2,STATE_INIT:3,STATE_NOTIFY_WAIT:4};t.exports=(()=>{var e=d,t=h;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t),n=d,r=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();var n,r,c=function(){var e,t=u(n),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(!e||"object"!==s(e)&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}return e};function d(e,t,n,r,s){var i,o=s.expires,a=s.contentType,l=s.allowEvents,u=s.params,s=s.extraHeaders;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");if(A.debug("new"),i=c.call(this),!t)throw new TypeError("target is undefined");if(!n)throw new TypeError("eventName is undefined");if(!r)throw new TypeError("accept is undefined");i._ua=e,i._target=t,i._expires=o=0!==o?o||900:o,i._content_type=a,i._params=f.cloneObject(u),i._params.from_uri||(i._params.from_uri=i._ua.configuration.uri),i._params.from_tag=f.newTag(),i._params.to_tag=null,i._params.call_id=f.createRandomToken(20),void 0===i._params.cseq&&(i._params.cseq=Math.floor(1e4*Math.random()+1)),i._state=y.STATE_INIT,i._dialog=null,i._expires_timer=null,i._expires_timestamp=null,i._terminated=!1,i._unsubscribe_timeout_timer=null,i.data={};e=p.parse(n,"Event");if(-1===e)throw new TypeError("eventName - wrong format");i._event_name=e.event,i._event_id=e.params&&e.params.id;t=i._event_name;return i._event_id&&(t+=";id=".concat(i._event_id)),i._headers=f.cloneArray(s),i._headers=i._headers.concat(["Event: ".concat(t),"Expires: ".concat(i._expires),"Accept: ".concat(r)]),i._headers.find(function(e){return e.startsWith("Contact")})||(o="Contact: ".concat(i._ua._contact.toString()),i._headers.push(o)),l&&i._headers.push("Allow-Events: ".concat(l)),i._queue=[],i}return e=[{key:"C",get:function(){return y}}],o((t=d).prototype,[{key:"C",get:function(){return y}},{key:"onRequestTimeout",value:function(){this._dialogTerminated(y.SUBSCRIBE_RESPONSE_TIMEOUT)}},{key:"onTransportError",value:function(){this._dialogTerminated(y.SUBSCRIBE_TRANSPORT_ERROR)}},{key:"receiveRequest",value:function(e){var t,n,r,s,i;e.method!==_.NOTIFY?(A.warn("received non-NOTIFY request"),e.reply(405)):(s=e.parseHeader("Event"))?(t=s.event,s=s.params&&s.params.id,t!==this._event_name||s!==this._event_id?(A.warn("Event header does not match SUBSCRIBE"),e.reply(489),this._dialogTerminated(y.RECEIVE_BAD_NOTIFY)):(t=e.parseHeader("subscription-state"))?(e.reply(200),s=this._stateStringToNumber(t.state),(r=this._state)!==y.STATE_TERMINATED&&s!==y.STATE_TERMINATED&&(this._state=s,void 0!==t.expires)&&(n=t.expires,i=(new Date).getTime()+1e3*n,2e3<this._expires_timestamp-i&&(A.debug("update sending re-SUBSCRIBE time"),this._scheduleSubscribe(n))),r!==y.STATE_PENDING&&s===y.STATE_PENDING?(A.debug('emit "pending"'),this.emit("pending")):r!==y.STATE_ACTIVE&&s===y.STATE_ACTIVE&&(A.debug('emit "active"'),this.emit("active")),i=e.body,n=s===y.STATE_TERMINATED,i&&(r=e.getHeader("content-type"),A.debug('emit "notify"'),this.emit("notify",n,e,i,r)),n&&(s=t.reason,i=void 0,t.params&&void 0!==t.params["retry-after"]&&(i=parseInt(t.params["retry-after"])),this._dialogTerminated(y.RECEIVE_FINAL_NOTIFY,s,i))):(A.warn("missed Subscription-State header"),e.reply(400),this._dialogTerminated(y.RECEIVE_BAD_NOTIFY))):(A.warn("missed Event header"),e.reply(400),this._dialogTerminated(y.RECEIVE_BAD_NOTIFY))}},{key:"subscribe",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;A.debug("subscribe()"),this._state===y.STATE_INIT?this._sendInitialSubscribe(e,this._headers):this._sendSubsequentSubscribe(e,this._headers)}},{key:"terminate",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;A.debug("terminate()"),this._terminated||(this._terminated=!0,e=this._headers.map(function(e){return e.startsWith("Expires")?"Expires: 0":e}),this._state===y.STATE_INIT?this._sendInitialSubscribe(n,e):this._sendSubsequentSubscribe(n,e),this._unsubscribe_timeout_timer=setTimeout(function(){t._dialogTerminated(y.UNSUBSCRIBE_TIMEOUT)},3e4))}},{key:"state",get:function(){return this._state}},{key:"id",get:function(){return this._dialog?this._dialog.id:null}},{key:"_sendInitialSubscribe",value:function(e,t){var n=this;if(e){if(!this._content_type)throw new TypeError("content_type is undefined");(t=t.slice()).push("Content-Type: ".concat(this._content_type))}this._state=y.STATE_NOTIFY_WAIT;t=new g.OutgoingRequest(_.SUBSCRIBE,this._ua.normalizeTarget(this._target),this._ua,this._params,t,e);new m(this._ua,t,{onRequestTimeout:function(){n.onRequestTimeout()},onTransportError:function(){n.onTransportError()},onReceiveResponse:function(e){n._receiveSubscribeResponse(e)}}).send()}},{key:"_receiveSubscribeResponse",value:function(e){if(200<=e.status_code&&e.status_code<300){if(null===this._dialog){var t=new v(this,e,"UAC");if(t.error)return A.warn(t.error),void this._dialogTerminated(y.SUBSCRIBE_BAD_OK_RESPONSE);this._dialog=t,A.debug('emit "accepted"'),this.emit("accepted");var n,r=i(this._queue);try{for(r.s();!(n=r.n()).done;){var s=n.value;A.debug("dequeue subscribe"),this._sendSubsequentSubscribe(s.body,s.headers)}}catch(e){r.e(e)}finally{r.f()}}t=e.getHeader("expires"),t=(0===t||t||(A.warn("response without Expires header"),t="900"),parseInt(t));0<t&&this._scheduleSubscribe(t)}else 401===e.status_code||407===e.status_code?this._dialogTerminated(y.SUBSCRIBE_FAILED_AUTHENTICATION):300<=e.status_code&&this._dialogTerminated(y.SUBSCRIBE_NON_OK_RESPONSE)}},{key:"_sendSubsequentSubscribe",value:function(e,t){var n=this;if(this._state!==y.STATE_TERMINATED)if(this._dialog){if(e){if(!this._content_type)throw new TypeError("content_type is undefined");(t=t.slice()).push("Content-Type: ".concat(this._content_type))}this._dialog.sendRequest(_.SUBSCRIBE,{body:e,extraHeaders:t,eventHandlers:{onRequestTimeout:function(){n.onRequestTimeout()},onTransportError:function(){n.onTransportError()},onSuccessResponse:function(e){n._receiveSubscribeResponse(e)},onErrorResponse:function(e){n._receiveSubscribeResponse(e)},onDialogError:function(e){n._receiveSubscribeResponse(e)}}})}else A.debug("enqueue subscribe"),this._queue.push({body:e,headers:t.slice()})}},{key:"_dialogTerminated",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;this._state!==y.STATE_TERMINATED&&(this._state=y.STATE_TERMINATED,clearTimeout(this._expires_timer),clearTimeout(this._unsubscribe_timeout_timer),this._dialog&&(this._dialog.terminate(),this._dialog=null),A.debug('emit "terminated" code='.concat(e)),this.emit("terminated",e,t,n))}},{key:"_scheduleSubscribe",value:function(e){var t=this,n=140<=e?1e3*e/2+Math.floor(1e3*(e/2-70)*Math.random()):1e3*e-5e3;this._expires_timestamp=(new Date).getTime()+1e3*e,A.debug("next SUBSCRIBE will be sent in ".concat(Math.floor(n/1e3)," sec")),clearTimeout(this._expires_timer),this._expires_timer=setTimeout(function(){t._expires_timer=null,t._sendSubsequentSubscribe(null,t._headers)},n)}},{key:"_stateStringToNumber",value:function(e){switch(e){case"pending":return y.STATE_PENDING;case"active":return y.STATE_ACTIVE;case"terminated":return y.STATE_TERMINATED;case"init":return y.STATE_INIT;case"notify_wait":return y.STATE_NOTIFY_WAIT;default:throw new TypeError("wrong state value")}}}]),o(t,e),d})()},{"./Constants":2,"./Dialog":3,"./Grammar":7,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30,events:33}],25:[function(e,t,n){t.exports={T1:500,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},{}],26:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var s=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();return function(){var e,t,n=d(r);return e=s?(e=d(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),n=this,!(t=e)||"object"!==i(t)&&"function"!=typeof t?c(n):t}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h,_,f,p,g,m=e("events").EventEmitter,v=e("./Logger"),A=e("./Constants"),y=e("./SIPMessage"),C=e("./Timers"),T=new v("NonInviteClientTransaction"),S=new v("InviteClientTransaction"),b=new v("AckClientTransaction"),E=new v("NonInviteServerTransaction"),w=new v("InviteServerTransaction"),R={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},e=(a(D,m),g=u(D),s(D,[{key:"C",get:function(){return R}},{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(R.STATUS_TRYING),this.F=setTimeout(function(){e.timer_F()},C.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){T.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){T.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(e){var t=e.status_code;if(t<200)switch(this.state){case R.STATUS_TRYING:case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e)}else switch(this.state){case R.STATUS_TRYING:case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_COMPLETED),clearTimeout(this.F),408===t?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(e),this.timer_K()}}}]),D),v=(a(P,m),p=u(P),s(P,[{key:"C",get:function(){return R}},{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(R.STATUS_CALLING),this.B=setTimeout(function(){e.timer_B()},C.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.M),this.state!==R.STATUS_ACCEPTED&&(S.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){S.debug("Timer M expired for transaction ".concat(this.id)),this.state===R.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){S.debug("Timer B expired for transaction ".concat(this.id)),this.state===R.STATUS_CALLING&&(this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){S.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(e){var t=new y.OutgoingRequest(A.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",e.getHeader("to")),this.transport.send(t),this.timer_D()}},{key:"cancel",value:function(e){var t;this.state===R.STATUS_PROCEEDING&&((t=new y.OutgoingRequest(A.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq})).setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",this.request.getHeader("to")),e&&t.setHeader("reason",e),this.transport.send(t))}},{key:"receiveResponse",value:function(e){var t=this,n=e.status_code;if(100<=n&&n<=199)switch(this.state){case R.STATUS_CALLING:this.stateChanged(R.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e);break;case R.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(e)}else if(200<=n&&n<=299)switch(this.state){case R.STATUS_CALLING:case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_ACCEPTED),this.M=setTimeout(function(){t.timer_M()},C.TIMER_M),this.eventHandlers.onReceiveResponse(e);break;case R.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(e)}else if(300<=n&&n<=699)switch(this.state){case R.STATUS_CALLING:case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_COMPLETED),this.sendACK(e),this.eventHandlers.onReceiveResponse(e);break;case R.STATUS_COMPLETED:this.sendACK(e)}}}]),P),I=(a(N,m),f=u(N),s(N,[{key:"C",get:function(){return R}},{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){b.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}}]),N),U=(a(k,m),_=u(k),s(k,[{key:"C",get:function(){return R}},{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_J",value:function(){E.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,E.debug("transport error occurred, deleting transaction ".concat(this.id)),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(e,t,n,r){if(100===e)switch(this.state){case R.STATUS_TRYING:this.stateChanged(R.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case R.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(200<=e&&e<=699)switch(this.state){case R.STATUS_TRYING:case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_COMPLETED),this.last_response=t,this.timer_J(),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}}}]),k),m=(a(O,m),h=u(O),s(O,[{key:"C",get:function(){return R}},{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_H",value:function(){w.debug("Timer H expired for transaction ".concat(this.id)),this.state===R.STATUS_COMPLETED&&w.debug("ACK not received, dialog will be terminated"),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){w.debug("Timer L expired for transaction ".concat(this.id)),this.state===R.STATUS_ACCEPTED&&(this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,w.debug("transport error occurred, deleting transaction ".concat(this.id)),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),this.stateChanged(R.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(e,t,n,r){var s=this;if(100<=e&&e<=199&&this.state===R.STATUS_PROCEEDING&&(this.transport.send(t)||this.onTransportError(),this.last_response=t),100<e&&e<=199&&this.state===R.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){s.resend_provisional()},C.PROVISIONAL_RESPONSE_INTERVAL));else if(200<=e&&e<=299)switch(this.state){case R.STATUS_PROCEEDING:this.stateChanged(R.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout(function(){s.timer_L()},C.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case R.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else 300<=e&&e<=699&&this.state===R.STATUS_PROCEEDING&&(null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(R.STATUS_COMPLETED),this.H=setTimeout(function(){s.timer_H()},C.TIMER_H),n&&n()):(this.onTransportError(),r&&r()))}}]),O);function O(e,t,n){var r;return o(this,O),(r=h.call(this)).type=R.INVITE_SERVER,r.id=n.via_branch,r.ua=e,r.transport=t,r.request=n,r.last_response="",n.server_transaction=c(r),r.state=R.STATUS_PROCEEDING,e.newTransaction(c(r)),r.resendProvisionalTimer=null,n.reply(100),r}function k(e,t,n){var r;return o(this,k),(r=_.call(this)).type=R.NON_INVITE_SERVER,r.id=n.via_branch,r.ua=e,r.transport=t,r.request=n,r.last_response="",n.server_transaction=c(r),r.state=R.STATUS_TRYING,e.newTransaction(c(r)),r}function N(e,t,n,r){o(this,N),(s=f.call(this)).id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.transport=t,s.request=n,s.eventHandlers=r;var s,n="SIP/2.0/".concat(t.via_transport);return n+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",n),s}function P(e,t,n,r){o(this,P),(s=p.call(this)).type=R.INVITE_CLIENT,s.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.ua=e,s.transport=t,s.request=n,s.eventHandlers=r,n.transaction=c(s);var s,r="SIP/2.0/".concat(t.via_transport);return r+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",r),s.ua.newTransaction(c(s)),s}function D(e,t,n,r){o(this,D),(s=g.call(this)).type=R.NON_INVITE_CLIENT,s.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),s.ua=e,s.transport=t,s.request=n,s.eventHandlers=r;var s,n="SIP/2.0/".concat(t.via_transport);return n+=" ".concat(e.configuration.via_host,";branch=").concat(s.id),s.request.setHeader("via",n),s.ua.newTransaction(c(s)),s}t.exports={C:R,NonInviteClientTransaction:e,InviteClientTransaction:v,AckClientTransaction:I,NonInviteServerTransaction:U,InviteServerTransaction:m,checkTransaction:function(e,t){var n,r=e._transactions;switch(t.method){case A.INVITE:if(n=r.ist[t.via_branch])return n.state===R.STATUS_PROCEEDING&&n.transport.send(n.last_response),!0;break;case A.ACK:if(!(n=r.ist[t.via_branch]))return!1;if(n.state===R.STATUS_ACCEPTED)return!1;if(n.state===R.STATUS_COMPLETED)return n.state=R.STATUS_CONFIRMED,n.timer_I(),!0;break;case A.CANCEL:return(n=r.ist[t.via_branch])?(t.reply_sl(200),n.state!==R.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=r.nist[t.via_branch]){switch(n.state){case R.STATUS_TRYING:break;case R.STATUS_PROCEEDING:case R.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}}},{"./Constants":2,"./Logger":9,"./SIPMessage":22,"./Timers":25,events:33}],27:[function(e,t,n){function u(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?a(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),i=e("./Socket"),e=e("./Constants"),o=new s("Transport"),l={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:e.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:e.CONNECTION_RECOVERY_MAX_INTERVAL}};function c(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:l.recovery_options,r=this;if(!(r instanceof c))throw new TypeError("Cannot call a class as a function");o.debug("new()"),this._ua=e,this.status=l.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=n,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(e){o.warn("cannot use TextDecoder: ".concat(e))}if(void 0===t)throw new TypeError("Invalid argument. undefined 'sockets' argument");(t=t instanceof Array?t:[t]).forEach(function(e){if(!i.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:l.SOCKET_STATUS_READY})},this),this._getSocket()}t.exports=(r(c.prototype,[{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}},{key:"connect",value:function(){o.debug("connect()"),this.isConnected()?o.debug("Transport is already connected"):this.isConnecting()?o.debug("Transport is connecting"):(this.close_requested=!1,this.status=l.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}},{key:"disconnect",value:function(){o.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=l.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(e){return o.debug("send()"),this.isConnected()?(e=e.toString(),o.debug("sending message:\n\n".concat(e,"\n")),this.socket.send(e)):(o.warn("unable to send message, transport is not connected"),!1)}},{key:"isConnected",value:function(){return this.status===l.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===l.STATUS_CONNECTING}},{key:"_get_number_of_sbc",value:function(){return this.sockets.length}},{key:"_switch_sbc",value:function(){var e=this.ondisconnect;this.ondisconnect=function(){},this.disconnect(),this.ondisconnect=e,this.close_requested=!1,this.sockets.forEach(function(e){this.socket===e.socket&&(e.status=l.SOCKET_STATUS_ERROR)},this),this._getSocket(),this.connect()}},{key:"_register_redirect",value:function(e){var t,n,r=null,s=u(this.sockets);try{for(s.s();!(t=s.n()).done;){var i=t.value;if(i.socket.url===e){r=i.socket;break}}}catch(e){s.e(e)}finally{s.f()}if(null===r&&!e.includes(":",6)){e+=":443";var o,a=u(this.sockets);try{for(a.s();!(o=a.n()).done;){var l=o.value;if(l.socket.url===e){r=l.socket;break}}}catch(e){a.e(e)}finally{a.f()}}return null!==r&&(n=this.ondisconnect,this.ondisconnect=function(){},this.disconnect(),this.ondisconnect=n,this.socket=r,this.connect(),!0)}},{key:"_reconnect",value:function(){var e=this,t=(this.recover_attempts+=1,Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1));t<this.recovery_options.min_interval?t=this.recovery_options.min_interval:t>this.recovery_options.max_interval&&(t=this.recovery_options.max_interval),o.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(t," seconds")),this.recovery_timer=setTimeout(function(){e.close_requested||e.isConnected()||e.isConnecting()||(e._getSocket(),e.connect())},1e3*t)}},{key:"_getSocket",value:function(){var e,t=[];this.sockets.forEach(function(e){e.status!==l.SOCKET_STATUS_ERROR&&(0===t.length?t.push(e):e.weight>t[0].weight?t=[e]:e.weight===t[0].weight&&t.push(e))}),0===t.length?(this.sockets.forEach(function(e){e.status=l.SOCKET_STATUS_READY}),this._getSocket()):(e=Math.floor(Math.random()*t.length),this.socket=t[e].socket)}},{key:"_onConnect",value:function(){this.recover_attempts=0,this._ha_connect_time=void 0,this.status=l.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(e,t,n){var r=this.status;if(this.status=l.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),!this.close_requested){if(void 0!==this._ua.modes.sbc_ha_pairs_mode){if(r===l.STATUS_CONNECTED)return o.debug("AC: SBC HA pairs mode: Reconnect to the same SBC ".concat(this._ua.modes.sbc_ha_pairs_mode," seconds left")),this._ha_connect_time=(new Date).getTime()+1e3*this._ua.modes.sbc_ha_pairs_mode,void this._connect2();if(void 0!==this._ha_connect_time){e=this._ha_connect_time-(new Date).getTime();if(0<e)return o.debug("AC: SBC HA pairs mode: Repeat ".concat(e/1e3," seconds left")),void this._connect2();o.debug("AC: SBC HA pairs mode: Failed"),this._ha_connect_time=void 0}}this.sockets.forEach(function(e){this.socket===e.socket&&(e.status=l.SOCKET_STATUS_ERROR)},this),this._reconnect()}}},{key:"_connect2",value:function(){var e,t=this,n=0;this._ha_last_connect&&(n=500<(e=(new Date).getTime()-this._ha_last_connect)?0:500-e),this.recovery_timer=setTimeout(function(){t.close_requested||t.isConnected()||t.isConnecting()||(t._ha_last_connect=(new Date).getTime(),t.connect())},n)}},{key:"_onData",value:function(e){if("\r\n"!==e){if("string"!=typeof e){try{e=this.textDecoder?this.textDecoder.decode(e):String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void o.debug("received binary message failed to be converted into string, message discarded")}o.debug("received binary message:\n\n".concat(e,"\n"))}else o.debug("received text message:\n\n".concat(e,"\n"));this.ondata({transport:this,message:e})}else o.debug("received message with CRLF Keep Alive response")}}]),c)},{"./Constants":2,"./Logger":9,"./Socket":23}],28:[function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(r){var s=(()=>{if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}})();return function(){var e,t,n=u(r);return e=s?(e=u(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),n=this,!(t=e)||"object"!==i(t)&&"function"!=typeof t?l(n):t}}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=e("events").EventEmitter,r=e("./Logger"),d=e("./Constants"),h=e("./Registrator"),_=e("./RTCSession"),f=e("./Subscriber"),p=e("./Notifier"),g=e("./Message"),m=e("./Options"),v=e("./Transactions"),A=e("./Transport"),y=e("./Utils"),C=e("./Exceptions"),T=e("./URI"),S=e("./Parser"),b=e("./SIPMessage"),E=e("./sanityCheck"),w=e("./Config"),R=new r("UA"),I={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};t.exports=(()=>{var e=r,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t);var n=a(r);function r(e){var t;if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");if((t=n.call(this)).modes={},t._credentials={},t._cache={credentials:{}},t._configuration=Object.assign({},w.settings),t._dynConfiguration={},t._dialogs={},t._applicants={},t._sessions={},t._transport=null,t._contact=null,t._status=I.STATUS_INIT,t._error=null,t._transactions={nist:{},nict:{},ist:{},ict:{}},t._data={},t._closeTimer=null,void 0===e)throw new TypeError("Not enough arguments");try{t._loadConfig(e)}catch(e){throw t._status=I.STATUS_NOT_READY,t._error=I.CONFIGURATION_ERROR,e}return t._registrator=new h(l(t)),t}return e=[{key:"C",get:function(){return I}}],s((t=r).prototype,[{key:"C",get:function(){return I}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}},{key:"start",value:function(){R.debug("start()"),this._status===I.STATUS_INIT?this._transport.connect():this._status===I.STATUS_USER_CLOSED?(R.debug("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=I.STATUS_INIT,this._transport.connect()):this._status===I.STATUS_READY?R.debug("UA is in READY status, not restarted"):R.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){R.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(e){R.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(e)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(e,t){R.debug("call()");var n=new _(this);return n.connect(e,t),n}},{key:"sendMessage",value:function(e,t,n){R.debug("sendMessage()");var r=new g(this);return r.send(e,t,n),r}},{key:"subscribe",value:function(e,t,n,r){return R.debug("subscribe()"),new f(this,e,t,n,r)}},{key:"notify",value:function(e,t,n){return R.debug("notify()"),new p(this,e,t,n)}},{key:"addCredential",value:function(e){this._credentials[e.realm]=y.cloneObject(e)}},{key:"getCredential",value:function(e){return this._credentials[e]||{username:this._configuration.authorization_user,password:this._configuration.password,realm:this._configuration.realm,ha1:this._configuration.ha1}}},{key:"updateCredential",value:function(e,t,n){e=this._credentials[e];e?(e.realm=t,e.ha1=n):(this.set("realm",t),this.set("ha1",n))}},{key:"sendOptions",value:function(e,t,n){R.debug("sendOptions()");var r=new m(this);return r.send(e,t,n),r}},{key:"terminateSessions",value:function(e){for(var t in R.debug("terminateSessions()"),this._sessions)this._sessions[t].isEnded()||this._sessions[t].terminate(e)}},{key:"stop",value:function(){var e=this;if(R.debug("stop()"),this._dynConfiguration={},this._status!==I.STATUS_USER_CLOSED){this._registrator.close();var t,n,r=Object.keys(this._sessions).length;for(t in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,t)){R.debug("closing session ".concat(t));try{this._sessions[t].terminate()}catch(e){}}for(n in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,n))try{this._applicants[n].close()}catch(e){}this._status=I.STATUS_USER_CLOSED,0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===r?this._transport.disconnect():this._closeTimer=setTimeout(function(){e._closeTimer=null,e._transport.disconnect()},2e3)}else R.debug("UA already closed")}},{key:"normalizeTarget",value:function(e){return y.normalizeTarget(e,this._configuration.hostport_params)}},{key:"get",value:function(e){switch(e){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:return void R.warn('get() | cannot get "%s" parameter in runtime',e)}}},{key:"set",value:function(e,t){switch(e){case"authorization_user":this._configuration.authorization_user=String(t);break;case"password":this._configuration.password=String(t);break;case"realm":this._configuration.realm=String(t);break;case"ha1":this._configuration.ha1=String(t),this._configuration.password=null;break;case"authorization_jwt":this._configuration.authorization_jwt=String(t);break;case"display_name":this._configuration.display_name=t;break;default:return R.warn('set() | cannot set "%s" parameter in runtime',e),!1}return!0}},{key:"registerRedirect",value:function(e){return!!this._transport._register_redirect(e)||(R.debug('registerRedirect: ignored, "'.concat(e,'" is not found in configuration')),!1)}},{key:"switchSBC",value:function(e){return this._transport._get_number_of_sbc()<2?(R.debug("switchSBC: ignored, no other SBC"),!1):(e&&this._registrator._unregistered(null,d.causes.CONNECTION_ERROR),this._transport._switch_sbc(),!0)}},{key:"getNumberOfSBC",value:function(){return this._transport._get_number_of_sbc()}},{key:"newTransaction",value:function(e){this._transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})}},{key:"destroyTransaction",value:function(e){delete this._transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})}},{key:"newDialog",value:function(e){this._dialogs[e.id]=e}},{key:"destroyDialog",value:function(e){delete this._dialogs[e.id]}},{key:"newMessage",value:function(e,t){this._applicants[e]=e,this.emit("newMessage",t)}},{key:"newOptions",value:function(e,t){this._applicants[e]=e,this.emit("newOptions",t)}},{key:"destroyMessage",value:function(e){delete this._applicants[e]}},{key:"newRTCSession",value:function(e,t){this._sessions[e.id]=e,this.emit("newRTCSession",t)}},{key:"destroyRTCSession",value:function(e){delete this._sessions[e.id]}},{key:"registered",value:function(e){this.emit("registered",e)}},{key:"unregistered",value:function(e){this.emit("unregistered",e)}},{key:"registrationFailed",value:function(e){this.emit("registrationFailed",e)}},{key:"receiveRequest",value:function(e){var t,n,r,s=e.method;if(e.ruri.user!==this._configuration.uri.user&&e.ruri.user!==this._contact.uri.user)R.debug("Request-URI does not point to us"),e.method!==d.ACK&&e.reply_sl(404);else if(e.ruri.scheme!==d.SIPS){if(!v.checkTransaction(this,e)){if(s===d.INVITE?new v.InviteServerTransaction(this,this._transport,e):s!==d.ACK&&s!==d.CANCEL&&new v.NonInviteServerTransaction(this,this._transport,e),s===d.OPTIONS){if(0===this.listeners("newOptions").length)return void e.reply(200);new m(this).init_incoming(e)}else if(s===d.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);new g(this).init_incoming(e)}else if(s===d.SUBSCRIBE){if(0===this.listeners("newSubscribe").length)return void e.reply(405)}else if(s===d.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);if(e.to_tag)(t=this._findDialog(e.call_id,e.from_tag,e.to_tag))?t.receiveRequest(e):s===d.NOTIFY?(n=this._findSession(e))?n.receiveRequest(e):(R.debug("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist")):s!==d.ACK&&e.reply(481);else switch(s){case d.INVITE:window.RTCPeerConnection?e.hasHeader("replaces")?(r=e.replaces,(t=this._findDialog(r.call_id,r.from_tag,r.to_tag))?(n=t.owner).isEnded()?e.reply(603):n.receiveRequest(e):e.reply(481)):(n=new _(this)).init_incoming(e):(R.warn("INVITE received but WebRTC is not supported"),e.reply(488));break;case d.BYE:e.reply(481);break;case d.CANCEL:(n=this._findSession(e))?n.receiveRequest(e):R.debug("received CANCEL request for a non existent session");break;case d.ACK:break;case d.NOTIFY:this.emit("sipEvent",{event:e.event,request:e}),e.reply(200);break;case d.SUBSCRIBE:this.emit("newSubscribe",{event:e.event,request:e});break;default:e.reply(405)}}}else e.reply_sl(416)}},{key:"_findSession",value:function(e){var t=e.call_id,n=this._sessions[t+e.from_tag],t=this._sessions[t+e.to_tag];return n||t||null}},{key:"_findDialog",value:function(e,t,n){var r=this._dialogs[e+t+n];return r||this._dialogs[e+n+t]||null}},{key:"_loadConfig",value:function(e){try{w.load(this._configuration,e)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=y.newUUID()),this._configuration.jssip_id=y.createRandomToken(5);var t=this._configuration.uri.clone();t.user=null,this._configuration.hostport_params=t.toString().replace(/^sip:/i,"");try{this._transport=new A(this,this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=function(e){this.emit("connecting",e)}.bind(this),this._transport.onconnect=function(e){this._status!==I.STATUS_USER_CLOSED&&(this._status=I.STATUS_READY,this._error=null,this.emit("connected",e),this._dynConfiguration.register)&&this._registrator.register()}.bind(this),this._transport.ondisconnect=function(e){for(var t=0,n=["nict","ict","nist","ist"];t<n.length;t++){var r,s=n[t];for(r in this._transactions[s])Object.prototype.hasOwnProperty.call(this._transactions[s],r)&&this._transactions[s][r].onTransportError()}this.emit("disconnected",e),this._registrator.onTransportClosed(),this._status!==I.STATUS_USER_CLOSED&&(this._status=I.STATUS_NOT_READY,this._error=I.NETWORK_ERROR)}.bind(this),this._transport.ondata=function(e){var t,n=e.transport,r=e.message;if((r=S.parseMessage(r,this))&&!(this._status===I.STATUS_USER_CLOSED&&r instanceof b.IncomingRequest)&&E(r,this,n))if(r instanceof b.IncomingRequest)r.transport=n,this.receiveRequest(r);else if(r instanceof b.IncomingResponse)switch(r.method){case d.INVITE:(t=this._transactions.ict[r.via_branch])&&t.receiveResponse(r);break;case d.ACK:break;default:(t=this._transactions.nict[r.via_branch])&&t.receiveResponse(r)}}.bind(this)}catch(e){throw R.warn(e),new C.ConfigurationError("sockets",this._configuration.sockets)}delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),this._configuration.registrar_server||((t=this._configuration.uri.clone()).user=null,t.clearParams(),t.clearHeaders(),this._configuration.registrar_server=t),this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new T("sip",y.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.anonymous||null,e=e.outbound||null,n="<";return n+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!e||(t?this.temp_gruu:this.pub_gruu)||(n+=";ob"),n+">"}};var n,r,s=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register"];for(n in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,n)&&(-1!==s.indexOf(n)?Object.defineProperty(this._configuration,n,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,n,{writable:!1,configurable:!1}));for(r in R.debug("configuration parameters after validation:"),this._configuration)if(Object.prototype.hasOwnProperty.call(w.settings,r))switch(r){case"uri":case"registrar_server":R.debug("- ".concat(r,": ").concat(this._configuration[r]));break;case"password":case"ha1":case"authorization_jwt":R.debug("- ".concat(r,": NOT SHOWN"));break;default:R.debug("- ".concat(r,": ").concat(JSON.stringify(this._configuration[r])))}}}]),s(t,e),r})()},{"./Config":1,"./Constants":2,"./Exceptions":6,"./Logger":9,"./Message":10,"./Notifier":12,"./Options":13,"./Parser":14,"./RTCSession":15,"./Registrator":20,"./SIPMessage":22,"./Subscriber":24,"./Transactions":26,"./Transport":27,"./URI":29,"./Utils":30,"./sanityCheck":32,events:33}],29:[function(e,t,n){function a(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?l(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=e("./Constants"),c=e("./Utils"),s=e("./Grammar");function d(e,t,n,r){var s,i,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},l=this;if(!(l instanceof d))throw new TypeError("Cannot call a class as a function");if(!n)throw new TypeError('missing or invalid "host" parameter');for(s in this._parameters={},this._headers={},this._scheme=e||u.SIP,this._user=t,this._host=n,this._port=r,o)Object.prototype.hasOwnProperty.call(o,s)&&this.setParam(s,o[s]);for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&this.setHeader(i,a[i])}t.exports=(e=[{key:"parse",value:function(e){return-1!==(e=s.parse(e,"SIP_URI"))?e:void 0}}],r((t=d).prototype,[{key:"scheme",get:function(){return this._scheme},set:function(e){this._scheme=e.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(e){this._user=e}},{key:"host",get:function(){return this._host},set:function(e){this._host=e.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(e){this._port=0===e?e:parseInt(e,10)||null}},{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){var t;if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e))return t=this._parameters[e],delete this._parameters[e],t}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(e,t){this._headers[c.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){if(e)return this._headers[c.headerize(e)]}},{key:"hasHeader",value:function(e){if(e)return!!this._headers.hasOwnProperty(c.headerize(e))}},{key:"deleteHeader",value:function(e){var t;if(e=c.headerize(e),this._headers.hasOwnProperty(e))return t=this._headers[e],delete this._headers[e],t}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new d(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var e,t,n=[],r="".concat(this._scheme,":");for(e in this._user&&(r+="".concat(c.escapeUser(this._user),"@")),r+=this._host,!this._port&&0!==this._port||(r+=":".concat(this._port)),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,e)&&(r+=";".concat(e),null!==this._parameters[e])&&(r+="=".concat(this._parameters[e]));for(t in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,t)){var s,i=a(this._headers[t]);try{for(i.s();!(s=i.n()).done;){var o=s.value;n.push("".concat(t,"=").concat(o))}}catch(n){i.e(n)}finally{i.f()}}return 0<n.length&&(r+="?".concat(n.join("&"))),r}},{key:"toAor",value:function(e){var t="".concat(this._scheme,":");return this._user&&(t+="".concat(c.escapeUser(this._user),"@")),t+=this._host,e&&(this._port||0===this._port)&&(t+=":".concat(this._port)),t}}]),r(t,e),d)},{"./Constants":2,"./Grammar":7,"./Utils":30}],30:[function(e,t,n){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?u(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i=e("./Constants"),o=e("./URI"),r=e("./Grammar"),c=(n.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length},n.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)}),s=(n.isString=function(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)},n.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},n.isEmpty=function(e){return null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e)},n.hasMethods=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var s=0,i=n;s<i.length;s++){var o=i[s];if(c(e[o]))return!1}return!0},n.createRandomToken=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,n="",r=0;r<e;r++)n+=(Math.random()*t|0).toString(t);return n}),d=(n.newTag=function(){return s(10)},n.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n.hostType=function(e){return e&&-1!==(e=r.parse(e,"host"))?e.host_type:void 0},n.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")});n.normalizeTarget=function(e,t){if(e){if(e instanceof o)return e;if("string"==typeof e){var n,r,s=e.split("@");switch(s.length){case 1:if(!t)return;n=e,r=t;break;case 2:n=s[0],r=s[1];break;default:n=s.slice(0,s.length-1).join("@"),r=s[s.length-1]}return n=n.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(n)&&(n=n.replace(/[-.()]/g,"")),e="".concat(i.SIP,":").concat(d(n),"@").concat(r),o.parse(e)||void 0}}},n.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},n=e.toLowerCase().replace(/_/g,"-").split("-"),r="",s=n.length,i=0;i<s;i++)0!==i&&(r+="-"),r+=n[i].charAt(0).toUpperCase()+n[i].substring(1);return r=t[r]?t[r]:r},n.sipErrorCause=function(e){for(var t in i.SIP_ERROR_CAUSES)if(-1!==i.SIP_ERROR_CAUSES[t].indexOf(e))return i.causes[t];return i.causes.SIP_FAILURE_CODE},n.getRandomTestNetIP=function(){return"192.0.2.".concat(Math.floor(254*Math.random()+1))},n.calculateMD5=function(e){function a(e,t){return e<<t|e>>>32-t}function l(e,t){var n=2147483648&e,r=2147483648&t,s=1073741824&e,i=1073741824&t,e=(1073741823&e)+(1073741823&t);return s&i?2147483648^e^n^r:s|i?1073741824&e?3221225472^e^n^r:1073741824^e^n^r:e^n^r}function t(e,t,n,r,s,i,o){return e=l(e,l(l(t&n|~t&r,s),o)),l(a(e,i),t)}function n(e,t,n,r,s,i,o){return e=l(e,l(l(t&r|n&~r,s),o)),l(a(e,i),t)}function r(e,t,n,r,s,i,o){return e=l(e,l(l(t^n^r,s),o)),l(a(e,i),t)}function s(e,t,n,r,s,i,o){return e=l(e,l(l(n^(t|~r),s),o)),l(a(e,i),t)}function i(e){for(var t="",n="",r=0;r<=3;r++)t+=(n="0".concat((e>>>8*r&255).toString(16))).substr(n.length-2,2);return t}for(var o,u,c,d,h=(e=>{for(var t,n=e.length,r=16*(((r=n+8)-r%64)/64+1),s=new Array(r-1),i=0,o=0;o<n;)i=o%4*8,s[t=(o-o%4)/4]=s[t]|e.charCodeAt(o)<<i,o++;return s[t=(o-o%4)/4]=s[t]|128<<(i=o%4*8),s[r-2]=n<<3,s[r-1]=n>>>29,s})(e=(e=>{for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):t=(t+=String.fromCharCode(r>>12|224))+String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t})(e)),_=1732584193,f=4023233417,p=2562383102,g=271733878,m=0;m<h.length;m+=16)_=t(o=_,u=f,c=p,d=g,h[m+0],7,3614090360),g=t(g,_,f,p,h[m+1],12,3905402710),p=t(p,g,_,f,h[m+2],17,606105819),f=t(f,p,g,_,h[m+3],22,3250441966),_=t(_,f,p,g,h[m+4],7,4118548399),g=t(g,_,f,p,h[m+5],12,1200080426),p=t(p,g,_,f,h[m+6],17,2821735955),f=t(f,p,g,_,h[m+7],22,4249261313),_=t(_,f,p,g,h[m+8],7,1770035416),g=t(g,_,f,p,h[m+9],12,2336552879),p=t(p,g,_,f,h[m+10],17,4294925233),f=t(f,p,g,_,h[m+11],22,2304563134),_=t(_,f,p,g,h[m+12],7,1804603682),g=t(g,_,f,p,h[m+13],12,4254626195),p=t(p,g,_,f,h[m+14],17,2792965006),_=n(_,f=t(f,p,g,_,h[m+15],22,1236535329),p,g,h[m+1],5,4129170786),g=n(g,_,f,p,h[m+6],9,3225465664),p=n(p,g,_,f,h[m+11],14,643717713),f=n(f,p,g,_,h[m+0],20,3921069994),_=n(_,f,p,g,h[m+5],5,3593408605),g=n(g,_,f,p,h[m+10],9,38016083),p=n(p,g,_,f,h[m+15],14,3634488961),f=n(f,p,g,_,h[m+4],20,3889429448),_=n(_,f,p,g,h[m+9],5,568446438),g=n(g,_,f,p,h[m+14],9,3275163606),p=n(p,g,_,f,h[m+3],14,4107603335),f=n(f,p,g,_,h[m+8],20,1163531501),_=n(_,f,p,g,h[m+13],5,2850285829),g=n(g,_,f,p,h[m+2],9,4243563512),p=n(p,g,_,f,h[m+7],14,1735328473),_=r(_,f=n(f,p,g,_,h[m+12],20,2368359562),p,g,h[m+5],4,4294588738),g=r(g,_,f,p,h[m+8],11,2272392833),p=r(p,g,_,f,h[m+11],16,1839030562),f=r(f,p,g,_,h[m+14],23,4259657740),_=r(_,f,p,g,h[m+1],4,2763975236),g=r(g,_,f,p,h[m+4],11,1272893353),p=r(p,g,_,f,h[m+7],16,4139469664),f=r(f,p,g,_,h[m+10],23,3200236656),_=r(_,f,p,g,h[m+13],4,681279174),g=r(g,_,f,p,h[m+0],11,3936430074),p=r(p,g,_,f,h[m+3],16,3572445317),f=r(f,p,g,_,h[m+6],23,76029189),_=r(_,f,p,g,h[m+9],4,3654602809),g=r(g,_,f,p,h[m+12],11,3873151461),p=r(p,g,_,f,h[m+15],16,530742520),_=s(_,f=r(f,p,g,_,h[m+2],23,3299628645),p,g,h[m+0],6,4096336452),g=s(g,_,f,p,h[m+7],10,1126891415),p=s(p,g,_,f,h[m+14],15,2878612391),f=s(f,p,g,_,h[m+5],21,4237533241),_=s(_,f,p,g,h[m+12],6,1700485571),g=s(g,_,f,p,h[m+3],10,2399980690),p=s(p,g,_,f,h[m+10],15,4293915773),f=s(f,p,g,_,h[m+1],21,2240044497),_=s(_,f,p,g,h[m+8],6,1873313359),g=s(g,_,f,p,h[m+15],10,4264355552),p=s(p,g,_,f,h[m+6],15,2734768916),f=s(f,p,g,_,h[m+13],21,1309151649),_=s(_,f,p,g,h[m+4],6,4149444226),g=s(g,_,f,p,h[m+11],10,3174756917),p=s(p,g,_,f,h[m+2],15,718787259),f=s(f,p,g,_,h[m+9],21,3951481745),_=l(_,o),f=l(f,u),p=l(p,c),g=l(g,d);return(i(_)+i(f)+i(p)+i(g)).toLowerCase()},n.closeMediaStream=function(e){if(e)try{if(e.getTracks){var t,n=l(e.getTracks());try{for(n.s();!(t=n.n()).done;)t.value.stop()}catch(e){n.e(e)}finally{n.f()}}else{var r,s=l(e.getAudioTracks());try{for(s.s();!(r=s.n()).done;)r.value.stop()}catch(e){s.e(e)}finally{s.f()}var i,o=l(e.getVideoTracks());try{for(o.s();!(i=o.n()).done;)i.value.stop()}catch(e){o.e(e)}finally{o.f()}}}catch(t){"function"!=typeof e.stop&&"object"!==a(e.stop)||e.stop()}},n.cloneArray=function(e){return e&&e.slice()||[]},n.cloneObject=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e&&Object.assign({},e)||t}},{"./Constants":2,"./Grammar":7,"./URI":29}],31:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("./Logger"),i=e("./Grammar"),o=new s("WebSocketInterface");function a(e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");o.debug('new() [url:"%s"]',e),this._url=e,this._sip_uri=null,this._via_transport=null,this._ws=null;var t=i.parse(e,"absoluteURI");if(-1===t)throw o.warn("invalid WebSocket URI: ".concat(e)),new TypeError("Invalid argument: ".concat(e));if("wss"!==t.scheme&&"ws"!==t.scheme)throw o.warn("invalid WebSocket URI scheme: ".concat(t.scheme)),new TypeError("Invalid argument: ".concat(e));this._sip_uri="sip:".concat(t.host).concat(t.port?":".concat(t.port):"",";transport=ws"),this._via_transport=t.scheme.toUpperCase()}t.exports=(r(a.prototype,[{key:"via_transport",get:function(){return this._via_transport},set:function(e){this._via_transport=e.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}},{key:"connect",value:function(){if(o.debug("connect()"),this.isConnected())o.debug("WebSocket ".concat(this._url," is already connected"));else if(this.isConnecting())o.debug("WebSocket ".concat(this._url," is connecting"));else{this._ws&&this.disconnect(),o.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}},{key:"disconnect",value:function(){o.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(e){return o.debug("send()"),this.isConnected()?(this._ws.send(e),!0):(o.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){o.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(e){var t=e.wasClean,n=e.code,e=e.reason;o.debug("WebSocket ".concat(this._url," closed")),!1===t&&o.debug("WebSocket abrupt disconnection"),this.ondisconnect(!t,n,e)}},{key:"_onMessage",value:function(e){e=e.data;o.debug("received WebSocket message"),this.ondata(e)}},{key:"_onError",value:function(e){o.warn("WebSocket ".concat(this._url," error: "),e)}}]),a)},{"./Grammar":7,"./Logger":9}],32:[function(e,t,n){function u(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=(e=>{var t;if(e)return"string"==typeof e?a(e,void 0):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,void 0):void 0})(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c,d,h,r=e("./Logger"),o=e("./Constants"),_=e("./SIPMessage"),i=e("./Utils"),s=new r("sanityCheck"),f=[function(){for(var e=0,t=["from","to","call_id","cseq","via"];e<t.length;e++){var n=t[e];if(!c.hasHeader(n))return s.debug("missing mandatory header field : ".concat(n,", dropping the response")),!1}}],p=[function(){if("sip"!==c.s("to").uri.scheme)return l(416),!1},function(){if(!c.to_tag&&c.call_id.substr(0,5)===d.configuration.jssip_id)return l(482),!1},function(){if(i.str_utf8_length(c.body)<c.getHeader("content-length"))return l(400),!1},function(){var e,t=c.from_tag,n=c.call_id,r=c.cseq;if(!c.to_tag)if(c.method===o.INVITE){if(d._transactions.ist[c.via_branch])return!1;for(var s in d._transactions.ist)if(Object.prototype.hasOwnProperty.call(d._transactions.ist,s)&&(e=d._transactions.ist[s]).request.from_tag===t&&e.request.call_id===n&&e.request.cseq===r)return l(482),!1}else{if(d._transactions.nist[c.via_branch])return!1;for(var i in d._transactions.nist)if(Object.prototype.hasOwnProperty.call(d._transactions.nist,i)&&(e=d._transactions.nist[i]).request.from_tag===t&&e.request.call_id===n&&e.request.cseq===r)return l(482),!1}}],g=[function(){if(1<c.getHeaders("via").length)return s.debug("more than one Via header field present in the response, dropping the response"),!1},function(){if(i.str_utf8_length(c.body)<c.getHeader("content-length"))return s.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];function l(e){var t,n=c.getHeaders("via"),r="SIP/2.0 ".concat(e," ").concat(o.REASON_PHRASE[e],"\r\n"),s=u(n);try{for(s.s();!(t=s.n()).done;)r+="Via: ".concat(t.value,"\r\n")}catch(e){s.e(e)}finally{s.f()}n=c.getHeader("To"),c.to_tag||(n+=";tag=".concat(i.newTag())),r=(r=(r=(r+="To: ".concat(n,"\r\n"))+"From: ".concat(c.getHeader("From"),"\r\n"))+"Call-ID: ".concat(c.call_id,"\r\n"))+"CSeq: ".concat(c.cseq," ").concat(c.method,"\r\n"),h.send(r+="\r\n")}t.exports=function(e,t,n){c=e,d=t,h=n;var r,s=u(f);try{for(s.s();!(r=s.n()).done;)if(!1===(0,r.value)())return!1}catch(e){s.e(e)}finally{s.f()}if(c instanceof _.IncomingRequest){var i,o=u(p);try{for(o.s();!(i=o.n()).done;)if(!1===(0,i.value)())return!1}catch(e){o.e(e)}finally{o.f()}}else if(c instanceof _.IncomingResponse){var a,l=u(g);try{for(l.s();!(a=l.n()).done;)if(!1===(0,a.value)())return!1}catch(e){l.e(e)}finally{l.f()}}return!0}},{"./Constants":2,"./Logger":9,"./SIPMessage":22,"./Utils":30}],33:[function(e,t,n){var d=Object.create||function(e){function t(){}return t.prototype=e,new t},o=Object.keys||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return t},r=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=d(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._maxListeners=void 0;var i,a=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),i=0===l.x}catch(e){i=!1}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var s,i;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return(s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener||n),s=e._events),i=s[t]):(s=e._events=d(null),e._eventsCount=0),i?("function"==typeof i?i=s[t]=r?[n,i]:[i,n]:r?i.unshift(n):i.push(n),!i.warned&&(r=u(e))&&0<r&&i.length>r&&(i.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+i.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=i.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",r.name,r.message)):(i=s[t]=n,++e._eventsCount),e}function h(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function _(e,t,n){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},t=r.call(h,e);return t.listener=n,e.wrapFn=t}function f(e,t,n){e=e._events;if(e){e=e[t];if(e)if("function"==typeof e)return n?[e.listener||e]:[e];else if(n){var r=e;for(var s=new Array(r.length),i=0;i<s.length;++i)s[i]=r[i].listener||r[i];return s;return}else return F(e,e.length);else;}return[]}function p(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function F(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}i?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');a=e}}):s.defaultMaxListeners=a,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){var t,n,r,s,i,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if((t=1<arguments.length?arguments[1]:t)instanceof Error)throw t;a=new Error('Unhandled "error" event. ('+t+")");throw a.context=t,a}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:var u=n,c=this;if(l)u.call(c);else for(var d=u.length,x=F(u,d),h=0;h<d;++h)x[h].call(c);break;case 2:var u=n,_=l,f=this,p=arguments[1];if(_)u.call(f,p);else for(var g=u.length,M=F(u,g),m=0;m<g;++m)M[m].call(f,p);break;case 3:var _=n,v=l,A=this,y=arguments[1],C=arguments[2];if(v)_.call(A,y,C);else for(var T=_.length,L=F(_,T),S=0;S<T;++S)L[S].call(A,y,C);break;case 4:var v=n,b=l,E=this,w=arguments[1],R=arguments[2],I=arguments[3];if(b)v.call(E,w,R,I);else for(var U=v.length,q=F(v,U),O=0;O<U;++O)q[O].call(E,w,R,I);break;default:for(s=new Array(r-1),i=1;i<r;i++)s[i-1]=arguments[i];var b=n,k=this,N=s;if(l)b.apply(k,N);else for(var P=b.length,H=F(b,P),D=0;D<P;++D)H[D].apply(k,N)}return!0},s.prototype.on=s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,s,i,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((r=this._events)&&(n=r[e]))if(n===t||n.listener===t)0==--this._eventsCount?this._events=d(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,i=n.length-1;0<=i;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,s=i;break}if(s<0)return this;if(0===s)n.shift();else{var a=n;for(var l=s,u=l+1,c=a.length;u<c;l+=1,u+=1)a[l]=a[u];a.pop()}1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.removeAllListeners=function(e){var t,n;if(n=this._events)if(n.removeListener){if(0===arguments.length){for(var r,s=o(n),i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);this.removeAllListeners("removeListener"),this._events=d(null),this._eventsCount=0}else if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i])}else 0===arguments.length?(this._events=d(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=d(null):delete n[e]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],34:[function(n,s,r){!function(t){!function(){r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");let t=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(t++,"%c"===e)&&(n=t)}),e.splice(n,0,r)}},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}return e=!e&&void 0!==t&&"env"in t?t.env.DEBUG:e},r.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage=(()=>{try{return localStorage}catch(e){}})(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),s.exports=n("./common")(r);var e=s.exports.formatters;e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}.call(this)}.call(this,n("_process"))},{"./common":35,_process:37}],35:[function(e,t,n){t.exports=function(t){function a(e){let n,t=null;function o(...i){if(o.enabled){let r=o,e=Number(new Date),t=e-(n||e),s=(r.diff=t,r.prev=n,r.curr=e,n=e,i[0]=a.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O"),0);i[0]=i[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";s++;n=a.formatters[n];if("function"==typeof n){let e=i[s];t=n.call(r,e),i.splice(s,1),s--}return t}),a.formatArgs.call(r,i),(r.log||a.log).apply(r,i)}}return o.namespace=e,o.useColors=a.useColors(),o.color=a.selectColor(e),o.extend=r,o.destroy=a.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null===t?a.enabled(e):t,set:e=>{t=e}}),"function"==typeof a.init&&a.init(o),o}function r(e,t){t=a(this.namespace+(void 0===t?":":t)+e);return t.log=this.log,t}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return((a.debug=a).default=a).coerce=function(e){return e instanceof Error?e.stack||e.message:e},a.disable=function(){var e=[...a.names.map(n),...a.skips.map(n).map(e=>"-"+e)].join(",");return a.enable(""),e},a.enable=function(e){let t;a.save(e),a.names=[],a.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")))},a.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=a.skips.length;t<n;t++)if(a.skips[t].test(e))return!1;for(t=0,n=a.names.length;t<n;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=e("ms"),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{a[e]=t[e]}),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return a.colors[Math.abs(n)%a.colors.length]},a.enable(a.load()),a}},{ms:36}],36:[function(e,t,n){var s=864e5;function i(e,t,n,r){t=1.5*n<=t;return Math.round(e/n)+" "+r+(t?"s":"")}t.exports=function(e,t){t=t||{};var n=typeof e;if(!("string"==n&&0<e.length)){if("number"==n&&isFinite(e))return t.long?(n=e,t=Math.abs(n),s<=t?i(n,t,s,"day"):36e5<=t?i(n,t,36e5,"hour"):6e4<=t?i(n,t,6e4,"minute"):1e3<=t?i(n,t,1e3,"second"):n+" ms"):(t=e,n=Math.abs(t),s<=n?Math.round(t/s)+"d":36e5<=n?Math.round(t/36e5)+"h":6e4<=n?Math.round(t/6e4)+"m":1e3<=n?Math.round(t/1e3)+"s":t+"ms");throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}n=e;if(!(100<(n=String(n)).length)){n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(n){var r=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}},{}],37:[function(e,t,n){var r,s,t=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return(r=setTimeout)(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(e){s=o}var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length)&&_()}function _(){if(!c){var e=a(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===o||!s)&&clearTimeout)return(s=clearTimeout)(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||c||a(_)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=p,t.addListener=p,t.once=p,t.off=p,t.removeListener=p,t.removeAllListeners=p,t.emit=p,t.prependListener=p,t.prependOnceListener=p,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],38:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s",t=(t+=null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v");return null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value)&&(t+=":%s"),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return(t=(t+=null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":""))+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],39:[function(e,t,n){var r=e("./parser"),e=e("./writer");n.write=e,n.parse=r.parse,n.parseParams=r.parseParams,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates,n.parseImageAttributes=r.parseImageAttributes,n.parseSimulcastStreamList=r.parseSimulcastStreamList},{"./parser":40,"./writer":41}],40:[function(e,t,n){function f(e){return String(Number(e))===e?Number(e):e}function r(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=f(n[1]):1===n.length&&1<t.length&&(e[n[0]]=void 0),e}var p=e("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},h=[],_=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],n=e.slice(2);"m"===t&&(h.push({rtp:[],fmtp:[]}),_=h[h.length-1]);for(var r=0;r<(p[t]||[]).length;r+=1){var s=p[t][r];if(s.reg.test(n)){var i=_;var o=n;var a=s.name&&s.names,a=(s.push&&!i[s.push]?i[s.push]=[]:a&&!i[s.name]&&(i[s.name]={}),s.push?{}:a?i[s.name]:i),l=o.match(s.reg),u=a,c=s.names;if((o=s.name)&&!c)u[o]=f(l[1]);else for(var d=0;d<c.length;d+=1)null!=l[d+1]&&(u[c[d]]=f(l[d+1]));s.push&&i[s.push].push(a);return}}}),t.media=h,t};n.parseParams=function(e){return e.split(/;\s?/).reduce(r,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(e){return e.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(f),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},n.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(r,{})})},n.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=f(e):(t=f(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},{"./grammar":38}],41:[function(e,t,n){function i(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var i=t.names[s];r.push(t.name?n[t.name][i]:n[t.names[s]])}else r.push(n[t.name]);return function(e){var n=1,r=arguments,s=r.length;return e.replace(a,function(e){if(s<=n)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,r)}var o=e("./grammar"),a=/%[sdv%]/g,l=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||l,r=t.innerOrder||u,s=[];return n.forEach(function(n){o[n].forEach(function(t){t.name in e&&null!=e[t.name]?s.push(i(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){s.push(i(n,t,e))})})}),e.media.forEach(function(e){s.push(i("m",o.m[0],e)),r.forEach(function(n){o[n].forEach(function(t){t.name in e&&null!=e[t.name]?s.push(i(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){s.push(i(n,t,e))})})})}),s.join("\r\n")+"\r\n"}},{"./grammar":38}],42:[function(e,t,n){t.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"3.9.0",homepage:"https://jssip.net",contributors:["Jos Luis Milln <jmillan@aliax.net> (https://github.com/jmillan)","Iaki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],types:"lib/JsSIP.d.ts",main:"lib-es5/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{"@types/debug":"^4.1.5","@types/node":"^14.14.34",debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},devDependencies:{"@babel/core":"^7.13.10","@babel/preset-env":"^7.13.10","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},scripts:{lint:"gulp lint",test:"gulp test",prepublishOnly:"gulp babel"}}},{}]},{},[8])(8)});class AudioCodesUA{constructor(){return this._isInitialized=!1,this.serverConfig={},this.account={user:null,userAuth:null,displayName:null,password:null,registerExpires:600,useSessionTimer:!1},this.constraints={audio:!0,video:!0},this.chromiumBased=[{n:"Edge",s:"edg/"},{n:"Opera",s:"opr/"},{n:"Samsung",s:"samsungbrowser/"},{n:"Yandex",s:"yabrowser/"}],this.modes={video_call_audio_answer_firefox_fix:!0,video_call_audio_answer_safari_fix:!0,ice_timeout_fix:2e3,chrome_rtp_timeout_fix:13,sbc_ha_pairs_mode:void 0,ringing_header_mode:void 0,sbc_switch_register5xx_mode:!0,cache_register_auth_mode:!0,check_remote_sdp_mode:!0},this.credentials=[],this.listeners={},this.registerExtraHeaders=null,this.jssipUA=null,this.browser="",this.browserVersion=0,this.browserName="",this.os="other",this.reconnectMin=2,this.reconnectMax=30,this.u17=void 0,this.activeCalls=0,this.wsSocket=null,this.wsOnMessage=null,this.wsPingMs=0,this.wsOrigPingMs=0,this.wsThrottlingPingMs=0,this.wsVisibility=!1,this.wsCall=!1,this.wsLog=0,this.wsPongTimeout=!0,this.wsIsThrottling=!1,this.wsPingJob=null,this.wsPingTime=null,this.wsNextPingTime=null,this.wsPongReceived=!1,this.wsPongSupported=null,this.wsPongTimeoutTime=null,this.wsPongDelays=null,this.wsPongDelaysIx=0,this.wsPongReport=0,this.wsPongReportCounter=0,this.wsPongDist=!1,this.dtmfUseWebRTC=!0,this.dtmfDuration=250,this.dtmfInterToneGap=250,this.enableAddVideo=!1,this.oauthToken=null,this.oauthTokenUseInInvite=!0,this.networkPriority=void 0,AudioCodesUA.ac_log=console.log,AudioCodesUA.js_log=null,void 0===AudioCodesUA.instance&&(AudioCodesUA.instance=this),this._detectBrowser(),this._detectOS(),this.webrtcapi=AudioCodesWebRTCWrapper,this.replacedCall=null,this.codecFilter=null,this.AUDIO=Symbol("audio"),this.VIDEO=Symbol("video"),this.RECVONLY_VIDEO=Symbol("recvonly_video"),AudioCodesUA.instance}version(){return"1.18.0"}getBrowserName(){return this.browserName}getBrowser(){return this.browser}getBrowserVersion(){return this.browserVersion}getOS(){return this.os}getWR(){return this.webrtcapi}checkAvailableDevices(){return this.getWR().checkAvailableDevices()}getServerAddress(){if(null===this.wsSocket)return null;let e=this.wsSocket.url;return e=e.endsWith("/")?e.slice(0,-1):e}setOAuthToken(e,t=!0){this.oauthToken=e,this.oauthTokenUseInInvite=t,this.setRegisterExtraHeaders(this.registerExtraHeaders)}setUserAgent(e){this.u17=e}setConstraints(e,t,n){var r=this.browser,s=this.browser+"|"+this.os;if(null===e||e===r||e===s){if(AudioCodesUA.ac_log(`AC: setConstraints ${e} ${t}  `+JSON.stringify(n)),"audio"!==t&&"video"!==t)throw new TypeError("Wrong type: "+t);this.constraints[t]=n}else AudioCodesUA.ac_log(`AC: setConstraints ${e} - ignored, no current browser`)}setConstraint(e,t,n){if(null!=n?AudioCodesUA.ac_log(`AC: setConstraint ${e} ${t}=`+JSON.stringify(n)):AudioCodesUA.ac_log(`AC: setConstraint remove ${e} `+t),"audio"!==e&&"video"!==e)throw new TypeError("Wrong type: "+e);null!=n?(!0===this.constraints[e]&&(this.constraints[e]={}),this.constraints[e][t]=n):!0!==this.constraints[e]&&!1!==this.constraints[e]&&(delete this.constraints[e][t],0===Object.keys(this.constraints[e]).length)&&(this.constraints[e]=!0)}setBrowsersConstraints(e){var t,n,r=this.browser,s=this.browser+"|"+this.os;for(t in e)t!==r&&t!==s||(void 0!==(n=e[t]).audio&&this.setConstraints(t,"audio",n.audio),void 0!==n.video&&this.setConstraints(t,"video",n.video))}setCodecFilter(e){e&&(AudioCodesUA.ac_log("AC: setCodecFilter "+JSON.stringify(e)),this.codecFilter=this._cf_unpack(e))}setServerConfig(e,t,n=[]){this.serverConfig={addresses:e,domain:t,iceServers:this._convertIceList(n)},AudioCodesUA.ac_log("AC: setServerConfig() "+JSON.stringify(this.serverConfig))}setReconnectIntervals(e,t){AudioCodesUA.ac_log(`AC: setReconnectIntervals min=${e} max=`+t),this.reconnectMin=e,this.reconnectMax=t}setAccount(e,t,n,r){null!=t&&0!==t.length||(t=void 0),null!=r&&0!==r.length||(r=e);var s=this.account;s.user=e,s.displayName=t,s.password=n,s.authUser=r}setRegisterExpires(e){AudioCodesUA.ac_log("AC: setRegisterExpires="+e),this.account.registerExpires=e}setUseSessionTimer(e){AudioCodesUA.ac_log("AC: setUseSessionTimer="+e),this.account.useSessionTimer=e}setDtmfOptions(e,t=null,n=null){AudioCodesUA.ac_log(`AC: setDtmfOptions useWebRTC=${e} duration=${t} interToneGap=`+n),this.dtmfUseWebRTC=e,null!==t&&(this.dtmfDuration=t),null!==n&&(this.dtmfInterToneGap=n)}setEnableAddVideo(e){AudioCodesUA.ac_log("AC: setEnableAddVideo="+e),this.enableAddVideo=e}getEnableAddVideo(){return this.enableAddVideo}getAccount(){return this.account}setListeners(e){AudioCodesUA.ac_log("AC: setListeners()");for(var t of["loginStateChanged","outgoingCallProgress","callTerminated","callConfirmed","callShowStreams","incomingCall","callHoldStateChanged"])if(!(t in e))throw new Error(t+" listener is missed");this.listeners=e}static getSessionStatusName(e){switch(e){case 0:return"NULL (0)";case 1:return"INVITE_SENT (1)";case 2:return"1XX_RECEIVED (2)";case 3:return"INVITE_RECEIVED (3)";case 4:return"WAITING_FOR_ANSWER (4)";case 5:return"ANSWERED (5)";case 6:return"WAITING_FOR_ACK (6)";case 7:return"CANCELED (7)";case 8:return"TERMINATED (8)";case 9:return"CONFIRMED (9)";default:return"Unknown ("+e+")"}}setAcLogger(e){AudioCodesUA.ac_log=e}setJsSipLogger(e){AudioCodesUA.js_log=e}isInitialized(){return this._isInitialized}setModes(e={}){AudioCodesUA.ac_log("AC: setModes() "+JSON.stringify(e)),Object.assign(this.modes,e),this._normalizeModes()}_normalizeModes(){function e(e,t){return"number"==typeof e&&e<=t?void 0:e}var t=this.modes;t.sbc_ha_pairs_mode=e(t.sbc_ha_pairs_mode,0),t.chrome_rtp_timeout_fix=e(t.chrome_rtp_timeout_fix,0)}init(e=!0){if(AudioCodesUA.ac_log("AC: init() autoLogin="+e),!this._isInitialized){this._isInitialized=!0,JsSIP.debug.enable("JsSIP:*"),JsSIP.debug.formatArgs=function(){AudioCodesUA.js_log&&(this.log=AudioCodesUA.js_log)};var t,n=[];for(t of this.serverConfig.addresses)t instanceof Array?n.push({socket:new JsSIP.WebSocketInterface(t[0]),weight:t[1]}):n.push(new JsSIP.WebSocketInterface(t));var r,e={sockets:n,uri:"sip:"+this.account.user+"@"+this.serverConfig.domain,contact_uri:"sip:"+this.account.user+"@"+this._randomToken(12)+".invalid;transport=ws",authorization_user:this.account.authUser,password:this.account.password,register:e,session_timers:this.account.useSessionTimer,register_expires:this.account.registerExpires,user_agent:this.u17,connection_recovery_min_interval:this.reconnectMin,connection_recovery_max_interval:this.reconnectMax};this.account.displayName&&0<this.account.displayName.length&&(e.display_name=this.account.displayName),this.jssipUA=new JsSIP.UA(e),this.setRegisterExtraHeaders(this.registerExtraHeaders),this._setUACallbacks(),AudioCodesUA.ac_log("AC: applied SDK modes: "+JSON.stringify(this.modes,(e,t)=>void 0===t?"<undefined>":t)),this.jssipUA.modes=this.modes;for(r of this.credentials)this.jssipUA.addCredential(r);this.credentials=[],this.jssipUA.start()}}deinit(){this._isInitialized=!1,this.jssipUA&&this.jssipUA.stop()}setRegisterExtraHeaders(t){if(this.registerExtraHeaders=t,this.jssipUA){let e=null!==t?t:[];null!==this.oauthToken&&(e=e.slice()).push("Authorization: Bearer "+this.oauthToken),this.jssipUA.registrator().setExtraHeaders(e)}}getRegisterExtraHeaders(){return this.registerExtraHeaders}login(){AudioCodesUA.ac_log("AC: login()"),this.jssipUA.register()}logout(){AudioCodesUA.ac_log("AC: logout()"),this.jssipUA.isRegistered()&&this.jssipUA.unregister()}switchSBC(e=!0){return AudioCodesUA.ac_log("AC: switchSBC()"),this.jssipUA.switchSBC(e)}getNumberOfSBC(){return this.jssipUA.getNumberOfSBC()}setWebSocketKeepAlive(e,t=!0,n=!0,r=0,s=!1){if(AudioCodesUA.ac_log(`AC: setWebSocketKeepAlive pingInterval=${e} pongTimeout=`+t+` timerThrottlingBestEffort=${JSON.stringify(n)} pongReport=${r} pongDist=`+s),"number"!=typeof e||"boolean"!=typeof t)throw new TypeError("setWebSocketKeepAlive: wrong type of first or second argument");this.wsPingMs=this.wsOrigPingMs=1e3*e,this.wsPongTimeout=t,this.wsPongReport=r,this.wsPongDist=s,this.wsPongReportCounter=0;t=(e=!(this.wsIsThrottling=!1)===n?{log:0,chrome:{interval:1,visibility:!0,call:!0,log:1}}:!1===n?{log:0}:n)[this.browser];this.wsThrottlingPingMs=t&&void 0!==t.interval?1e3*t.interval:0,this.wsVisibility=!(!t||void 0===t.visibility)&&t.visibility,this.wsCall=!(!t||void 0===t.call)&&t.call,this.wsLog=(t&&void 0!==t.log?t:e).log,this.wsPongDelays=new Array(0<this.wsPongReport?this.wsPongReport:50),(this.wsPongDelaysIx=0)!==this.wsOrigPingMs&&0!==this.wsThrottlingPingMs&&this.wsVisibility&&document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))}_pingLog(){return` (ping=${this.wsPingMs/1e3} sec)`}_visibilityLog(e){let t="AC: keep-alive: Page is "+(document.hidden?"hidden":"visible");document.hidden&&(this.wsCall&&(t+=", "+(0===this.activeCalls?"no active call":"active call")),t+=" and "+(this.wsIsThrottling?"was":"was not")+" trottling"),e&&(t+=this._pingLog()),AudioCodesUA.ac_log(t)}_activeCallsLog(e){let t="AC: keep-alive: "+(0===this.activeCalls?"Call ended":"Call started");0===this.activeCalls&&(this.wsVisibility&&(t+=", page is "+(document.hidden?"hidden":"visible")),t+=" and "+(this.wsIsThrottling?"was":"was not")+" trottling"),e&&(t+=this._pingLog()),AudioCodesUA.ac_log(t)}_onActiveCallsChange(e){this.activeCalls+=e,this.wsCall&&0!==this.wsPingMs&&0!==this.wsThrottlingPingMs&&(this.activeCalls<0&&AudioCodesUA.ac_log("Warning: keep-alive: activeCalls < 0"),0===this.activeCalls?(!this.wsVisibility||document.hidden)&&this.wsIsThrottling&&this.wsPingMs<this.wsThrottlingPingMs?(this.wsPingMs=this.wsThrottlingPingMs,this._activeCallsLog(!0)):2<=this.wsLog&&this._activeCallsLog(!1):1===this.activeCalls&&0<e&&(this.wsPingMs>this.wsOrigPingMs?(this.wsPingMs=this.wsOrigPingMs,this._activeCallsLog(!0)):2<=this.wsLog&&this._activeCallsLog(!1)))}_onVisibilityChange(){this.wsVisibility&&0!==this.wsPingMs&&0!==this.wsThrottlingPingMs&&(document.hidden?this.wsCall&&0===this.activeCalls&&this.wsIsThrottling&&this.wsPingMs<this.wsThrottlingPingMs?(this.wsPingMs=this.wsThrottlingPingMs,this._visibilityLog(!0)):2<=this.wsLog&&this._visibilityLog(!1):this.wsPingMs>this.wsOrigPingMs?(this.wsPingMs=this.wsOrigPingMs,this._visibilityLog(!0)):2<=this.wsLog&&this._visibilityLog(!1))}_onMessageHook(e){"\r\n"===e.data?this._onPong():this.wsOnMessage(e)}_onPong(){let e,t=(this.wsPongReceived=!0,null===this.wsPongSupported&&(AudioCodesUA.ac_log("AC: keep-alive: Server supports CRLF pong"),this.wsPongSupported=!0),null!==this.wsPongTimeoutTime?(e=Date.now()-this.wsPongTimeoutTime,this.wsPongTimeoutTime=null,AudioCodesUA.ac_log("AC: keep-alive: Received pong that exceeded the timeout, delay="+e)):e=Date.now()-this.wsPingTime,this.wsPingMs-e);t<0&&(AudioCodesUA.ac_log(`AC: nextPing calculated to ${t}ms, so resetting to 0ms.`),t=0),null!==this.wsPingJob&&clearTimeout(this.wsPingJob),this.wsPingJob=setTimeout(this._sendPing.bind(this),t),this.wsPongDelays[this.wsPongDelaysIx]=e,this.wsPongDelaysIx=this.wsPongDelaysIx+1,this.wsPongDelaysIx===this.wsPongDelays.length&&(this.wsPongDelaysIx=0),0<this.wsPongReport&&this.wsPongReportCounter++}_onPongTimeout(e){if(AudioCodesUA.ac_log(`AC: keep-alive: Pong timeout (not received within ${e/1e3} seconds)`),AudioCodesUA.ac_log("AC: keep-alive: Previous pongs statistics: "+this._createPongReport(!0)),this.wsPongTimeout){AudioCodesUA.ac_log("AC: keep-alive: Close websocket connection"),this._stopWsKeepAlive();try{this.wsSocket.close()}catch(e){AudioCodesUA.ac_log("AC: Close websocket error",e)}}else AudioCodesUA.ac_log("AC: keep-alive: Warning: websocket is not closed, because pongTimeout=false")}_sendPing(){try{var e=Date.now();if(null!==this.wsPingTime){var t=e-this.wsNextPingTime,n=(3<=this.wsLog&&AudioCodesUA.ac_log("AC: keep-alive: timer deviation (ms): "+t),this.wsPingMs);if(1e4<=Math.abs(t)&&((0<this.wsLog||!this.wsIsThrottling)&&(AudioCodesUA.ac_log(`AC: keep-alive detected timer throttling: ${Math.round(t/1e3)} seconds `+(0<t?"later":"earlier")),0===this.wsLog)&&AudioCodesUA.ac_log("AC: keep-alive: The next timer throttling will not be shown in the logs, because log==0"),this.wsIsThrottling=!0,this.wsPingMs<this.wsThrottlingPingMs)&&(this.wsPingMs=this.wsThrottlingPingMs,AudioCodesUA.ac_log("AC: keep-alive: ping interval increased "+this._pingLog())),null!==this.wsPongSupported||this.wsPongReceived||(AudioCodesUA.ac_log("AC: keep-alive: Server does not support CRLF pong."),this.wsPongSupported=!1),this.wsPongSupported&&!this.wsPongReceived&&null===this.wsPongTimeoutTime){if(this._onPongTimeout(n),this.wsPongTimeout)return;this.wsPongTimeoutTime=this.wsPingTime}}this.wsPingTime=e,this.wsNextPingTime=this.wsPingTime+this.wsPingMs,this.wsPongReceived=!1,this.wsSocket.readyState===WebSocket.OPEN?this.wsSocket.send("\r\n\r\n"):AudioCodesUA.ac_log("AC: keep-alive: Warning: Cannot send Ping, websocket state="+this.wsSocket.readyState),this.wsPingJob=setTimeout(this._sendPing.bind(this),this.wsPingMs),0<this.wsPongReport&&this.wsPongReportCounter>=this.wsPongReport&&(this.wsPongReportCounter=0,AudioCodesUA.ac_log("AC: keep-alive: Pong statistics: "+this._createPongReport(this.wsPongDist)))}catch(e){AudioCodesUA.ac_log("AC: keep-alive: send ping error",e)}}_startWsKeepAlive(e){this.wsSocket=e,0!==this.wsPingMs&&(this.wsOnMessage=e.onmessage,e.onmessage=this._onMessageHook.bind(this),this._stopWsKeepAlive(),this.wsPingTime=null,this.wsPingJob=setTimeout(this._sendPing.bind(this),this.wsPingMs))}_stopWsKeepAlive(){null!==this.wsPingJob&&(clearTimeout(this.wsPingJob),this.wsPingJob=null)}_createPongReport(t){let n,r="",s=!1,i=1e6,o=0,a=(t&&(n=new Array(this.wsPingMs/1e3*4).fill(0)),0);for(let e=0;e<this.wsPongDelays.length;e++){var l=this.wsPongDelays[e];if(void 0!==l&&(a++,l<i&&(i=l),l>o&&(o=l),t)){let e=Math.floor(l/250);e>=n.length&&(e=n.length-1,s=!0),n[e]++}}if(t){r="\r\npongs distribution (1/4 second step): ";for(let e=0;e<n.length;e++)r+=n[e].toString(),e!==n.length-1&&(r+=(e+1)%4==0?",":" ");s&&(r+=" (+)")}return`pongs=${a} delay=${i}..${o} ms`+r}_setUACallbacks(){this.jssipUA.on("connected",e=>{AudioCodesUA.ac_log('AC>>: loginStateChanged: isLogin=false "connected"'),this._startWsKeepAlive(e.socket.socket._ws),this.listeners.loginStateChanged(!1,"connected",null)}),this.jssipUA.on("disconnected",()=>{this._stopWsKeepAlive(),AudioCodesUA.ac_log('AC>>: loginStateChanged: isLogin=false "disconnected"'),this.listeners.loginStateChanged(!1,"disconnected",null)}),this.jssipUA.on("registered",e=>{AudioCodesUA.ac_log('AC>>: loginStateChanged: isLogin=true "login"'),this.listeners.loginStateChanged(!0,"login",e.response)}),this.jssipUA.on("unregistered",e=>{AudioCodesUA.ac_log('AC>>: loginStateChanged: isLogin=false "logout"'),this.listeners.loginStateChanged(!1,"logout",e.response)}),this.jssipUA.on("registrationFailed",e=>{var t=e.response?e.response.status_code:0;if(300<=t&&t<400){var n=e.response.parseHeader("contact");if(n){let e=n.uri,t="wss://"+e.host;if(e.port&&443!==e.port&&(t+=":"+e.port.toString()),AudioCodesUA.ac_log(`AC: registerRedirect("${t}")`),this.jssipUA.registerRedirect(t))return}else AudioCodesUA.ac_log('AC: 3xx response without "Contact" is ignored')}else if(500<=t&&t<600&&AudioCodesUA.instance.modes.sbc_switch_register5xx_mode&&AudioCodesUA.instance.switchSBC(!1))return;AudioCodesUA.ac_log('AC>>: loginStateChanged: isLogin=false "login failed"'),this.listeners.loginStateChanged(!1,"login failed",e.response||null)}),this.listeners.incomingMessage&&this.jssipUA.on("newMessage",e=>{"remote"===e.originator&&(AudioCodesUA.ac_log("AC>>: incomingMessage",e),this.listeners.incomingMessage(null,AudioCodesUA.instance._get_from(e.request),AudioCodesUA.instance._get_content_type(e.request),e.request.body,e.request))}),this.listeners.incomingNotify&&this.jssipUA.on("sipEvent",e=>{AudioCodesUA.ac_log("AC>>: incoming out of dialog NOTIFY",e),this.listeners.incomingNotify(null,e.event?e.event.event:null,AudioCodesUA.instance._get_from(e.request),AudioCodesUA.instance._get_content_type(e.request),e.request.body,e.request)||e.request.reply(481)}),this.listeners.incomingSubscribe&&this.jssipUA.on("newSubscribe",e=>{var e=e.request,t=e.parseHeader("event"),n=e.getHeaders("accept"),t=(AudioCodesUA.ac_log("AC>>: incomingSubscribe",e,t.event,n),this.listeners.incomingSubscribe(e,t.event,n));0<t&&e.reply(t)}),this.jssipUA.on("newRTCSession",function(s){AudioCodesUA.ac_log(`AC: event ${"remote"===s.originator?"incoming":"outgoing"} "newRTCSession"`,s);let e,i=new AudioCodesSession(s.session);if(i.js_session.on("sipEvent",function(e){var t;AudioCodesUA.instance.listeners.incomingNotify&&(t=this.data.ac_session,AudioCodesUA.ac_log("AC>>: incoming NOTIFY",t,e),e.taken=AudioCodesUA.instance.listeners.incomingNotify(t,e.event?e.event.event:null,AudioCodesUA.instance._get_from(e.request),AudioCodesUA.instance._get_content_type(e.request),e.request.body,e.request))}),i.js_session.on("newInfo",function(e){var t;AudioCodesUA.instance.listeners.incomingInfo&&"local"!==e.originator&&(t=this.data.ac_session,AudioCodesUA.ac_log("AC>>: incoming INFO",t,e),AudioCodesUA.instance.listeners.incomingInfo(t,AudioCodesUA.instance._get_from(e.request),AudioCodesUA.instance._get_content_type(e.request),e.request.body,e.request))}),i.js_session.on("replaces",function(e){AudioCodesUA.instance.replacedCall=this.data.ac_session,AudioCodesUA.ac_log("AC>>: incoming INVITE with Replaces. This call will be replaced:",this.data.ac_session),e.accept()}),i.js_session.on("sdp",function(e){AudioCodesUA.instance._sdp_checking(this,e)}),i.js_session.on("connecting",function(e){AudioCodesUA.ac_log("AC>>: connecting");var t=AudioCodesUA.instance.codecFilter;t&&(AudioCodesUA.instance._cf_filter("audio",this.data.ac_session,t.audio),AudioCodesUA.instance._cf_filter("video",this.data.ac_session,t.video))}),i.js_session.on("reinvite",function(t){if(AudioCodesUA.instance.listeners.callIncomingReinvite){let e=this.data.ac_session;AudioCodesUA.ac_log("AC>>: callIncomingReinvite start"),AudioCodesUA.instance.listeners.callIncomingReinvite(e,!0,t.request),t.callback=function(){AudioCodesUA.ac_log("AC>>: callIncomingIncomingReinvite end"),AudioCodesUA.instance.listeners.callIncomingReinvite(e,!1,null)}}}),i.js_session.on("hold",function(e){var t=this.data.ac_session,e="remote"===e.originator;AudioCodesUA.ac_log(`AC>>: callHoldStateChanged isHold=true isRemote=${e} session:`,t),AudioCodesUA.instance.listeners.callHoldStateChanged(t,!0,e)}),i.js_session.on("unhold",function(e){var t=this.data.ac_session,e="remote"===e.originator;AudioCodesUA.ac_log(`AC>>: callHoldStateChanged isHold=false isRemote=${e} session:`,t),AudioCodesUA.instance.listeners.callHoldStateChanged(t,!1,e)}),i.js_session.on("progress",function(e){var t;"remote"===e.originator&&(t=this.data.ac_session,AudioCodesUA.ac_log("AC>>: outgoingCallProgress",t),AudioCodesUA.instance.listeners.outgoingCallProgress(t,e.response))}),i.js_session.on("failed",function(e){let t=this.data.ac_session,n=null;var r;"Redirected"===e.cause&&e.message&&e.message.headers&&(r=e.message.parseHeader("Contact"))&&(n=r.uri.toString()),AudioCodesUA.ac_log("AC>>: callTerminated (failed)",t,e.cause,n),AudioCodesUA.instance.listeners.callTerminated(t,e.message,e.cause,n)}),i.js_session.on("accepted",function(e){var t=this.data.ac_session;t.data._accepted=!0,"remote"===e.originator&&(t.data._ok_response=e.response)}),"remote"===s.originator&&null!==AudioCodesUA.instance.replacedCall&&i.js_session.removeAllListeners("confirmed"),i.js_session.on("confirmed",function(){let e,t=this.data.ac_session,n=null;e="_ok_response"in t.data?(n=t.data._ok_response,delete t.data._ok_response,"ACK sent"):"ACK received",i.data._video_call_audio_answer_firefox&&(i.data._video_call_audio_answer_firefox=!1,AudioCodesUA.ac_log("AC: [video call/audio answer] Firefox workaround. Send re-INVITE"),i.sendReInvite({showStreams:!0})),AudioCodesUA.ac_log("AC>>: callConfirmed",t,e),AudioCodesUA.instance._onActiveCallsChange.call(AudioCodesUA.instance,1),AudioCodesUA.instance.listeners.callConfirmed(t,n,e)}),i.js_session.on("ended",function(e){var t=this.data.ac_session;t.data._screenSharing&&t._onEndedScreenSharing.call(t,"call terminated"),AudioCodesUA.ac_log("AC>>: callTerminated (ended)",t,e.cause),AudioCodesUA.instance._onActiveCallsChange.call(AudioCodesUA.instance,-1),AudioCodesUA.instance.listeners.callTerminated(t,e.message,e.cause)}),i.js_session.on("refer",function(e){if(AudioCodesUA.instance.listeners.transfereeCreatedCall){let t=this.data.ac_session;var n;!AudioCodesUA.instance.listeners.transfereeRefer||AudioCodesUA.instance.listeners.transfereeRefer(t,e.request)?(AudioCodesUA.ac_log("AC>>: incoming REFER accepted"),n=t.isScreenSharing()?t.doesScreenSharingReplaceCamera():t.hasSendVideo(),n=AudioCodesUA.instance._callOptions(n,!0),e.accept(e=>{e.data._created_by_refer=t},n)):(AudioCodesUA.ac_log("AC>>: incoming REFER rejected"),e.reject())}else AudioCodesUA.ac_log("AC>>: incoming REFER rejected, because transfereeCreatedCall is not set"),e.reject()}),i._setEnabledReceiveVideo(AudioCodesUA.instance.enableAddVideo),i.js_session.connection?(AudioCodesUA.instance._set_connection_listener(i),AudioCodesUA.ac_log('AC: connection exists, set "track" listener')):(AudioCodesUA.ac_log("AC: peer connection does not exist, wait creation"),i.js_session.on("peerconnection",()=>{AudioCodesUA.instance._set_connection_listener(i),AudioCodesUA.ac_log('AC: [event connection] connection created, set "track" listener')})),e="remote"===s.originator?s.request.from:s.request.to,i.data._user=e.uri.user,i.data._host=e.uri.host,i.data._display_name=e.display_name,i.data._create_time=new Date,"remote"===s.originator){let e,t,n,r=null;var o;null!==AudioCodesUA.instance.replacedCall&&(r=AudioCodesUA.instance.replacedCall,AudioCodesUA.instance.replacedCall=null),s.request.body?(n=!0,o=new AudioCodesSDP(s.request.body),[e,t]=o.getMediaDirection("video",!0)):(n=!1,i.data._incoming_invite_without_sdp=!0,e=t=!0,AudioCodesUA.ac_log("AC: warning incoming INVITE without SDP")),i._setVideoState(e,t),AudioCodesUA.ac_log(`AC>>: incomingCall ${i.hasVideo()?"video":"audio"} from "${i.data._display_name}" `+i.data._user,i,r),AudioCodesUA.instance.listeners.incomingCall(i,s.request,r,n)}else i.js_session.data._created_by_refer?(AudioCodesUA.ac_log("AC>>: outgoing call created by REFER"),i.data._created_by_refer=i.js_session.data._created_by_refer,AudioCodesUA.instance.listeners.transfereeCreatedCall(i)):AudioCodesUA.ac_log("AC>>: outgoing call created by phone.call()")})}_get_from(e){return{user:e.from.uri.user,host:e.from.uri.host,displayName:e.from.display_name||null}}_get_content_type(e){e=e.headers["Content-Type"];return e&&0<e.length?e[0].parsed:null}_set_connection_listener(r){AudioCodesUA.instance.getWR().connection.addEventListener(r.js_session.connection,"track",n=>{var e,t;AudioCodesUA.ac_log('AC>>: "track" event kind= '+n.track.kind,n),0<n.streams.length?(e=n.streams[0],AudioCodesUA.ac_log("AC: set call remote stream id="+e.id,r),r.data._remoteMediaStream=e):AudioCodesUA.ac_log('AC: Warning "track" event without stream'),"video"===n.track.kind?(r.hasEnabledReceiveVideo()||(r.data._video_call_audio_answer_safari&&(n.track.onmute=()=>{AudioCodesUA.ac_log('AC: [video call/audio answer] Safari fix. Fired video track "mute" event.  Call callShowStream'),n.track.onmute=null;var e=r.getRTCLocalStream(),t=r.getRTCRemoteStream();AudioCodesUA.ac_log("AC>>: callShowStreams",r,e,t),AudioCodesUA.instance.listeners.callShowStreams(r,e,t)},AudioCodesUA.ac_log('AC: [video call/audio answer] Safari fix. Set video track "mute" event listener'),r.data._video_call_audio_answer_safari=!1),AudioCodesUA.ac_log('AC>>: event "track" video and !hasEnabledReceiveVideo therefore change transceiver direction.',r),null!==(e=AudioCodesUA.instance.getWR().connection.getTransceiver(r.js_session.connection,"video"))&&(t=r.hasEnabledSendVideo()?"sendonly":"inactive",AudioCodesUA.instance.getWR().transceiver.setDirection(e,t))),AudioCodesUA.instance.codecFilter&&AudioCodesUA.instance._cf_filter("video",r,AudioCodesUA.instance.codecFilter.video)):(e=r.getRTCLocalStream(),t=r.getRTCRemoteStream(),AudioCodesUA.ac_log("AC>>: callShowStreams",r,e,t),AudioCodesUA.instance.listeners.callShowStreams(r,e,t))})}_check_remote_sdp(e,t){try{t.codec_map||(t.codec_map={});var n=e.getMedia("audio"),r=(AudioCodesUA.instance._check_remote_m(n,t.codec_map),e.getMedia("video"));r&&AudioCodesUA.instance._check_remote_m(r,t.codec_map)}catch(e){AudioCodesUA.ac_log("AC:SDP exception",e)}}_check_remote_m(e,n){var t,r,s,i,o,a={};function l(e,t){var n=t.indexOf(" ",e);return-1===n?["?","?"]:[t.substring(e,n),t.substring(n+1).toLowerCase()]}for(t of e)t.startsWith("a=rtpmap:")?([r,s]=l(9,t),a[r]||(a[r]={}),a[r].rtpmap=s):t.startsWith("a=fmtp:")&&([r,s]=l(7,t),a[r]||(a[r]={}),a[r].fmtp=s);for(i of Object.keys(a))if(n[i])a[i].rtpmap===n[i].rtpmap?a[i].fmtp!==n[i].fmtp&&AudioCodesUA.ac_log(`AC:SDP [The same payload type and codec name, different fmtp] pt=${i} rtpmap=${a[i].rtpmap} fmtp=${a[i].fmtp}, previously was fmtp=`+n[i].fmtp):(64<=parseInt(i)||a[i].rtpmap&&n[i].rtpmap)&&AudioCodesUA.ac_log(`AC:SDP [The same payload type, different codec names] pt=${i} rtpmap=${a[i].rtpmap}, previously was rtpmap=`+n[i].rtpmap);else{let e,t=a[i];for(var[u,c]of Object.entries(n))if(t.rtpmap===c.rtpmap&&t.fmtp===c.fmtp){e=u;break}e?(o=n[e],t.fmtp||o.fmtp?AudioCodesUA.ac_log(`AC:SDP [The same codec name used with different payload types] pt=${i} rtpmap=${t.rtpmap} fmtp=${t.fmtp}, previously was pt=${e} rtpmap=${o.rtpmap} fmtp=`+o.fmtp):AudioCodesUA.ac_log(`AC:SDP [The same codec name used with different payload types] pt=${i} rtpmap=${t.rtpmap}, previously was pt=${e} rtpmap=`+o.rtpmap)):n[i]=t}}_sdp_checking(e,t){let n,r,s,i=t.originator+" "+t.type,o=e.data.ac_session;try{n=new AudioCodesSDP(t.sdp),[r,s]=n.getMediaDirection("video","remote"===t.originator)}catch(t){return void AudioCodesUA.ac_log("AC: cannot parse SDP",t)}var a=o.data._initial;switch("answer"===t.type&&(o.data._initial=!1),AudioCodesUA.ac_log(`AC: Event "sdp" ${a?"initial":""} ${i}   Session state:`+AudioCodesUA.getSessionStatusName(e._status)),i){case"remote offer":AudioCodesUA.instance.modes.check_remote_sdp_mode&&AudioCodesUA.instance._check_remote_sdp(n,e.data);break;case"remote answer":AudioCodesUA.instance.modes.check_remote_sdp_mode&&AudioCodesUA.instance._check_remote_sdp(n,e.data),o.isLocalHold()||o.isRemoteHold()||o._setVideoState(r,s);break;case"local offer":AudioCodesUA.instance.networkPriority&&AudioCodesUA.instance._set_senders_dscp(e);break;case"local answer":o.isLocalHold()||o.isRemoteHold()||(AudioCodesUA.instance.networkPriority&&AudioCodesUA.instance._set_senders_dscp(e),o._setVideoState(r,s))}}_set_senders_dscp(e){var t;"chrome"===AudioCodesUA.instance.browser&&(AudioCodesUA.ac_log("AC: _set_senders_dscp()"),t=AudioCodesUA.instance.networkPriority,AudioCodesUA.instance._set_dscp(e,"audio",t),AudioCodesUA.instance._set_dscp(e,"video",t))}_set_dscp(e,r,s){let t=e.connection,i=AudioCodesUA.instance.getWR().connection.getTransceiver(t,r);return i||"video"!==r?Promise.resolve().then(()=>{var e=i.sender.getParameters();if(!e)throw new Error("sender getParameters() returns undefined");var t=e.encodings;if(!t)throw new Error("parameters encodings is undefined");if(0===t.length)throw new Error("parameters encodings is empty array");var n=t[0].networkPriority;if(n)return n===s||(t[0].networkPriority=s,i.sender.setParameters(e).then(()=>(AudioCodesUA.ac_log(`AC: DSCP: ${r} "${s}"`),!0)));throw new Error("parameters encodings networkPriority is undefined")}).catch(e=>(AudioCodesUA.ac_log(`AC: DSCP: ${r} error: `+e),!1)):Promise.resolve(!1)}_cf_unpack(e){if(!e)return null;var t={};for(let i in e)for(var n in t[i]={},e[i])t[i][n]=e[i][n].map(e=>{return t=i,n=(e=e).indexOf("/"),r=e.indexOf("#"),s=-1!==n?n:-1!==r?r:void 0,t={mimeType:(t+"/"+e.substring(0,s)).toLowerCase()},-1!==n&&(t.clockRate=parseInt(e.substring(n+1,-1!==r?r:void 0))),-1!==r&&(t.sdpFmtpLine=e.substring(r+1)),t;var t,n,r,s});return t}_cf_pack(e){return e.map(t=>{{let e=t.mimeType.substring(6).toLowerCase();return t.clockRate&&(e+="/"+t.clockRate),t.sdpFmtpLine&&(e+="#"+t.sdpFmtpLine),e}})}_cf_str(e){return JSON.stringify(AudioCodesUA.instance._cf_pack(e))}_cf_match(e,t){var n,r=e.mimeType.toLowerCase();for(n of t)if(n.mimeType===r){if(n.clockRate&&n.clockRate!==e.clockRate)continue;if(n.sdpFmtpLine&&n.sdpFmtpLine!==e.sdpFmtpLine)continue;return!0}return!1}_cf_find(e,t){var n,r=[];for(n of t){var s=n.mimeType.toLowerCase();e.mimeType!==s||e.clockRate&&e.clockRate!==n.clockRate||e.sdpFmtpLine&&e.sdpFmtpLine!==n.sdpFmtpLine||r.push(n)}return r}_cf_filter(t,e,r){if(r&&!e.data[`_used_${t}_codec_filter`])try{var n=e.getRTCPeerConnection(),s=AudioCodesUA.instance.getWR().connection.getTransceiver(n,t);if(s)if(e.data[`_used_${t}_codec_filter`]=!0,RTCRtpSender.getCapabilities&&RTCRtpReceiver.getCapabilities&&s.setCodecPreferences){var i,o=RTCRtpSender.getCapabilities(t).codecs,a=RTCRtpReceiver.getCapabilities(t).codecs,l=[];for(let t of a)-1===o.findIndex(e=>t.mimeType===e.mimeType&&t.clockRate===e.clockRate&&t.sdpFmtpLine===e.sdpFmtpLine)&&l.push(t);let n=o.concat(l);if(AudioCodesUA.ac_log(`AC: ${t} codec-filter original: ${AudioCodesUA.instance._cf_str(n)}
(receiver: ${l.length})`),r.remove&&0<r.remove.length&&(i=n.length,(n=n.filter(e=>!AudioCodesUA.instance._cf_match(e,r.remove))).length<i)&&AudioCodesUA.ac_log(`AC: ${t} codec-filter remaining: `+AudioCodesUA.instance._cf_str(n)),r.priority&&0<r.priority.length){let e=[];for(var u of r.priority){let t=AudioCodesUA.instance._cf_find(u,n);0!==t.length&&(e=e.concat(t),n=n.filter(e=>!t.includes(e)))}n=e.concat(n),AudioCodesUA.ac_log(`AC: ${t} codec-filter changed priority: `+AudioCodesUA.instance._cf_str(n))}s.setCodecPreferences(n)}else AudioCodesUA.ac_log("AC: codec-filter is not supported.");else"audio"===t&&AudioCodesUA.ac_log("AC: codec-filter: cannot get audio transceiver")}catch(t){AudioCodesUA.ac_log("AC: codec filter exception",t)}}_convertIceList(e){var t,n=[];for(t of e)"string"==typeof t&&(t={urls:"stun:"+t}),n.push(t);return n}_randomToken(t){let n="";for(let e=0;e<t;e++)n+=Math.floor(36*Math.random()).toString(36);return n}_detectBrowser(){try{var e=navigator.userAgent;if(this.browser="other",this.browserName=e,this.browserVersion=0,navigator.mozGetUserMedia)this.browser="firefox",this.browserName=e.match(/Firefox\/([.\d]+)$/)[0],this.browserVersion=parseInt(e.match(/Firefox\/(\d+)\./)[1],10);else if(navigator.webkitGetUserMedia){this.browser="chrome",this.browserName=e.match(/Chrom(e|ium)\/([\d]+)/)[0],this.browserVersion=parseInt(e.match(/Chrom(e|ium)\/(\d+)\./)[2],10);var t=e.toLowerCase();for(let e=0;e<this.chromiumBased.length;e++){var n=this.chromiumBased[e].s,r=t.indexOf(n);if(-1!==r){var s=t.substring(r+n.length).match(/([.\d]+)/)[1];this.browserName+=" ("+this.chromiumBased[e].n+"/"+s+")";break}}}else window.safari?(this.browser="safari",this.browserName="Safari/"+e.match(/Version\/([.\d]+)/)[1],this.browserVersion=parseInt(e.match(/Version\/(\d+)\./)[1],10)):-1!==e.indexOf("Edge/")&&(this.browser="other",this.browserName=e.match(/Edge\/([.\d]+)/)[0],this.browserVersion=parseInt(e.match(/Edge\/(\d+).(\d+)$/)[2],10));/iPad|iPhone|iPod/.test(e)&&((this.browserName=e).includes("CriOS")?(this.browser="chrome",this.browserVersion=parseInt(e.match(/CriOS\/(\d+)\./)[1],10)):e.includes("FxiOS")?(this.browser="firefox",this.browserVersion=parseInt(e.match(/FxiOS\/(\d+)\./)[1],10)):(this.browser="safari",this.browserVersion=parseInt(e.match(/Version\/(\d+)\./)[1],10)))}catch(e){AudioCodesUA.ac_log("AC: Browser detection error",e),this.browser="other",this.browserName=navigator.userAgent,this.browserVersion=0}}_detectOS(){this._detectOS1(),"other"===this.os&&this._detectOS2()}_detectOS1(){try{let e=!!navigator.userAgentData&&navigator.userAgentData.platform;!e||"windows"!==(e=e.toLowerCase())&&"linux"!==e&&"android"!==e&&"macos"!==e||(this.os=e)}catch(e){AudioCodesUA.ac_log("AC: detectOS1 error",e),this.os="other"}}_detectOS2(){try{let e=navigator.platform;e&&((e=e.toLowerCase()).startsWith("win")?this.os="windows":e.startsWith("android")?this.os="android":e.startsWith("linux")?navigator.userAgent.includes("Android")?this.os="android":this.os="linux":e.startsWith("mac")?this.os="macos":/ipad|iphone|ipod/.test(e)&&(this.os="ios"))}catch(e){AudioCodesUA.ac_log("AC: detectOS2 error",e),this.os="other"}}_mediaConstraints(e){var t=AudioCodesUA.instance,n={audio:t.constraints.audio};return e&&(n.video=t.constraints.video),n}_callOptions(e,t,n=null,r=null){let s={},i=AudioCodesUA.instance;return"chrome"===i.browser&&i.networkPriority&&(s={rtcConstraints:{optional:[{googDscp:!0}]}}),null!==r&&Object.assign(s,r),s.mediaConstraints=i._mediaConstraints(e),void 0===s.pcConfig&&(s.pcConfig={}),s.pcConfig.iceServers=i.serverConfig.iceServers,null!==n&&(n=n.slice()),null!==i.oauthToken&&i.oauthTokenUseInInvite&&t&&(n=null===n?[]:n).push("Authorization: Bearer "+i.oauthToken),null!==n&&(s.extraHeaders=n),s}call(e,t,n=null,r=null){if(!1===e?e=AudioCodesUA.instance.AUDIO:!0===e&&(e=AudioCodesUA.instance.VIDEO),"symbol"!=typeof e||![AudioCodesUA.instance.AUDIO,AudioCodesUA.instance.VIDEO].includes(e))throw new TypeError("Illegal videoOption="+e.toString());t=t.replace(/\s+/g,""),AudioCodesUA.ac_log(`AC: call ${e.description} to `+t);n=this._callOptions(e===AudioCodesUA.instance.VIDEO,!0,n,r),r=this.jssipUA.call(t,n),n.mediaStream&&(r._localMediaStreamLocallyGenerated=!0),t=r.data.ac_session;return t._setEnabledSendVideo(e===AudioCodesUA.instance.VIDEO),e===AudioCodesUA.instance.VIDEO&&t._setEnabledReceiveVideo(!0),t}sendMessage(e,r,s="text/plain"){return AudioCodesUA.ac_log(`AC: sendMessage to: ${e} "${r}"`),new Promise((t,n)=>{this.jssipUA.sendMessage(e,r,{contentType:s,eventHandlers:{succeeded:e=>t(e),failed:e=>n(e)}})})}isScreenSharingSupported(){return AudioCodesUA.instance.getWR().hasDisplayMedia()}openScreenSharing(){return this.isScreenSharingSupported()?(AudioCodesUA.ac_log("AC: openScreenSharing()"),AudioCodesUA.instance.getWR().getDisplayMedia().then(e=>e).catch(e=>{throw AudioCodesUA.ac_log("AC: openScreenSharing() error",e),e})):(AudioCodesUA.ac_log("AC: openScreenSharing: screen sharing is not supported in the browser"),Promise.reject("Screen sharing is not supported"))}closeScreenSharing(e){AudioCodesUA.ac_log("AC: closeScreenSharing()"),e&&0!=(e=e.getVideoTracks()).length&&"live"===(e=e[0]).readyState&&(e.stop(),e.dispatchEvent(new Event("ended")))}setNetworkPriority(e){if(AudioCodesUA.ac_log("AC: setNetworkPriority "+e),void 0!==e&&"high"!==e&&"medium"!==e&&"low"!==e&&"very-low"!==e)throw new TypeError("setNetworkPriority: illegal value: "+e);this.networkPriority=e}subscribe(...e){return this.jssipUA.subscribe(...e)}notify(...e){return this.jssipUA.notify(...e)}addCredential(e){if(!e.realm||!e.password||!e.username)throw new TypeError("wrong credential structure");this.credentials.push(e)}}class AudioCodesSession{constructor(e){this.js_session=e,this.data={_user:null,_display_name:null,_create_time:null,_initial:!0,_remoteMediaStream:null,_wasUsedSendVideo:!1,_screenSharing:null,_video:{send:!1,receive:!1,enabledSend:!1,enabledReceive:!1}},e.data.ac_session=this}getRTCPeerConnection(){return this.js_session.connection}getRTCLocalStream(){return this.js_session._localMediaStream}getRTCRemoteStream(){return this.data._remoteMediaStream}isEstablished(){return this.js_session.isEstablished()}isTerminated(){return this.js_session.isEnded()}isOutgoing(){return"outgoing"===this.js_session.direction}isAudioMuted(){return this.js_session.isMuted().audio}isVideoMuted(){return this.js_session.isMuted().video}wasAccepted(){return!0===this.data._accepted}getReplacesHeader(){var e;return this.js_session.isEstablished()&&this.js_session._dialog?(e=this.js_session._dialog.id).call_id+`;to-tag=${e.remote_tag};from-tag=`+e.local_tag:(AudioCodesUA.ac_log("getReplacesHeader(): call is not established"),null)}muteAudio(e){AudioCodesUA.ac_log(`AC: muteAudio() arg=${e} `),e?this.js_session.mute({audio:!0,video:!1}):this.js_session.unmute({audio:!0,video:!1})}muteVideo(e){AudioCodesUA.ac_log(`AC: muteVideo() arg=${e} `),e?this.js_session.mute({audio:!1,video:!0}):this.js_session.unmute({audio:!1,video:!0})}sendDTMF(e){let t=AudioCodesUA.instance.dtmfUseWebRTC;t&&"safari"===AudioCodesUA.instance.browser&&void 0===AudioCodesUA.instance.getWR().connection.getDTMFSender(this.js_session.connection)&&(t=!1),AudioCodesUA.ac_log(`AC: sendDTMF() tone=${e} `+(t?"[RFC2833]":"[INFO]"));var n={duration:AudioCodesUA.instance.dtmfDuration,interToneGap:AudioCodesUA.instance.dtmfInterToneGap,transportType:t?"RFC2833":"INFO"};this.js_session.sendDTMF(e,n)}sendInfo(e,t,n=null){AudioCodesUA.ac_log("AC: sendInfo()",e,t,n),this.js_session.sendInfo(t,e,null!==n?{extraHeaders:n}:void 0)}duration(){var e=this.js_session.start_time;if(!e)return 0;let t=this.js_session.end_time;return t=t||new Date,Math.floor((t.getTime()-e.getTime())/1e3)}hasSendVideo(){return this.data._video.send}hasReceiveVideo(){return this.data._video.receive}hasVideo(){return this.hasSendVideo()&&this.hasReceiveVideo()}getVideoState(){return this.hasSendVideo()&&this.hasReceiveVideo()?"sendrecv":this.hasSendVideo()?"sendonly":this.hasReceiveVideo()?"recvonly":"inactive"}_setVideoState(e,t){AudioCodesUA.ac_log(`AC: _setVideoState(send=${e}, receive=${t})`),this.data._video.send=e,this.data._video.receive=t}hasEnabledSendVideo(){return this.data._video.enabledSend}hasEnabledReceiveVideo(){return this.data._video.enabledReceive}getEnabledVideoState(){return this.hasEnabledSendVideo()&&this.hasEnabledReceiveVideo()?"sendrecv":this.hasEnabledSendVideo()?"sendonly":this.hasEnabledReceiveVideo()?"recvonly":"inactive"}_setEnabledSendVideo(e){AudioCodesUA.ac_log(`AC: _setEnabledSendVideo(${e})`),this.data._video.enabledSend=e}_setEnabledReceiveVideo(e){AudioCodesUA.ac_log(`AC: _setEnabledReceiveVideo(${e})`),this.data._video.enabledReceive=e}answer(e,n=null,r=null){if(this.data._answer_called)AudioCodesUA.ac_log("AC: answer() is already called. [Ignored]");else{if(!(this.data._answer_called=!0)===e?e=AudioCodesUA.instance.AUDIO:!0===e&&(e=AudioCodesUA.instance.VIDEO),"symbol"!=typeof e||![AudioCodesUA.instance.AUDIO,AudioCodesUA.instance.RECVONLY_VIDEO,AudioCodesUA.instance.VIDEO].includes(e))throw new TypeError("Illegal videoOption="+e.toString());var s,i,o;switch(AudioCodesUA.ac_log(`AC: ${e.description} answer`),this.hasVideo()||e!==AudioCodesUA.instance.RECVONLY_VIDEO&&e!==AudioCodesUA.instance.VIDEO||(AudioCodesUA.ac_log('AC: incoming INVITE without video, so answer can be only "audio"'),e=AudioCodesUA.instance.AUDIO),this.hasVideo()&&e===AudioCodesUA.instance.AUDIO&&(s=(o=AudioCodesUA.instance).browser,i=o.modes,o=o.browserVersion,"firefox"===s&&i.video_call_audio_answer_firefox_fix?this.data._video_call_audio_answer_firefox=!0:"safari"===s&&(!0===i.video_call_audio_answer_safari_fix&&o<14||"force"===i.video_call_audio_answer_safari_fix)&&(this.data._video_call_audio_answer_safari=!0)),e){case AudioCodesUA.instance.AUDIO:this._setEnabledSendVideo(!1),this.data._incoming_invite_without_sdp?this._setEnabledReceiveVideo(AudioCodesUA.instance.enableAddVideo):this._setEnabledReceiveVideo(!this.hasVideo()&&AudioCodesUA.instance.enableAddVideo),this._setVideoState(!1,!1);break;case AudioCodesUA.instance.VIDEO:this._setEnabledSendVideo(!0),this._setEnabledReceiveVideo(!0),this._setVideoState(!0,!0);break;case AudioCodesUA.instance.RECVONLY_VIDEO:this._setEnabledSendVideo(!1),this._setEnabledReceiveVideo(!0),this._setVideoState(!1,!0)}let t=AudioCodesUA.instance._callOptions(e===AudioCodesUA.instance.VIDEO,!1,n,r);Promise.resolve().then(()=>t.mediaStream||AudioCodesUA.instance.getWR().getUserMedia(t.mediaConstraints)).then(e=>{t.mediaStream=e,this.js_session._localMediaStreamLocallyGenerated=!0,AudioCodesUA.ac_log("AC: answer options:",t),this.js_session.answer(t)}).catch(e=>{AudioCodesUA.ac_log("AC: getUserMedia failure",e),this.reject(488)})}}reject(e=486,t=null){AudioCodesUA.ac_log("AC: reject()");try{var n={status_code:e};t&&(n.extraHeaders=t),this.js_session.terminate(n)}catch(e){AudioCodesUA.ac_log("AC: call reject error:",e)}}terminate(){AudioCodesUA.ac_log("AC: terminate()");try{this.js_session.terminate()}catch(e){AudioCodesUA.ac_log("AC: call terminate error:",e)}}redirect(e,t=302,n=null){AudioCodesUA.ac_log("AC: redirect() callTo="+e);try{var r={status_code:t,extraHeaders:["Contact: "+AudioCodesUA.instance.jssipUA.normalizeTarget(e)]};n&&r.extraHeaders.push(...n),this.js_session.terminate(r)}catch(e){AudioCodesUA.ac_log("AC: call redirect error:",e)}}isLocalHold(){return this.js_session.isOnHold().local}isRemoteHold(){return this.js_session.isOnHold().remote}isReadyToReOffer(){return this.js_session._isReadyToReOffer()}hold(n){return AudioCodesUA.ac_log(`AC: hold(${n})`),new Promise((e,t)=>{(n?this.js_session.hold:this.js_session.unhold).call(this.js_session,{},()=>{AudioCodesUA.ac_log("AC: hold()/unhold() is completed"),e()})||(AudioCodesUA.ac_log("AC: hold()/unhold() failed"),t())})}enableReceiveVideo(e){this._setEnabledReceiveVideo(e);var t,n=this.getRTCPeerConnection(),n=AudioCodesUA.instance.getWR().connection.getTransceiver(n,"video");return null!==n&&(t=this.getEnabledVideoState(),AudioCodesUA.instance.getWR().transceiver.setDirection(n,t)),AudioCodesUA.ac_log(`AC: enableReceiveVideo(${e}) `+(null!==n?"":"No video transceiver")),null!==n}startSendingVideo(e={}){let n=e&&!1!==e.enabledReceiveVideo;return this.hasEnabledSendVideo()?(AudioCodesUA.ac_log("AC: startSendingVideo(). Already started"),Promise.reject("video already started")):(AudioCodesUA.ac_log("AC: startSendingVideo()"),AudioCodesUA.instance.getWR().getUserMedia({video:AudioCodesUA.instance.constraints.video}).catch(e=>{throw AudioCodesUA.ac_log("AC: startSendingVideo() getUserMedia failure",e),e}).then(e=>{e=e.getVideoTracks()[0];this.getRTCLocalStream().addTrack(e),this._setEnabledSendVideo(!0),this._setEnabledReceiveVideo(n);let t=this.data._wasUsedSendVideo;return AudioCodesUA.instance.getWR().connection.addVideo(this.getRTCPeerConnection(),this.getRTCLocalStream(),e,this.hasEnabledReceiveVideo(),t).then(()=>{!t&&AudioCodesUA.instance.codecFilter&&AudioCodesUA.instance._cf_filter("video",this,AudioCodesUA.instance.codecFilter.video)}).catch(e=>{throw AudioCodesUA.ac_log("AC: startSendingVideo(). Adding video error",e),e})}).then(()=>this._renegotiate(e)))}stopSendingVideo(e={}){return this.hasEnabledSendVideo()?(AudioCodesUA.ac_log("AC: stopSendingVideo()"),AudioCodesUA.instance.getWR().connection.removeVideo(this.getRTCPeerConnection(),this.getRTCLocalStream()).catch(e=>{throw AudioCodesUA.ac_log("AC: stopSendingVideo(). Remove video error",e),e}).then(()=>(this._setEnabledSendVideo(!1),this.data._wasUsedSendVideo=!0,this._renegotiate(e)))):(AudioCodesUA.ac_log("AC: stopSendingVideo(). Already stopped"),Promise.reject("video already stopped"))}_doRenegotiate(t){return this.js_session.isEnded()?Promise.reject("call is ended"):new Promise(e=>{if(!this.js_session.renegotiate(t,()=>e(!0)))return e(!1)})}_renegotiate(t,n=30,r=500){return AudioCodesUA.ac_log("AC: _renegotiate() attemptsLeft="+n),this._doRenegotiate(t).then(e=>{if(e)return AudioCodesUA.ac_log("AC: Renegotiation success"),!0;if(n<=1)throw new Error("Too many attempts");return new Promise(e=>setTimeout(e,r)).then(()=>this._renegotiate(t,n-1,r))}).catch(e=>{throw AudioCodesUA.ac_log("AC: Renegotiation failed",e),e})}sendReInvite(n={}){return AudioCodesUA.ac_log("AC: sendReInvite()"),this._renegotiate(n).then(()=>{var e,t;n.showStreams&&(e=this.getRTCLocalStream(),t=this.getRTCRemoteStream(),AudioCodesUA.ac_log("AC>>: [after send re-INVITE] callShowStreams",this,e,t),AudioCodesUA.instance.listeners.callShowStreams(this,e,t))})}startScreenSharing(e,t={localScreenSharing:!0,enabledReceiveVideo:!0,separateVideo:!1}){if(AudioCodesUA.ac_log("AC: startScreenSharing"),!e)return Promise.reject("missed stream argument");if(this.data._screenSharing)return Promise.reject("the call is already using screen-sharing");let n=t&&!1!==t.enabledReceiveVideo,r=e.getVideoTracks()[0],s=void 0,i=(t.localScreenSharing&&(s=this._onEndedScreenSharingTrack.bind(this),r.addEventListener("ended",s)),this.data._screenSharing={stream:e,onended:s,hadSendVideo:this.hasSendVideo()},this.data._wasUsedSendVideo);return this._setEnabledSendVideo(!0),this._setEnabledReceiveVideo(n),AudioCodesUA.instance.getWR().connection.addVideo(this.getRTCPeerConnection(),this.getRTCLocalStream(),r,this.hasEnabledReceiveVideo(),i).then(()=>{!i&&AudioCodesUA.instance.codecFilter&&AudioCodesUA.instance._cf_filter("video",this,AudioCodesUA.instance.codecFilter.video)}).catch(e=>{throw AudioCodesUA.ac_log("AC: startScreenSharing() error",e),this.data._screenSharing=null,e}).then(()=>this._renegotiate({extraHeaders:["X-Screen-Sharing: on"]}))}stopScreenSharing(){return AudioCodesUA.ac_log("AC: stopScreenSharing"),this.data._screenSharing?this._onEndedScreenSharing("called stopScreenSharing()"):Promise.reject("the call does not use screen-sharing")}isScreenSharing(){return!!this.data._screenSharing}doesScreenSharingReplaceCamera(){var e=this.data._screenSharing;return e&&e.hadSendVideo}_onEndedScreenSharingTrack(){return this._onEndedScreenSharing("track ended")}_onEndedScreenSharing(e){let r=this.data._screenSharing,t=(this.data._screenSharing=null,r.stream),n=r.onended;return t&&n&&t.getVideoTracks()[0].removeEventListener("ended",n),Promise.resolve().then(()=>{var e,t,n;if(!this.isTerminated())return e=this.getRTCPeerConnection(),t=this.getRTCLocalStream(),n={extraHeaders:["X-Screen-Sharing: off"]},r.hadSendVideo?(AudioCodesUA.ac_log("AC: screen sharing stopped - restore previously sending video track"),AudioCodesUA.instance.getWR().connection.replaceSenderTrack(e,"video",t),this._renegotiate(n)):(AudioCodesUA.ac_log("AC: screen sharing stopped - stop send video"),this.stopSendingVideo(n))}).then(()=>{AudioCodesUA.instance.listeners.callScreenSharingEnded&&(AudioCodesUA.ac_log(`AC>>: callScreenSharingEnded "${e}"`,this,t),AudioCodesUA.instance.listeners.callScreenSharingEnded(this,t))})}setRemoteHoldState(){this.js_session._remoteHold=!0}sendRefer(e,t=null){if(!AudioCodesUA.instance.listeners.transferorNotification)throw new Error("transferorNotification listener is missed");let n=this,r={eventHandlers:{requestSucceeded(){AudioCodesUA.ac_log("AC>>: transferorNotification progress [REFER accepted]"),AudioCodesUA.instance.listeners.transferorNotification(n,0)},requestFailed(){AudioCodesUA.ac_log("AC>>: transferorNotification failed [REFER failed]"),AudioCodesUA.instance.listeners.transferorNotification(n,-1)},trying(){AudioCodesUA.ac_log("AC>>: transferorNotification progress [NOTIFY 1xx]"),AudioCodesUA.instance.listeners.transferorNotification(n,0)},progress(){AudioCodesUA.ac_log("AC>>: transferorNotification progress [NOTIFY 1xx]"),AudioCodesUA.instance.listeners.transferorNotification(n,0)},accepted(){AudioCodesUA.ac_log("AC>>: transferorNotification success [NOTIFY 2xx]"),AudioCodesUA.instance.listeners.transferorNotification(n,1)},failed(){AudioCodesUA.ac_log("AC>>: transferorNotification failed [NOTIFY >= 300]"),AudioCodesUA.instance.listeners.transferorNotification(n,-1)}}};null!==t&&(r.replaces=t.js_session),this.js_session.refer(e,r)}}class AudioCodesSDP{constructor(e){this.start=[],this.media=[];let t=e.split("\n").map(e=>e.trim()).filter(e=>0<e.length),n=this.start;for(var r of t)r.startsWith("m=")&&(n=[],this.media.push(n)),n.push(r)}getMedia(e){for(var t of this.media)if(0<t.length&&t[0].startsWith("m="+e))return t;return null}checkSendRecv(e){switch(e){case"a=sendrecv":return"sendrecv";case"a=sendonly":return"sendonly";case"a=recvonly":return"recvonly";case"a=inactive":return"inactive";default:return null}}getMediaDirectionValue(e){let t,n=this.getMedia(e);if(null===n)return null;let r="sendrecv";for(var s of this.start)if(null!==(t=this.checkSendRecv(s))){r=t;break}for(var i of n)if(null!==(t=this.checkSendRecv(i))){r=t;break}return r}getMediaDirection(e,t){var n=this.getMediaDirectionValue(e);switch(n){case"sendrecv":return[!0,!0,n];case"sendonly":return t?[!1,!0,n]:[!0,!1,n];case"recvonly":return t?[!0,!1,n]:[!1,!0,n];case null:case"inactive":return[!1,!1,n]}}toString(){let e=this.start;for(var t of this.media)e=e.concat(t);return e.join("\r\n")+"\r\n"}}let AudioCodesWebRTCWrapper={getUserMedia:e=>(AudioCodesUA.ac_log("[webrtc] getUserMedia constraints="+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e)),hasDisplayMedia:()=>navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia,getDisplayMedia:()=>(AudioCodesUA.ac_log("[webrtc] getDisplayMedia"),navigator.mediaDevices.getDisplayMedia({video:!0})),mediaDevices:{enumerateDevices:()=>navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices():Promise.reject("WebRTC is not supported"),addDeviceChangeListener(e){navigator.mediaDevices&&navigator.mediaDevices.addEventListener("devicechange",e)},removeDeviceChangeListener(e){navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",e)}},checkAvailableDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return Promise.reject("WebRTC is not supported");let t=!1,n=!1,r=!1;return navigator.mediaDevices.enumerateDevices().then(e=>(e.forEach(function(e){switch(e.kind){case"videoinput":t=!0;break;case"audioinput":n=!0;break;case"audiooutput":r=!0}}),(r=void 0===navigator.webkitGetUserMedia?!0:r)?n?Promise.resolve(t):Promise.reject("Missing a microphone! Please connect one and reload"):Promise.reject("Missing a speaker! Please connect one and reload")))},transceiver:{setDirection(e,t){let n="";null!==e.sender.track?n=e.sender.track.kind:null!==e.receiver.track&&(n=e.receiver.track.kind),AudioCodesUA.ac_log(`[webrtc] set ${n} transceiver direction=`+t),e.direction=t}},stream:{getInfo(e){function t(e){return 0<e.length?e[0].enabled.toString():"-"}return null===e?Promise.resolve("stream is null"):Promise.resolve(`audio: ${t(e.getAudioTracks())} video: `+t(e.getVideoTracks()))}},connection:{getTransceiversInfo(e){function t(e){return null===e?"none":`d=${e.direction} c=`+e.currentDirection}var n=e.getTransceivers(),r=AudioCodesUA.instance.getWR().connection.getTransceiver(e,"audio"),e=AudioCodesUA.instance.getWR().connection.getTransceiver(e,"video");return Promise.resolve(`(${n.length}) audio ${t(r)} video `+t(e))},getTransceiver(e,t){for(var n of e.getTransceivers()){if(null!==n.sender&&null!==n.sender.track&&n.sender.track.kind===t)return n;if(null!==n.receiver&&null!==n.receiver.track&&n.receiver.track.kind===t)return n}return null},addEventListener:(e,t,n)=>(AudioCodesUA.ac_log("[webrtc] Connection addEventListener "+t),"track"!==t?Promise.reject("Wrong event name: "+t):(e.addEventListener(t,n),Promise.resolve())),getDTMFSender(e){e=e.getSenders().find(e=>e.track&&"audio"===e.track.kind);if(e&&e.dtmf)return e.dtmf},addVideo(e,t,n,r,s){AudioCodesUA.ac_log("[webrtc] Connection addVideo");var i=AudioCodesUA.instance.getWR().connection.getTransceiver(e,"video");return null!==i&&(r=r?"sendrecv":"sendonly",AudioCodesUA.instance.getWR().transceiver.setDirection(i,r)),null===i||null===i.sender.track&&!s?(AudioCodesUA.ac_log("[webrtc] addVideo (connection addTrack)"),e.addTrack(n,t),Promise.resolve(!0)):(AudioCodesUA.ac_log("[webrtc] addVideo (video transceiver sender replaceTrack)"),i.sender.replaceTrack(n).then(()=>!1))},removeVideo(e,t){AudioCodesUA.ac_log("[webrtc] Connection removeVideo");var n=AudioCodesUA.instance.getWR().connection.getTransceiver(e,"video");if(null===n)return Promise.reject("no video transceiver found");if(e.removeTrack(n.sender),t)for(var r of t.getVideoTracks())t.removeTrack(r),r.stop();return Promise.resolve()},replaceSenderTrack(e,t,n){AudioCodesUA.ac_log("[webrtc] ReplaceSenderTrack "+t);let r=null;for(var s of e.getSenders())if(null!==s.track&&s.track.kind===t){r=s;break}return null===r?Promise.reject(`No ${t} sender`):0===(e="audio"===t?n.getAudioTracks():n.getVideoTracks()).length?Promise.reject(`No ${t} track`):r.replaceTrack(e[0])},getStats(e,r){let s="";return e.getStats(null).then(e=>(e.forEach(t=>{if(r.includes(t.type)){s+=" {";let e=!0;for(var n of Object.keys(t))e?e=!1:s+=",",s+=n+"="+t[n];s+="} \r\n"}}),s))}}};class BandwidthUA{#bandwidthUA;static isSBCConnected=!1;constructor(){this.#bandwidthUA=new AudioCodesUA,this.isSBCConnected=!1,AudioCodesUA.ac_log=(...e)=>{e[0]=e[0].replace("AC","BW"),console.log(...e)}}version(){return this.#bandwidthUA.version()}getBrowserName(){return this.#bandwidthUA.getBrowserName()}setOAuthToken(e,t=!0){this.#bandwidthUA.setOAuthToken(e,t)}setUserAgent(e){return this.#bandwidthUA.setUserAgent(e)}setAccount(e,t,n,r){this.#bandwidthUA.setAccount(e,t,n,r)}checkAvailableDevices(){return this.#bandwidthUA.checkAvailableDevices()}setReconnectIntervals(e,t){this.#bandwidthUA.setReconnectIntervals(e,t)}setDtmfOptions(e,t=null,n=null){this.#bandwidthUA.setDtmfOptions(e,t,n)}setWebSocketKeepAlive(e,t,n,r,s){this.#bandwidthUA.setWebSocketKeepAlive(e,t,n,r,s)}isInitialized(){return this.#bandwidthUA.isInitialized()}setServerConfig(e,t,n=[]){return this.#bandwidthUA.setServerConfig(e,t,n)}setListeners(r){this.#bandwidthUA.setListeners({loginStateChanged:function(e,t){switch(console.log(t),r.loginStateChanged(e,t),t){case"connected":this.isSBCConnected=!0,console.log("phone>>> loginStateChanged: connected");break;case"disconnected":this.isSBCConnected=!1,console.log("phone>>> loginStateChanged: disconnected")}},outgoingCallProgress:function(e,t){r.outgoingCallProgress(e,t)},callTerminated:function(e,t,n){r.callTerminated(e,t,n)},callConfirmed:function(e,t,n){r.callConfirmed(e,t,n)},callShowStreams:function(e,t,n){r.callShowStreams(e,t,n)},incomingCall:function(e,t){r.incomingCall(e,t)},callHoldStateChanged:function(e,t,n){r.callHoldStateChanged(e,t,n)}})}async makeCall(e,t){return this.isSBCConnected||(await this.#bandwidthUA.deinit(),await this.#bandwidthUA.init(!1)),this.#bandwidthUA.call(!1,"+"+e,t)}setJsSipLogger(t){return this.#bandwidthUA.setJsSipLogger((...e)=>{e[0]=e[0].replace("AC","BW"),t(...e)})}setAcLogger(t){return this.#bandwidthUA.setAcLogger((...e)=>{e[0]=e[0].replace("AC","BW"),t(...e)})}call(e,t=null,n=null){return this.#bandwidthUA.call(!1,e,t,n)}init(){return this.#bandwidthUA.init(!1)}deinit(){return this.#bandwidthUA.deinit()}}class BandwidthSession{#bandwidthSession;constructor(e){this.#bandwidthSession=new AudioCodesSession(e)}terminate(){return this.#bandwidthSession.terminate()}muteAudio(e){return this.#bandwidthSession.muteAudio(e)}isAudioMuted(){return this.#bandwidthSession.isAudioMuted()}sendDTMF(e){return this.#bandwidthSession.sendDTMF(e)}duration(){return this.#bandwidthSession.duration()}wasAccepted(){return this.#bandwidthSession.wasAccepted()}isLocalHold(){return this.#bandwidthSession.isLocalHold()}isRemoteHold(){return this.#bandwidthSession.isRemoteHold()}IsReadyToReOffer(){return this.#bandwidthSession.isReadyToReOffer()}hold(e){return this.#bandwidthSession.hold(e)}getRTCPeerConnection(){return this.#bandwidthSession.getRTCPeerConnection()}getRTCLocalStream(){return this.#bandwidthSession.getRTCLocalStream()}getRTCRemoteStream(){return this.#bandwidthSession.getRTCRemoteStream()}isOutgoing(){return this.#bandwidthSession.isOutgoing()}sendInfo(e,t,n=null){return this.#bandwidthSession.sendInfo(e,t,n)}}export{BandwidthUA,BandwidthSession};